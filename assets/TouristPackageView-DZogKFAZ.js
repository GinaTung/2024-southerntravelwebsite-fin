import{s as h}from"./sweetAlert-M_FrQGf7.js";import{_ as D,c as o,b as x,a as s,w as C,g as L,t as d,j as v,F as u,h as p,n as m,A as k,r as w,o as i,d as f}from"./index-CrQ_lYDm.js";const g="http://localhost:3000",N={data(){return{text:"南部旅遊方案",products:[],user:"",userId:"",token:"",carts:[],newCarts:[],newProductsDes:"",enabledProducts:[],fullPath:"",currentURL:"",productsCategory:[],selectedCategory:"全部",currentDate:"",currentPage:1,limitPage:5,pageTotal:0,isLoading:!1,status:{loadingItem:"",loadingItem2:""},category:"全部",cartsLength:0}},watch:{$route(e,t){this.currentURL=e.fullPath,this.$root.navigatedFromHeader&&e.fullPath!=="/TouristPackage"&&(this.selectedCategory="全部",this.status.loadingItem=!0,this.getProducts(),this.$root.navigatedFromHeader=!1)}},computed:{filterCategory(){const e=this.productsCategory.map(n=>n.category),t=[...new Set(e)];return t.unshift("全部"),t},filterCateNum(){const e={};return this.productsCategory.forEach(t=>{e[t.category]?e[t.category]+=1:e[t.category]=1}),e.全部=this.productsCategory.length,e},filteredProducts(){return this.selectedCategory==="全部"||!this.selectedCategory?this.enabledProducts:this.enabledProducts.filter(e=>e.category===this.selectedCategory)}},created(){this.category=this.$route.query.category,this.selectedCategory=this.category,this.getProducts()},methods:{getProducts(e=1){this.axios.get(`${g}/products`).then(t=>{this.productsCategory=t.data.filter(n=>n.is_enabled===1),setTimeout(()=>{this.isLoading=!1},1e3)}).catch(t=>{h.threeLayerCheckType("error","取得產品資料失敗")}),this.selectedCategory==="全部"||!this.selectedCategory?this.axios.get(`${g}/products?_limit=${this.limitPage}&_page=${e}`).then(t=>{var n=parseInt(t.headers["x-total-count"]);this.pageTotal=Math.ceil(n/this.limitPage),this.currentPage=e,this.products=t.data,this.getNewText(),this.enabledProducts=this.products.filter(c=>c.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristPackage",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(t=>{h.threeLayerCheckType("error","取得全部產品資料失敗")}):this.axios.get(`${g}/products?category=${this.selectedCategory}&_limit=${this.limitPage}&_page=${e}`).then(t=>{var n=parseInt(t.headers["x-total-count"]);this.pageTotal=Math.ceil(n/this.limitPage),this.currentPage=e,this.products=t.data,this.getNewText(),this.enabledProducts=this.products.filter(c=>c.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristPackage",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(t=>{h.threeLayerCheckType("error","取得區域產品資料失敗")})},filterProducts(e){this.selectedCategory=e,this.status.loadingItem=!0,this.getProducts()},checkDate(){var e=new Date,t={year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate()},n=(t.month<10?"0":"")+t.month,c=(t.date<10?"0":"")+t.date,r=t.year+"-"+n+"-"+c;this.currentDate=r},thousand(e){return e!==void 0&&(e=e.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${e}`},truncateContent(e,t){return e&&e.length>t?e.substring(0,t)+"...":e},getNewText(){const e={};this.products.forEach(t=>{t.description&&t.description.split(";").forEach(c=>{const r=c.trim();e[t.id]||(e[t.id]=[]),e[t.id].push(r)})}),this.newProductsDes=Object.entries(e).map(([t,n])=>({id:t,descriptions:n}))},getCart(){this.axios.get(`${g}/carts`).then(e=>{this.carts=e.data,this.carts.forEach(c=>{c.userId===this.userId&&this.newCarts.push(c)});const t=[],n=new Set;this.newCarts.forEach(c=>{n.has(c.productId)||(n.add(c.productId),t.push(c))}),this.newCarts=t,this.cartsLength=this.newCarts.length,this.$emitter.emit("updateCart",this.cartsLength)}).catch(e=>{h.threeLayerCheckType("error","取得購物車資料失敗")})},addToCart(e,t=1,n){if(this.status.loadingItem2=e,!this.token)h.threeLayerCheckType("warning","請登入會員後，才能預約套裝行程"),this.status.loadingItem2="";else{let c=!1,r=1;this.newCarts.forEach(l=>{l.productId===e&&l.id&&(c=!0,this.cartId=l.id)}),c?this.axios.put(`${g}/carts/${this.cartId}`,{productId:e,qty:t,price:n,total:t*n,userId:this.userId,final_total:t*n*r}).then(l=>{this.status.loadingItem2="",h.threeLayerCheckType("success","已更新預約人數"),this.getCart()}).catch(l=>{this.status.loadingItem2="",h.threeLayerCheckType("error","更新預約人數失敗")}):this.axios.post(`${g}/carts`,{productId:e,qty:t,price:n,total:t*n,userId:this.userId,final_total:t*n*r}).then(l=>{this.status.loadingItem2="",h.threeLayerCheckType("success","已預約成功"),this.getCart()}).catch(l=>{this.status.loadingItem2="",h.threeLayerCheckType("error","預約失敗，再重新登入預約")})}},getCookie(e){const t=document.cookie.split(";");for(let n of t){const[c,r]=n.trim().split("=");if(c===e)return r}return null}},mounted(){this.isLoading=!0,this.getProducts(),window.scrollTo(0,0);const e=this.getCookie("userId"),t=this.getCookie("hexTokenU");this.userId=e*1,this.token=t,this.getCart(),this.checkDate(),this.fullPath=this.$route.fullPath}},S={class:"container py-10 py-lg-30"},E={style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",class:"pb-5 pb-lg-15"},j={class:"breadcrumb mb-0 fs-5"},V={class:"breadcrumb-item"},U={class:"breadcrumb-item","aria-current":"page"},B={key:1},F={key:0,class:"breadcrumb-item","aria-current":"page"},M={class:"tourist-list"},I={class:"row"},q={class:"col-12 col-md-3 mb-5 mb-md-6 mb-lg-0 d-none d-lg-flex"},z={class:"border-1 border w-100 rounded-1 h-100"},A=s("p",{class:"fs-4 p-5 bg-primary-500 text-white"},"地區篩選",-1),H={class:"nav flex-column"},R=["onClick"],O={class:"col-12 col-lg-9"},Y={key:0,class:"text-center",style:{margin:"150px"}},G=s("div",{class:"spinner-border",role:"status",style:{width:"3rem",height:"3rem",color:"#43b8bd"}},[s("span",{class:"visually-hidden"},"Loading...")],-1),J=[G],K={key:1},Q={class:"row g-0"},W={class:"col-md-4"},X={class:"tag text-white"},Z={class:"card-att-img h-100"},$=["src","alt"],tt={class:"col-md-8"},et={class:"card h-100 border-0 bg-transparent"},st={class:"card-body px-3 px-md-4"},at=s("div",{class:"heart3"},[s("i",{class:"bi bi-heart heart-click","data-heartStatus":"false"})],-1),rt={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-10"},it={class:"d-flex mb-4"},ot={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},nt={class:"row"},ct={class:"col-12 col-md-8 my-2"},lt={key:0},dt={class:"col-12 col-md-4"},ht={class:"d-flex flex-column"},ut={class:"fs-4 fs-lg-5 fs-xl-4 text-decoration-line-through text-end"},gt={class:"d-flex flex-md-column align-items-end justify-content-end justify-content-sm-between justify-content-md-end"},_t=s("p",{class:"text-danger fw-bold d-none d-md-block"},"促銷價",-1),pt={class:"d-sm-flex flex-sm-column d-none d-md-none"},ft={key:0,class:"fs-7 fs-sm-6 text-dark2"},yt={key:1,class:"fs-7 fs-sm-6 text-danger"},mt={key:2,class:"fs-7 fs-sm-6 text-dark2"},kt={key:3,class:"fs-6 text-danger"},bt={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},xt={class:"col-12 d-none d-md-flex flex-md-column"},Ct={key:0,class:"fs-6 text-dark2"},vt={key:1,class:"fs-6 text-danger"},Pt={key:2,class:"fs-6 text-dark2"},wt={key:3,class:"fs-6 text-danger"},Tt={class:"card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4"},Dt={class:"d-flex align-items-end"},Lt=["onClick"],Nt={key:0,class:"spinner-border spinner-grow-sm",role:"status"},St={key:1,class:"btn btn-danger w-100 ms-2 px-2 px-md-3 py-2 disabled btn-danger-rounded",type:"button"},Et={"aria-label":"Page navigation example",class:"my-10"},jt={class:"pagination justify-content-center"},Vt=["onClick"];function Ut(e,t,n,c,r,l){const T=w("VueLoading"),b=w("router-link");return i(),o(u,null,[x(T,{active:r.isLoading,class:"text-center","z-index":1060},null,8,["active"]),s("div",S,[s("nav",E,[s("ol",j,[s("li",V,[x(b,{to:"/",exact:"","active-class":"active-link"},{default:C(()=>[f(" 首頁 ")]),_:1})]),s("li",U,[r.fullPath!=="/TouristPackage"?(i(),L(b,{key:0,to:{path:"/TouristPackage"},exact:"","active-class":"active-link"},{default:C(()=>[f(" 南部旅遊方案 ")]),_:1})):(i(),o("span",B," 南部旅遊方案 "))]),r.selectedCategory!=="全部"?(i(),o("li",F,[s("span",null,d(r.selectedCategory),1)])):v("",!0)])]),s("div",M,[s("div",I,[s("div",q,[s("div",z,[A,s("ul",H,[(i(!0),o(u,null,p(l.filterCategory,(a,y)=>(i(),o("li",{class:"nav-item",key:y},[s("a",{class:m(["nav-link p-5 fs-5 link-color d-flex justify-content-between",{"active-category":r.selectedCategory===a}]),href:"#","aria-current":"page",onClick:k(_=>l.filterProducts(a),["prevent"])},[f(d(a)+" ",1),s("span",null,d(l.filterCateNum[a]),1)],10,R)]))),128))])])]),s("div",O,[r.status.loadingItem?(i(),o("div",Y,J)):(i(),o("div",K,[(i(!0),o(u,null,p(l.filteredProducts,(a,y)=>(i(),o("div",{class:"card mb-4 card-att",key:y+123},[s("div",Q,[s("div",W,[s("span",X,d(a.category),1),s("div",Z,[s("img",{src:a.imageUrl,class:"card-img-top img-fluid",alt:a.title},null,8,$)])]),s("div",tt,[s("div",et,[s("div",st,[at,s("h4",rt,d(a.title),1),s("div",it,[s("span",ot,d(a.tag_2),1)]),s("div",nt,[s("div",ct,[(i(!0),o(u,null,p(r.newProductsDes,_=>(i(),o("div",{key:_.id},[_.id===a.id?(i(),o("div",lt,[(i(!0),o(u,null,p(_.descriptions,P=>(i(),o("p",{key:P},d(l.truncateContent(P,85)),1))),128))])):v("",!0)]))),128))]),s("div",dt,[s("div",ht,[s("p",ut," NT"+d(l.thousand(a.origin_price)),1),s("div",gt,[_t,s("div",pt,[r.currentDate<=a.endDate?(i(),o("p",ft," 預約："+d(a.startDate)+" ~ "+d(a.endDate),1)):(i(),o("p",yt,"預約時間已截止")),r.currentDate<=a.endDate?(i(),o("p",mt," 出遊："+d(a.goStartDate)+" ~ "+d(a.goEndDate),1)):(i(),o("p",kt,"已出遊完成"))]),s("p",bt," NT"+d(l.thousand(a.price)),1)])])])]),s("div",xt,[r.currentDate<=a.endDate?(i(),o("p",Ct," 預約時間："+d(a.startDate)+" ~ "+d(a.endDate),1)):(i(),o("p",vt,"預約時間已截止")),r.currentDate<=a.endDate?(i(),o("p",Pt," 出遊時間："+d(a.goStartDate)+" ~ "+d(a.goEndDate),1)):(i(),o("p",wt,"已出遊完成"))])]),s("div",Tt,[s("div",Dt,[x(b,{to:{name:"TouristSinglePackage",params:{category:a.category,title:a.title}},class:"btn-outline-square w-100 me-2 px-2 px-md-3"},{default:C(()=>[f("行程介紹")]),_:2},1032,["to"]),r.currentDate<=a.endDate?(i(),o("button",{key:0,class:"btn-square w-100 ms-2 px-2 px-md-3",onClick:_=>l.addToCart(a.id,e.quantity,a.price),type:"button"},[r.status.loadingItem2===a.id?(i(),o("span",Nt)):v("",!0),f(" 預約套裝行程 ")],8,Lt)):(i(),o("button",St," 預約時間截止 "))])])])])])]))),128)),s("nav",Et,[s("ul",jt,[s("li",{class:m(["page-item",{disabled:!r.currentPage||r.currentPage===1}])},[s("button",{class:"page-link page-link-radius-2",onClick:t[0]||(t[0]=k(a=>r.currentPage>1&&l.getProducts(r.currentPage-1),["prevent"]))}," 上一頁 ")],2),(i(!0),o(u,null,p(r.pageTotal,a=>(i(),o("li",{class:"page-item",key:`page-${a}`},[s("button",{class:m(["page-link page-link-0 rounded-0",{active:a===r.currentPage}]),onClick:k(y=>l.getProducts(a),["prevent"])},d(a),11,Vt)]))),128)),s("li",{class:m(["page-item",{disabled:!r.currentPage||r.currentPage===r.pageTotal}])},[s("button",{class:"page-link page-link-radius",onClick:t[1]||(t[1]=k(a=>r.currentPage<r.pageTotal&&l.getProducts(r.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])]))])])])])],64)}const Mt=D(N,[["render",Ut]]);export{Mt as default};
