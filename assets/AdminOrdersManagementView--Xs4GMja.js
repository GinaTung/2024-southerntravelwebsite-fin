import{s as b}from"./sweetAlert-1ookAecM.js";import{M as P}from"./bootstrap.esm-I46YUtRB.js";import{_ as D,o as s,c as o,b as y,a as e,t as a,j as k,F as h,h as p,d as f,f as x,G as M,r as g,n as C,A as w}from"./index-N7fZ8enQ.js";import{A as T}from"./AdminSidebar-iMsebkGl.js";const $="https://two024-south-json-server-vercel.onrender.com",A={props:{order:{type:Object},ordersDate:{type:Array},updatePaid:{type:Function},getOrders:{type:Function}},data(){return{orderModal:null,tempOrder:{},isLoading:!1}},methods:{isCheckout(){b.twoLayerCheckType("已收到款項時，請更新付款狀態")},openModal(){this.isCheckout(),this.orderModal.show()},closeModal(){this.orderModal.hide()},thousand(r){return r!==void 0&&(r=r.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${r}`},updateOrderStatue(r){this.isLoading=!0;const c={status:r.user.status,...r.user};this.axios.patch(`${$}/orders/${r.id}`,{user:c,billStatus:r.billStatus,checkDataStatus:r.checkDataStatus,status:r.status}).then(n=>{this.getOrders(),this.isLoading=!1,this.orderModal.hide(),b.threeLayerCheckType("success","更新訂單狀態")}).catch(n=>{console.log(n),b.threeLayerCheckType("error",`${n.message}`)})}},watch:{order(){this.tempOrder=this.order}},mounted(){this.orderModal=new P(this.$refs.orderModal)}},j={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",ref:"orderModal"},E={class:"modal-dialog modal-xl"},I={class:"modal-content border-0"},U={class:"modal-header bg-dark text-white"},N={class:"modal-title",id:"exampleModalLabel"},B=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),F={class:"modal-body"},q={class:"row"},z={class:"col-md-4"},G=e("h3",null,"用戶資料",-1),H={class:"table"},J={key:0},K=e("th",{style:{width:"100px"}},"主要聯繫人",-1),Q=e("th",null,"身分證字號",-1),R=e("th",null,"護照號碼",-1),W=e("th",null,"Email",-1),X=e("th",null,"電話",-1),Y=e("th",null,"地址",-1),Z={class:"col-md-8"},ee=e("h3",null,"訂單細節",-1),te={class:"table"},se=e("th",{style:{width:"100px"}},"訂單編號",-1),oe=e("th",null,"下單時間",-1),le={key:0},re=e("th",null,"付款時間",-1),de={key:0},ne={key:1},ae=e("th",null,"付款狀態",-1),ie={key:0,class:"text-success"},ce={key:1,class:"text-muted"},ue=e("th",null,"總金額",-1),he=e("h3",{class:"mb-3"},"選購商品",-1),_e={class:"table"},pe=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"行程名稱"),e("th",{scope:"col"},"預約數量"),e("th",{scope:"col"},"金額")])],-1),me={class:"d-flex justify-content-start"},be={key:0,class:"me-10"},ye={key:0,class:"text-primary-emphasis"},ge={key:1,class:"text-primary"},ke={key:2,class:"text-warning"},fe={key:3,class:"text-danger"},Oe={key:4,class:"text-success"},ve={key:1},xe={class:"form-check me-4"},Me={class:"form-check-label",for:"flexCheckDefault2"},Se={key:0},Ce={key:1},we={class:"form-check me-4"},De={class:"form-check-label",for:"flexCheckDefault3"},Le={key:0},Pe={key:1},Ve={class:"form-check me-4"},Te={class:"form-check-label",for:"flexCheckDefault4"},$e={key:0},Ae={key:1},je={key:2},Ee=e("span",{class:"text-danger"},"已收到款項時，請更新付款狀態",-1),Ie=[Ee],Ue={class:"modal-footer"},Ne=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Be(r,d,c,n,t,i){var O;const m=g("VueLoading");return s(),o(h,null,[y(m,{active:t.isLoading,"z-index":1060},null,8,["active"]),e("div",j,[e("div",E,[e("div",I,[e("div",U,[e("h5",N,[e("span",null,"訂單細節(目前查看訂單編號："+a(t.tempOrder.id)+")",1)]),B]),e("div",F,[e("div",q,[e("div",z,[G,e("table",H,[t.tempOrder.user?(s(),o("tbody",J,[e("tr",null,[K,e("td",null,a(t.tempOrder.user.name)+" "+a(t.tempOrder.user.appellation),1)]),e("tr",null,[Q,e("td",null,a(t.tempOrder.user.memberId),1)]),e("tr",null,[R,e("td",null,a(t.tempOrder.user.passport),1)]),e("tr",null,[W,e("td",null,a(t.tempOrder.user.email),1)]),e("tr",null,[X,e("td",null,a(t.tempOrder.user.tel),1)]),e("tr",null,[Y,e("td",null,a(t.tempOrder.user.address),1)])])):k("",!0)])]),e("div",Z,[ee,e("table",te,[e("tbody",null,[e("tr",null,[se,e("td",null,a(t.tempOrder.id),1)]),e("tr",null,[oe,t.tempOrder.user?(s(),o("td",le,a(t.tempOrder.user.create_at),1)):k("",!0)]),e("tr",null,[re,e("td",null,[t.tempOrder.paid_date?(s(),o("span",de,a(t.tempOrder.paid_date),1)):(s(),o("span",ne,"時間不正確"))])]),e("tr",null,[ae,e("td",null,[(O=t.tempOrder.user)!=null&&O.status?(s(),o("strong",ie,"已付款")):(s(),o("span",ce,"尚未付款"))])]),e("tr",null,[ue,e("td",null,[(s(!0),o(h,null,p(t.tempOrder.product,u=>(s(),o(h,{key:u.id},[f(a(i.thousand(u.final_total)),1)],64))),128))])])])]),he,e("table",_e,[pe,e("tbody",null,[(s(!0),o(h,null,p(t.tempOrder.product,(u,S)=>(s(),o(h,{key:S+123},[(s(!0),o(h,null,p(u.products,l=>(s(),o("tr",{key:l.id},[e("th",null,a(l.title),1),e("td",null,"預約 "+a(l.qty)+" / 位",1),e("td",null,a(i.thousand(l.final_total)),1)]))),128))],64))),128))])]),e("div",me,[t.tempOrder.user?(s(),o("div",be,[f(" 目前訂單狀態 : "),!t.tempOrder.status&&!t.tempOrder.billStatus&&!t.tempOrder.checkDataStatus&&!t.tempOrder.user.status?(s(),o("span",ye," 訂單處理中 ")):!t.tempOrder.status&&!t.tempOrder.billStatus&&!t.tempOrder.checkDataStatus&&t.tempOrder.user.status?(s(),o("span",ge," 確認出遊資料中 ")):!t.tempOrder.status&&!t.tempOrder.billStatus&&t.tempOrder.checkDataStatus&&t.tempOrder.user.status?(s(),o("span",ke," 發票開立中 ")):!t.tempOrder.status&&t.tempOrder.billStatus&&t.tempOrder.checkDataStatus&&t.tempOrder.user.status?(s(),o("span",fe," 訂單即將完成，準備出遊 ")):(s(),o("span",Oe,"已出遊結束"))])):k("",!0),t.tempOrder.user&&t.tempOrder.user.status===!0?(s(),o("div",ve,[e("div",xe,[x(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault2","onUpdate:modelValue":d[0]||(d[0]=u=>t.tempOrder.checkDataStatus=u)},null,512),[[M,t.tempOrder.checkDataStatus]]),e("label",Me,[t.tempOrder.checkDataStatus?(s(),o("span",Se,"已確認出遊資料完成")):(s(),o("span",Ce,"未確認出遊資料"))])]),e("div",we,[x(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault3","onUpdate:modelValue":d[1]||(d[1]=u=>t.tempOrder.billStatus=u)},null,512),[[M,t.tempOrder.billStatus]]),e("label",De,[t.tempOrder.billStatus?(s(),o("span",Le,"已開立發票")):(s(),o("span",Pe,"未開立發票"))])]),e("div",Ve,[x(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault4","onUpdate:modelValue":d[2]||(d[2]=u=>t.tempOrder.status=u)},null,512),[[M,t.tempOrder.status]]),e("label",Te,[t.tempOrder.status?(s(),o("span",$e,"出遊結束")):(s(),o("span",Ae,"最後確認訂單資料"))])])])):(s(),o("div",je,Ie))])])])]),e("div",Ue,[Ne,e("button",{type:"button",class:"btn btn-primary",onClick:d[3]||(d[3]=u=>i.updateOrderStatue(t.tempOrder))}," 修改付款狀態 ")])])])],512)],64)}const Fe=D(A,[["render",Be]]),qe={props:{item:Object,delOrder:Function},data(){return{delModal:null,tempOrder:{}}},methods:{openModal(){this.delModal.show()},closeModal(){this.delModal.hide()}},mounted(){this.delModal=new P(this.$refs.delorderModal)}},ze={class:"modal fade",id:"delorderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"delorderModal"},Ge={class:"modal-dialog",role:"document"},He={class:"modal-content border-0"},Je={class:"modal-header bg-danger text-white"},Ke={class:"modal-title"},Qe=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Re={key:0,class:"modal-body"},We={class:"text-danger me-2"},Xe={class:"text-primary"},Ye={class:"modal-footer"},Ze=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function et(r,d,c,n,t,i){return s(),o("div",ze,[e("div",Ge,[e("div",He,[e("div",Je,[e("h5",Ke,[e("span",null,"刪除訂單編號: "+a(c.item.id),1)]),Qe]),c.item.user?(s(),o("div",Re,[f(" 是否刪除 "),e("strong",We,"訂單編號："+a(c.item.id),1),e("span",Xe,"客戶："+a(c.item.user.name),1),f("(刪除後將無法恢復)。 ")])):k("",!0),e("div",Ye,[Ze,e("button",{type:"button",class:"btn btn-danger",onClick:d[0]||(d[0]=(...m)=>c.delOrder&&c.delOrder(...m))},"確認刪除")])])])],512)}const tt=D(qe,[["render",et]]),v="https://two024-south-json-server-vercel.onrender.com",st={components:{AdminSidebar:T,OrderModal:Fe,DelOrderModal:tt},data(){return{orders:[],isNew:!1,pageTotal:0,currentPage:1,limitPage:10,isLoading:!1,tempOrder:{},orderModal:null,delModal:null}},methods:{thousand(r){return r!==void 0&&(r=r.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${r}`},getOrders(r=1){this.isLoading=!0,this.axios.get(`${v}/orders?_limit=${this.limitPage}&_page=${r}`).then(d=>{var c=parseInt(d.headers["x-total-count"]);this.pageTotal=Math.ceil(c/this.limitPage),this.currentPage=r,this.orders=d.data,this.orders.forEach(n=>{var t=new Date(n.user.create_at),i=t.toISOString(),m=i.slice(0,10);n.user.create_at=m}),this.getOrderProducts(),this.isLoading=!1}).catch(d=>{this.isLoading=!1,console.log(d),this.pushMessage({style:"danger",title:"錯誤訊息",content:d.message})})},getOrderProducts(){this.axios.get(`${v}/cartsData`).then(r=>{const d={};r.data.forEach(n=>{d[n.id]||(d[n.id]={final_total:n.final_total,userId:n.userId,cartDataId:n.id,total:n.total,products:[]}),n.data.forEach(t=>{d[n.id].products.push({id:t.productId,title:t.product.title,qty:t.qty,price:t.price,total:t.total,final_total:t.final_total})})});const c=Object.values(d);this.orders.forEach(n=>{c.forEach(t=>{n.user.cartDataId===t.cartDataId&&(n.product=[],n.product.push(t))})})}).catch(r=>{console.log(r)})},openModal(r){this.tempOrder={...r},this.isNew=!1,this.$refs.orderModal.openModal()},openDelOrderModal(r){this.tempOrder={...r},this.$refs.delModal.openModal()},updatePaid(r){this.isLoading=!0;const d=r.user.status,c={...r.user,status:d};this.axios.patch(`${v}/orders/${r.id}`,{user:c}).then(n=>{this.getOrders(),this.isLoading=!1,this.$refs.orderModal.closeModal(),b.threeLayerCheckType("success","更新付款狀態")}).catch(n=>{this.isLoading=!1,b.threeLayerCheckType("error",`${n.message}`),console.log(n)})},delOrder(){this.isLoading=!0,this.axios.delete(`${v}/orders/${this.tempOrder.id}`,this.tempOrder).then(r=>{this.getOrders(),this.isLoading=!1,this.$refs.delModal.closeModal(),b.threeLayerCheckType("success","已刪除成功")}).catch(r=>{this.isLoading=!1,b.threeLayerCheckType("error",`${r.message}`)})}},mounted(){this.getOrders()}},ot={class:"container"},lt={class:"row flex-column flex-md-row"},rt={class:"col-12 col-md-3"},dt=e("h1",{class:"my-4 fs-4 fs-md-1"},"訂單管理",-1),nt={class:"col-12 col-md-9"},at=e("div",{class:"text-end mt-18"},null,-1),it={class:"table-responsive"},ct={class:"table mt-4"},ut=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"聯繫人"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"處理狀態"),e("th",null,"編輯")])],-1),ht={style:{width:"100px"}},_t=["textContent"],pt={class:"list-unstyled"},mt=e("br",null,null,-1),bt={style:{width:"80px"}},yt={class:"form-check form-switch",style:{width:"100px"}},gt=["onUpdate:modelValue","onChange"],kt={class:"form-check-label"},ft={key:0},Ot={key:1,class:"text-danger"},vt={style:{width:"80px"}},xt={key:0,class:"text-primary-emphasis"},Mt={key:1,class:"text-primary"},St={key:2,class:"text-warning"},Ct={key:3,class:"text-danger"},wt={key:4,class:"text-success"},Dt={class:"btn-group"},Lt=["onClick"],Pt=["onClick"],Vt={"aria-label":"Page navigation example ",class:"my-10"},Tt={class:"pagination justify-content-center"},$t=["value","onClick"],At={class:"page-item"};function jt(r,d,c,n,t,i){const m=g("VueLoading"),O=g("AdminSidebar"),u=g("order-modal"),S=g("del-order-modal");return s(),o(h,null,[y(m,{active:t.isLoading,"z-index":1060},null,8,["active"]),e("div",ot,[e("div",lt,[e("div",rt,[dt,y(O)]),e("div",nt,[at,e("div",it,[e("table",ct,[ut,e("tbody",null,[(s(!0),o(h,null,p(t.orders,l=>(s(),o("tr",{key:l.id},[e("td",null,[e("div",ht,a(l.user.create_at),1)]),e("td",null,[l.user?(s(),o("span",{key:0,textContent:a(l.user.email),style:{width:"80px"}},null,8,_t)):k("",!0)]),e("td",null,[e("ul",pt,[(s(!0),o(h,null,p(l.product,_=>(s(),o(h,{key:_.id},[(s(!0),o(h,null,p(_.products,(L,V)=>(s(),o("li",{key:V+123,style:{width:"200px"}},[f(a(L.title)+" 預約："+a(L.qty)+"位 ",1),mt]))),128))],64))),128))])]),(s(!0),o(h,null,p(l.product,_=>(s(),o("td",{class:"text-right",key:_.id},[e("div",bt,a(i.thousand(_.final_total)),1)]))),128)),e("td",null,[e("div",yt,[x(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":_=>l.user.status=_,onChange:_=>i.updatePaid(l)},null,40,gt),[[M,l.user.status]]),e("label",kt,[l.user.status?(s(),o("span",ft,"已付款")):(s(),o("span",Ot,"未付款"))])])]),e("td",null,[e("div",vt,[!l.status&&!l.billStatus&&!l.checkDataStatus&&!l.user.status?(s(),o("p",xt," 訂單處理中 ")):!l.status&&!l.billStatus&&!l.checkDataStatus&&l.user.status?(s(),o("p",Mt," 預約安排出遊 ")):!l.status&&!l.billStatus&&l.checkDataStatus&&l.user.status?(s(),o("p",St," 發票開立中 ")):!l.status&&l.billStatus&&l.checkDataStatus&&l.user.status?(s(),o("p",Ct," 訂單即將完成，準備出遊 ")):(s(),o("p",wt,"已出遊結束"))])]),e("td",null,[e("div",Dt,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:_=>i.openModal(l)}," 檢視 ",8,Lt),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:_=>i.openDelOrderModal(l)}," 刪除 ",8,Pt)])])]))),128))])])]),e("nav",Vt,[e("ul",Tt,[e("li",{class:C(["page-item",{disabled:!t.currentPage||t.currentPage===1}])},[e("a",{class:"page-link page-link-radius-2",href:"",onClick:d[0]||(d[0]=w(l=>i.getOrders(t.currentPage-1),["prevent"]))},"上一頁")],2),(s(!0),o(h,null,p(t.pageTotal,l=>(s(),o("li",{class:"page-item",key:l+123},[e("a",{class:C(["page-link page-link-0 rounded-0",{active:l===t.currentPage}]),href:"",value:l,onClick:w(_=>i.getOrders(l),["prevent"])},a(l),11,$t)]))),128)),e("li",At,[e("a",{class:C(["page-link page-link-radius",{disabled:!t.currentPage||t.currentPage===t.pageTotal}]),href:"",onClick:d[1]||(d[1]=w(l=>i.getOrders(t.currentPage+1),["prevent"]))},"下一頁",2)])])])])])]),y(u,{ref:"orderModal",order:t.tempOrder,"update-paid":i.updatePaid,"get-orders":i.getOrders},null,8,["order","update-paid","get-orders"]),y(S,{ref:"delModal",item:t.tempOrder,"del-order":i.delOrder},null,8,["item","del-order"])],64)}const Bt=D(st,[["render",jt]]);export{Bt as default};
