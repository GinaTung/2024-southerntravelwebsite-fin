import{_ as m,c,F as u,h as _,a as e,n as p,A as f,o as l,t as d,j as v,b,w as C,d as y,r as P}from"./index-cq87140S.js";const g="http://localhost:3000",w={data(){return{pageTotal:0,currentPage:1,limitPage:5,parsedLinks:"",products:[],user:"",newProductsDes:"",enabledProducts:[],searchChiayi:[],newProductsContent:"",enabledProducts:[],carts:[],quantity:1,newQty:"",newCarts:[],cartId:null,userId:"",token:""}},methods:{thousand(s){return s!==void 0&&(s=s.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${s}`},truncateContent(s,t){return s&&s.length>t?s.substring(0,t)+"...":s},getNewText(){const s={};this.products.forEach(t=>{t.description&&t.description.split(";").forEach(n=>{const i=n.trim();s[t.id]||(s[t.id]=[]),s[t.id].push(i)})}),this.newProductsDes=Object.entries(s).map(([t,o])=>({id:t,descriptions:o}))},searchProducts(s=1){this.axios.get(`${g}/products?category=嘉義&_limit=${this.limitPage}&_page=${s}`).then(t=>{var o=parseInt(t.headers["x-total-count"]);this.pageTotal=Math.ceil(o/this.limitPage),this.currentPage=s,this.products=t.data,this.searchChiayi=[],this.products.forEach(n=>{n.is_enabled===1&&this.searchChiayi.push(n)}),this.getNewText()}).catch(t=>{alert(`${t.message}`)})},addToCart(s,t=1,o){if(!this.token)alert("請登入會員後，才能預約套裝行程");else{let n=!1,i=1;this.newCarts.forEach(r=>{r.productId===s&&r.id&&(n=!0,this.cartId=r.id)}),n?this.axios.put(`${g}/carts/${this.cartId}`,{productId:s,qty:t,price:o,total:t*o,userId:this.userId,final_total:t*o*i}).then(r=>{alert("已更新預約人數"),this.getCart()}).catch(r=>{alert("更新預約人數失敗")}):this.axios.post(`${g}/carts`,{productId:s,qty:t,price:o,total:t*o,userId:this.userId,final_total:t*o*i}).then(r=>{alert("已預約成功"),this.getCart()}).catch(r=>{alert("預約失敗，再重新登入預約")})}},getCart(){this.axios.get(`${g}/carts`).then(s=>{this.carts=s.data,this.carts.forEach(t=>{t.userId===this.userId&&this.newCarts.push(t)})}).catch(s=>{alert("取得購物車資料失敗")})},getCookie(s){const t=document.cookie.split(";");for(let o of t){const[n,i]=o.trim().split("=");if(n===s)return i}return null}},mounted(){this.searchProducts();const s=this.getCookie("userId"),t=this.getCookie("hexTokenU");this.userId=s*1,this.token=t}},T={class:"row g-0"},N={class:"col-md-4"},E={class:"tag text-white"},D={class:"card-att-img h-100"},S=["src","alt"],V={class:"col-md-8"},j={class:"card h-100 border-0 bg-transparent"},B={class:"card-body px-3 px-md-4"},M=e("div",{class:"heart3"},[e("i",{class:"bi bi-heart heart-click","data-heartStatus":"false"})],-1),U={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-8"},F={class:"d-flex mb-4"},z={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},A={class:"row"},I={class:"col-12 col-sm-8 my-2"},L={key:0},O={class:"col-12 col-sm-4"},Q={class:"d-flex flex-column"},G={class:"fs-4 fs-lg-5 fs-xl-4 text-decoration-line-through text-end"},H={class:"d-flex flex-sm-column align-items-end justify-content-end"},J=e("p",{class:"text-danger fw-bold d-none d-sm-block"},"促銷價",-1),K={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},R=e("div",{class:"col-12"},null,-1),W={class:"card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4"},X={class:"d-flex align-items-end"},Y=["onClick"],Z={"aria-label":"Page navigation example ",class:"my-10"},q={class:"pagination justify-content-center"},$=["value","onClick"],tt={class:"page-item"};function et(s,t,o,n,i,r){const k=P("router-link");return l(),c(u,null,[(l(!0),c(u,null,_(i.searchChiayi,a=>(l(),c("div",{class:"card mb-4 card-att",key:a.id},[e("div",T,[e("div",N,[e("span",E,d(a.category),1),e("div",D,[e("img",{src:a.imageUrl,class:"card-img-top img-fluid",alt:a.title},null,8,S)])]),e("div",V,[e("div",j,[e("div",B,[M,e("h4",U,d(a.title),1),e("div",F,[e("span",z,d(a.tag_2),1)]),e("div",A,[e("div",I,[(l(!0),c(u,null,_(i.newProductsDes,h=>(l(),c("div",{key:h.id},[h.id===a.id?(l(),c("div",L,[(l(!0),c(u,null,_(h.descriptions,x=>(l(),c("p",{key:x},d(r.truncateContent(x,85)),1))),128))])):v("",!0)]))),128))]),e("div",O,[e("div",Q,[e("p",G,"NT"+d(r.thousand(a.origin_price)),1),e("div",H,[J,e("p",K,"NT"+d(r.thousand(a.price)),1)])])])]),R]),e("div",W,[e("div",X,[b(k,{to:{name:"TouristSinglePackage",params:{category:a.category,title:a.title}},class:"btn-outline-square w-100 me-2 px-2 px-md-3",type:"button"},{default:C(()=>[y("行程介紹")]),_:2},1032,["to"]),e("a",{class:"btn-square w-100 ms-2 px-2 px-md-3",onClick:h=>r.addToCart(a.id,i.quantity,a.price),type:"button"},"預約套裝行程",8,Y)])])])])])]))),128)),e("nav",Z,[e("ul",q,[e("li",{class:p(["page-item",{disabled:!i.currentPage||i.currentPage===1}])},[e("a",{class:"page-link page-link-radius-2",href:"",onClick:t[0]||(t[0]=f(a=>r.searchProducts(i.currentPage-1),["prevent"]))},"上一頁")],2),(l(!0),c(u,null,_(i.pageTotal,a=>(l(),c("li",{class:"page-item",key:a+123},[e("a",{class:p(["page-link page-link-0 rounded-0",{active:a===i.currentPage}]),href:"",value:a,onClick:f(h=>r.searchProducts(a),["prevent"])},d(a),11,$)]))),128)),e("li",tt,[e("a",{class:p(["page-link page-link-radius",{disabled:!i.currentPage||i.currentPage===i.pageTotal}]),href:"",onClick:t[1]||(t[1]=f(a=>r.searchProducts(i.currentPage+1),["prevent"]))},"下一頁",2)])])])],64)}const at=m(w,[["render",et]]);export{at as default};
