import{B as L}from"./BannerBlock-xMd14jH9.js";import{s as h}from"./sweetAlert-UGFnAZ6i.js";import{_ as N,c,b as x,a as s,w as C,g as S,m as v,t as d,j as w,F as p,h as _,n as y,r as D,o,d as m,p as F,f as B,e as E}from"./index-D7ZFLuID.js";const g="https://two024-south-json-server-vercel.onrender.com",j={components:{BannerBlock:L},data(){return{products:[],user:"",userId:"",token:"",carts:[],newCarts:[],newProductsDes:"",enabledProducts:[],fullPath:"",currentURL:"",productsCategory:[],selectedCategory:"全部",currentDate:"",currentPage:1,limitPage:5,pageTotal:0,isLoading:!1,status:{loadingItem:"",loadingItem2:""},category:"全部",cartsLength:0,heartData:[],isFavorite:{}}},watch:{$route(e,t){this.currentURL=e.fullPath,this.$root.navigatedFromHeader&&e.fullPath!=="/TouristPackage"&&(this.selectedCategory="全部",this.status.loadingItem=!0,this.getProducts(),this.$root.navigatedFromHeader=!1)}},computed:{filterCategory(){const e=this.productsCategory.map(i=>i.category),t=[...new Set(e)];return t.unshift("全部"),t},filterCateNum(){const e={};return this.productsCategory.forEach(t=>{e[t.category]?e[t.category]+=1:e[t.category]=1}),e.全部=this.productsCategory.length,e},filteredProducts(){return this.selectedCategory==="全部"||!this.selectedCategory?this.enabledProducts:this.enabledProducts.filter(e=>e.category===this.selectedCategory)}},created(){this.category=this.$route.query.category,this.selectedCategory=this.category,this.getProducts()},methods:{getProducts(e=1){this.axios.get(`${g}/products`).then(t=>{this.productsCategory=t.data.filter(i=>i.is_enabled===1),setTimeout(()=>{this.isLoading=!1},1e3)}).catch(t=>{h.threeLayerCheckType("error","取得產品資料失敗")}),this.selectedCategory==="全部"||!this.selectedCategory?this.axios.get(`${g}/products?_limit=${this.limitPage}&_page=${e}`).then(t=>{var i=parseInt(t.headers["x-total-count"]);this.pageTotal=Math.ceil(i/this.limitPage),this.currentPage=e,this.products=t.data,this.getNewText(),this.enabledProducts=this.products.filter(l=>l.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristPackage",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(t=>{h.threeLayerCheckType("error","取得全部產品資料失敗")}):this.axios.get(`${g}/products?category=${this.selectedCategory}&_limit=${this.limitPage}&_page=${e}`).then(t=>{var i=parseInt(t.headers["x-total-count"]);this.pageTotal=Math.ceil(i/this.limitPage),this.currentPage=e,this.products=t.data,this.getNewText(),this.enabledProducts=this.products.filter(l=>l.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristPackage",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(t=>{h.threeLayerCheckType("error","取得區域產品資料失敗")})},filterProducts(e){this.selectedCategory=e,this.status.loadingItem=!0,this.getProducts()},checkDate(){var e=new Date,t={year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate()},i=(t.month<10?"0":"")+t.month,l=(t.date<10?"0":"")+t.date,r=t.year+"-"+i+"-"+l;this.currentDate=r},getHeartData(){this.axios.get(`${g}/hearts`).then(e=>{e.data.forEach(t=>{t.userId===this.userId&&t.tag==="旅遊方案"&&(this.isFavorite[t.product]=!0)})}).catch(e=>{h.threeLayerCheckType("error","取得愛心收藏資料失敗")})},toggleFavorite(e,t,i,l){this.token?this.axios.get(`${g}/hearts`).then(r=>{const n=r.data.find(u=>u.product===e&&u.userId===this.userId&&u.tag==="旅遊方案");n?this.axios.delete(`${g}/hearts/${n.id}`).then(u=>{this.isFavorite[e]=!1,h.threeLayerCheckType("success",`取消收藏 ${i} 成功`),this.getHeartData()}).catch(u=>{h.threeLayerCheckType("error","取消收藏資料失敗")}):this.axios.post(`${g}/hearts`,{product:e,category:t,title:i,userId:this.userId,tag:"旅遊方案",imageUrl:l}).then(u=>{this.isFavorite[e]=!0,h.threeLayerCheckType("success",`已加入收藏 ${i} 成功`),this.getHeartData()}).catch(u=>{h.threeLayerCheckType("error","收藏資料失敗")})}).catch(r=>{h.threeLayerCheckType("error","取得愛心收藏資料失敗")}):h.threeLayerCheckType("warning","請登入會員後，才能加入收藏")},thousand(e){return e!==void 0&&(e=e.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${e}`},truncateContent(e,t){return e&&e.length>t?e.substring(0,t)+"...":e},getNewText(){const e={};this.products.forEach(t=>{t.description&&t.description.split(";").forEach(l=>{const r=l.trim();e[t.id]||(e[t.id]=[]),e[t.id].push(r)})}),this.newProductsDes=Object.entries(e).map(([t,i])=>({id:t,descriptions:i}))},getCart(){this.axios.get(`${g}/carts`).then(e=>{this.carts=e.data,this.carts.forEach(l=>{l.userId===this.userId&&this.newCarts.push(l)});const t=[],i=new Set;this.newCarts.forEach(l=>{i.has(l.productId)||(i.add(l.productId),t.push(l))}),this.newCarts=t,this.cartsLength=this.newCarts.length,this.$emitter.emit("updateCart",this.cartsLength)}).catch(e=>{h.threeLayerCheckType("error","取得購物車資料失敗")})},addToCart(e,t=1,i){if(this.status.loadingItem2=e,!this.token)h.threeLayerCheckType("warning","請登入會員後，才能預約套裝行程"),this.status.loadingItem2="";else{let l=!1,r=1;this.newCarts.forEach(n=>{n.productId===e&&n.id&&(l=!0,this.cartId=n.id)}),l?this.axios.put(`${g}/carts/${this.cartId}`,{productId:e,qty:t,price:i,total:t*i,userId:this.userId,final_total:t*i*r}).then(n=>{this.status.loadingItem2="",h.threeLayerCheckType("success","已更新預約人數"),this.getCart()}).catch(n=>{this.status.loadingItem2="",h.threeLayerCheckType("error","更新預約人數失敗")}):this.axios.post(`${g}/carts`,{productId:e,qty:t,price:i,total:t*i,userId:this.userId,final_total:t*i*r}).then(n=>{this.status.loadingItem2="",h.threeLayerCheckType("success","已預約成功"),this.getCart()}).catch(n=>{this.status.loadingItem2="",h.threeLayerCheckType("error","預約失敗，再重新登入預約")})}},getCookie(e){const t=document.cookie.split(";");for(let i of t){const[l,r]=i.trim().split("=");if(l===e)return r}return null}},mounted(){this.isLoading=!0,this.getProducts(),window.scrollTo(0,0);const e=this.getCookie("userId"),t=this.getCookie("hexTokenU");this.userId=e*1,this.token=t,this.getCart(),this.checkDate(),this.getHeartData(),this.fullPath=this.$route.fullPath}},P=e=>(F("data-v-6f312387"),e=e(),B(),e),U={class:"container py-10 py-lg-30"},H={style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",class:"pb-5 pb-lg-15"},I={class:"breadcrumb mb-0 fs-5"},V={class:"breadcrumb-item"},M={class:"breadcrumb-item","aria-current":"page"},q={key:1},z={key:0,class:"breadcrumb-item","aria-current":"page"},R={class:"tourist-list"},A={class:"row"},G={class:"col-12 col-lg-3 mb-5 mb-md-6 mb-lg-0"},O={class:"border-1 border w-100 h-100 rounded-6"},Y=P(()=>s("p",{class:"fs-5 fs-lg-4 p-5 bg-primary-500 text-white rounded-top-end"},"地區篩選",-1)),J={class:"nav flex-row flex-lg-column"},K=["onClick"],Q={class:"d-none d-lg-block"},W={class:"d-none d-sm-block d-lg-none ms-1"},X={class:"col-12 col-lg-9"},Z=E('<div class="row g-0" data-v-6f312387><div class="col-md-4" data-v-6f312387><span class="tag text-white placeholder-glow" data-v-6f312387></span><div class="card-att-img h-100" data-v-6f312387><img src="https://raw.githubusercontent.com/GinaTung/2024-southerntravelwebsite-fin/dev/public/products/duck.jpg" class="img-fluid opacity-25" alt="Placeholder Image" data-v-6f312387></div></div><div class="col-md-8" data-v-6f312387><div class="card h-100 border-0 bg-transparent" data-v-6f312387><div class="card-body px-3 px-md-4" data-v-6f312387><button class="heart border-0" data-v-6f312387><i class="bi bi-heart" data-v-6f312387></i></button><h4 class="fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-10 placeholder w-60" data-v-6f312387></h4><div class="d-flex flex-column" data-v-6f312387><span class="placeholder w-25" data-v-6f312387></span></div><div class="row" data-v-6f312387><div class="col-12 col-md-8 my-2 placeholder-glow" data-v-6f312387><span class="placeholder w-100" data-v-6f312387></span><span class="placeholder w-100" data-v-6f312387></span><span class="placeholder w-100" data-v-6f312387></span><span class="placeholder w-75 mt-3" data-v-6f312387></span><span class="placeholder w-75 mt-3" data-v-6f312387></span></div><div class="col-12 col-md-4 my-2 text-end placeholder-glow" data-v-6f312387><span class="placeholder w-100" data-v-6f312387></span><span class="placeholder w-75" data-v-6f312387></span><span class="placeholder w-100" data-v-6f312387></span></div></div></div><div class="card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4 placeholder-glow" data-v-6f312387><div class="d-flex" data-v-6f312387><span class="placeholder w-50 me-2" data-v-6f312387></span><span class="placeholder w-50 ms-2" data-v-6f312387></span></div></div></div></div></div>',1),$=[Z],ee={key:0,class:"text-center",style:{margin:"150px"}},te=P(()=>s("div",{class:"spinner-border",role:"status",style:{width:"3rem",height:"3rem",color:"#43b8bd"}},[s("span",{class:"visually-hidden"},"Loading...")],-1)),se=[te],ae={key:1},re={class:"row g-0"},oe={class:"col-md-4"},ie={class:"tag text-white"},ce={class:"card-att-img h-100"},ne=["src","alt"],le={class:"col-md-8"},de={class:"card h-100 border-0 bg-transparent"},he={class:"card-body px-3 px-md-4"},ge=["onClick"],ue={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-10"},pe={class:"d-flex mb-4"},fe={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},_e={class:"row"},ve={class:"col-12 col-md-8 my-2"},ye={key:0},me={class:"col-12 col-md-4"},ke={class:"d-flex flex-column"},be={class:"fs-4 fs-lg-5 fs-xl-4 text-decoration-line-through text-end"},xe={class:"d-flex flex-md-column align-items-end justify-content-end justify-content-sm-between justify-content-md-end"},Ce=P(()=>s("p",{class:"text-danger fw-bold d-none d-md-block"},"促銷價",-1)),we={class:"d-sm-flex flex-sm-column d-none d-md-none"},Pe={key:0,class:"fs-7 fs-sm-6 text-dark2"},Te={key:1,class:"fs-7 fs-sm-6 text-danger"},De={key:2,class:"fs-7 fs-sm-6 text-dark2"},Le={key:3,class:"fs-6 text-danger"},Ne={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},Se={class:"col-12 d-none d-md-flex flex-md-column"},Fe={key:0,class:"fs-6 text-dark2"},Be={key:1,class:"fs-6 text-danger"},Ee={key:2,class:"fs-6 text-dark2"},je={key:3,class:"fs-6 text-danger"},Ue={class:"card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4"},He={class:"d-flex align-items-end"},Ie=["onClick"],Ve={key:0,class:"spinner-border spinner-grow-sm",role:"status"},Me={key:1,class:"btn btn-danger w-100 ms-2 px-2 px-md-3 py-2 disabled btn-danger-rounded",type:"button"},qe={"aria-label":"Page navigation example",class:"my-10"},ze={class:"pagination justify-content-center"},Re=["onClick"];function Ae(e,t,i,l,r,n){const u=D("BannerBlock"),b=D("router-link");return o(),c(p,null,[x(u),s("div",U,[s("nav",H,[s("ol",I,[s("li",V,[x(b,{to:"/",exact:"","active-class":"active-link"},{default:C(()=>[m(" 首頁 ")]),_:1})]),s("li",M,[r.selectedCategory!=="全部"?(o(),S(b,{key:0,exact:"","active-class":"active-link",to:{path:"/TouristPackage",query:{category:"全部",page:"1"}},onClick:t[0]||(t[0]=v(a=>n.filterProducts("全部"),["prevent"]))},{default:C(()=>[m(" 南部旅遊方案 ")]),_:1})):(o(),c("span",q," 南部旅遊方案 "))]),r.selectedCategory!=="全部"?(o(),c("li",z,[s("span",null,d(r.selectedCategory),1)])):w("",!0)])]),s("div",R,[s("div",A,[s("div",G,[s("div",O,[Y,s("ul",J,[(o(!0),c(p,null,_(n.filterCategory,(a,k)=>(o(),c("li",{class:"nav-item w-25 w-lg-100",key:k},[s("a",{class:y(["nav-link p-5 fs-5 link-color d-flex justify-content-center justify-content-lg-between",{"active-category":r.selectedCategory===a}]),href:"#","aria-current":"page",onClick:v(f=>n.filterProducts(a),["prevent"])},[m(d(a)+" ",1),s("span",Q,d(n.filterCateNum[a]),1),s("span",W,"("+d(n.filterCateNum[a])+")",1)],10,K)]))),128))])])]),s("div",X,[r.isLoading?(o(),c(p,{key:0},_(3,a=>s("div",{class:"card mb-4 card-att",key:a},$)),64)):(o(),c(p,{key:1},[r.status.loadingItem?(o(),c("div",ee,se)):(o(),c("div",ae,[(o(!0),c(p,null,_(n.filteredProducts,(a,k)=>(o(),c("div",{class:"card mb-4 card-att",key:k+123},[s("div",re,[s("div",oe,[s("span",ie,d(a.category),1),s("div",ce,[s("img",{src:a.imageUrl,class:"img-fluid",alt:a.title},null,8,ne)])]),s("div",le,[s("div",de,[s("div",he,[s("button",{class:"heart border-0",onClick:f=>n.toggleFavorite(a.id,a.category,a.title,a.imageUrl),type:"button"},[s("i",{class:y(["bi",{"bi-heart-fill":r.isFavorite[a.id],"bi-heart":!r.isFavorite[a.id]}]),style:{"font-size":"24px"}},null,2)],8,ge),s("h4",ue,d(a.title),1),s("div",pe,[s("span",fe,d(a.tag_2),1)]),s("div",_e,[s("div",ve,[(o(!0),c(p,null,_(r.newProductsDes,f=>(o(),c("div",{key:f.id},[f.id===a.id?(o(),c("div",ye,[(o(!0),c(p,null,_(f.descriptions,T=>(o(),c("p",{key:T},d(n.truncateContent(T,85)),1))),128))])):w("",!0)]))),128))]),s("div",me,[s("div",ke,[s("p",be," NT"+d(n.thousand(a.origin_price)),1),s("div",xe,[Ce,s("div",we,[r.currentDate<=a.endDate?(o(),c("p",Pe," 預約："+d(a.startDate)+" ~ "+d(a.endDate),1)):(o(),c("p",Te,"預約時間已截止")),r.currentDate<=a.endDate?(o(),c("p",De," 出遊："+d(a.goStartDate)+" ~ "+d(a.goEndDate),1)):(o(),c("p",Le,"已出遊完成"))]),s("p",Ne," NT"+d(n.thousand(a.price)),1)])])])]),s("div",Se,[r.currentDate<=a.endDate?(o(),c("p",Fe," 預約時間："+d(a.startDate)+" ~ "+d(a.endDate),1)):(o(),c("p",Be,"預約時間已截止")),r.currentDate<=a.endDate?(o(),c("p",Ee," 出遊時間："+d(a.goStartDate)+" ~ "+d(a.goEndDate),1)):(o(),c("p",je,"已出遊完成"))])]),s("div",Ue,[s("div",He,[x(b,{to:{name:"TouristSinglePackage",params:{category:a.category,title:a.title}},class:"btn-outline-square w-100 me-2 px-2 px-md-3"},{default:C(()=>[m("行程介紹")]),_:2},1032,["to"]),r.currentDate<=a.endDate?(o(),c("button",{key:0,class:"btn-square w-100 ms-2 px-2 px-md-3",onClick:f=>n.addToCart(a.id,e.quantity,a.price),type:"button"},[r.status.loadingItem2===a.id?(o(),c("span",Ve)):w("",!0),m(" 立即預約旅遊方案 ")],8,Ie)):(o(),c("button",Me," 預約時間截止 "))])])])])])]))),128)),s("nav",qe,[s("ul",ze,[s("li",{class:y(["page-item",{disabled:!r.currentPage||r.currentPage===1}])},[s("button",{class:"page-link page-link-radius-2",onClick:t[1]||(t[1]=v(a=>r.currentPage>1&&n.getProducts(r.currentPage-1),["prevent"]))}," 上一頁 ")],2),(o(!0),c(p,null,_(r.pageTotal,a=>(o(),c("li",{class:"page-item",key:`page-${a}`},[s("button",{class:y(["page-link page-link-0 rounded-0",{active:a===r.currentPage}]),onClick:v(k=>n.getProducts(a),["prevent"])},d(a),11,Re)]))),128)),s("li",{class:y(["page-item",{disabled:!r.currentPage||r.currentPage===r.pageTotal}])},[s("button",{class:"page-link page-link-radius",onClick:t[2]||(t[2]=v(a=>r.currentPage<r.pageTotal&&n.getProducts(r.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])]))],64))])])])])],64)}const Je=N(j,[["render",Ae],["__scopeId","data-v-6f312387"]]);export{Je as default};
