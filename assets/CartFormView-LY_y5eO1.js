import{U as I}from"./UserProductModal-rk1xXn7Y.js";import{C as D}from"./CartNavbar-UtKWdqi7.js";import{C as y}from"./collapse-0VZYrnLM.js";import{_ as x,c,a as t,b as m,d as f,t as u,f as i,v as k,F as g,h as w,i as n,B as M,w as U,r as _,o as h}from"./index-CXBFrQdm.js";const p="https://two024-south-json-server-vercel.onrender.com",E={components:{CartNavbar:D,UserProductModal:I},data(){return{cartsData:[],userCart:[],userId:"",isOpen:!1,headerCollapse:{},order:{},user:{name:"",email:"",tel:"",address:"",birthday:"",comment:"",shippingMethod:""},shippingMethod:["超商取貨","宅配"],total:0,productId:"",productTitle:"",cartDataId:"",ordersData:[]}},watch:{$route(){this.headerCollapse.hide()}},methods:{backPage(){this.$router.go(-1)},toggleOpen(){this.isOpen=!this.isOpen},forId(a,e){this.productId=a,this.productTitle=e,this.$refs.userProductModal.openModal()},getCart(){this.axios.get(`${p}/cartsData`).then(a=>{this.cartsData=a.data,this.cartsData.forEach(e=>{e.status===!1&&e.data.forEach(r=>{r.userId===this.userId&&this.userCart.push(r)})}),this.userCart.forEach(e=>{this.total+=e.final_total})}).catch(a=>{console.log(a)})},getCookie(a){const e=document.cookie.split(";");for(let r of e){const[l,o]=r.trim().split("=");if(l===a)return o}return null},thousand(a){return a!==void 0&&(a=a.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${a}`},getOderData(){this.axios.get(`${p}/order`).then(a=>{this.ordersData=a.data}).catch(a=>{console.log(a)})},orderData(){const a=this.ordersData.some(r=>r.user.cartDataId===this.cartDataId&&r.user.status===!1);console.log(this.cartDataId);let e=0;if(this.ordersData.forEach(r=>{r.user.cartDataId===this.cartDataId&&r.user.status===!1&&(e=r.id)}),a){const r={name:this.user.name,email:this.user.email,tel:this.user.tel,address:this.user.address,birthday:this.user.birthday,comment:this.user.comment,shippingMethod:this.user.shippingMethod,userId:this.userId,cartDataId:this.cartDataId,status:!1};this.axios.put(`${p}/order/${e}`,{user:r}).then(l=>{this.order=l.data}).catch(l=>{console.log(l)})}else{const r={name:this.user.name,email:this.user.email,tel:this.user.tel,address:this.user.address,birthday:this.user.birthday,comment:this.user.comment,shippingMethod:this.user.shippingMethod,userId:this.userId,cartDataId:this.cartDataId,status:!1};this.axios.post(`${p}/order`,{user:r}).then(l=>{this.order=l.data}).catch(l=>{console.log(l)})}}},mounted(){const a=this.getCookie("userId"),e=this.getCookie("cartDataId");this.userId=a*1,this.cartDataId=e*1,console.log(this.cartDataId),this.getCart(),this.getOderData(),this.headerCollapse=new y(this.$refs.headerCollapse,{toggle:!1})}},T={class:"container py-10 py-lg-30"},V={class:"row"},O={class:"col-md-6 mx-auto pb-5 pb-lg-15"},P={class:"mb-4"},N={class:"d-grid gap-2"},S=t("br",null,null,-1),B={key:0,class:"bi bi-chevron-down"},F={key:1,class:"bi bi-chevron-up"},j={class:"collapse",id:"collapseExample",ref:"headerCollapse"},q={class:"card card-body rounded-0"},L={class:"col-12 col-md-5 col-lg-4"},A=["src","alt"],z={class:"col-12 col-md-7 col-lg-8 d-flex flex-column justify-content-between"},G={class:"mt-4 mt-md-0 mb-4"},H={class:"mb-4"},J={class:"mb-4"},K={class:"mb-4"},Q=["onClick"],R={class:"row"},W={class:"col-12 col-md-6 mb-4"},X=t("h3",{class:"mb-4"},"訂單資料",-1),Y={class:"form-floating mb-4"},Z=t("label",{for:"floatingInput"},"姓名",-1),$={class:"form-floating mb-4"},tt=t("label",{for:"floatingTel"},"電話",-1),et={class:"form-floating mb-4"},st=t("label",{for:"floatingEmail"},"電子郵件",-1),ot={class:"form-floating mb-4"},at=t("label",{for:"floatingDate"},"生日",-1),rt={class:"form-floating"},lt=t("label",{for:"floatingTextarea2"},"備註",-1),dt={class:"col-12 col-md-6 mb-4"},it=t("h3",{class:"mb-4"},"運送資料",-1),nt={class:"form-floating mb-4"},ct=t("option",{selected:"",value:"",disabled:""},"選擇運送方式",-1),ut=t("option",{value:"超商取貨"},"超商取貨",-1),ht=t("option",{value:"宅配"},"宅配",-1),pt=[ct,ut,ht],mt=t("label",{for:"floatingSelect"},"運送方式",-1),ft={class:"form-floating mb-4"},_t=t("label",{for:"floatingAddress"},"住址",-1),gt={class:"d-flex justify-content-between"};function bt(a,e,r,l,o,d){const b=_("CartNavbar"),v=_("router-link"),C=_("UserProductModal");return h(),c(g,null,[t("div",T,[t("div",V,[t("div",O,[m(b)])]),t("div",P,[t("p",N,[t("button",{class:"btn btn-primary-600 border-top",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample",onClick:e[0]||(e[0]=(...s)=>d.toggleOpen&&d.toggleOpen(...s))},[f(" 總計："+u(d.thousand(o.total))+"元",1),S,f("購買清單 "),o.isOpen===!1?(h(),c("i",B)):(h(),c("i",F))])]),i(t("div",j,[t("div",q,[(h(!0),c(g,null,w(o.userCart,s=>(h(),c("div",{class:"row p-4 p-md-10",key:s.id},[t("div",L,[t("img",{src:s.product.imageUrl,alt:s.product.title,class:"img-fluid h-100"},null,8,A)]),t("div",z,[t("div",null,[t("h4",G,"套裝行程名稱："+u(s.product.title),1),t("h5",H,"單價："+u(d.thousand(s.product.price)),1),t("h5",J,"預約數量："+u(s.qty)+" 位",1),t("h5",K,"總計："+u(d.thousand(s.final_total)),1)]),t("div",null,[t("button",{type:"button",class:"btn-turquoise border-0 rounded-1",onClick:vt=>d.forId(s.product.id,s.product.title)}," 查看更多 ",8,Q)])])]))),128))])],512),[[k,o.isOpen]])]),t("div",R,[t("div",W,[X,t("div",Y,[i(t("input",{type:"text",class:"form-control rounded-1",id:"floatingInput",placeholder:"王小明","onUpdate:modelValue":e[1]||(e[1]=s=>o.user.name=s)},null,512),[[n,o.user.name]]),Z]),t("div",$,[i(t("input",{type:"tel",class:"form-control rounded-1",id:"floatingTel",placeholder:"tel","onUpdate:modelValue":e[2]||(e[2]=s=>o.user.tel=s)},null,512),[[n,o.user.tel]]),tt]),t("div",et,[i(t("input",{type:"email",class:"form-control rounded-1",id:"floatingEmail",placeholder:"name@example.com","onUpdate:modelValue":e[3]||(e[3]=s=>o.user.email=s)},null,512),[[n,o.user.email]]),st]),t("div",ot,[i(t("input",{type:"date",class:"form-control rounded-1",id:"floatingDate",placeholder:"2024/03/08","onUpdate:modelValue":e[4]||(e[4]=s=>o.user.birthday=s)},null,512),[[n,o.user.birthday]]),at]),t("div",rt,[i(t("textarea",{class:"form-control rounded-1",placeholder:"Leave a comment here",id:"floatingTextarea2",style:{height:"100px"},"onUpdate:modelValue":e[5]||(e[5]=s=>o.user.comment=s)},null,512),[[n,o.user.comment]]),lt])]),t("div",dt,[it,t("div",nt,[i(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.user.shippingMethod=s),class:"form-select rounded-1",id:"floatingSelect","aria-label":"Floating label select example"},pt,512),[[M,o.user.shippingMethod]]),mt]),t("div",ft,[i(t("input",{type:"text",class:"form-control rounded-1",id:"floatingAddress",placeholder:"縣市鄉鎮市區","onUpdate:modelValue":e[7]||(e[7]=s=>o.user.address=s)},null,512),[[n,o.user.address]]),_t])])]),t("div",gt,[t("a",{class:"btn-cerulean w-50 w-md-25 fs-5 mt-4 me-1",onClick:e[8]||(e[8]=(...s)=>d.backPage&&d.backPage(...s)),type:"button"},"上一步"),m(v,{class:"btn-square mt-4 fs-5 w-50 w-md-25",type:"button",to:"/cart/payList",onClick:d.orderData},{default:U(()=>[f("下一步")]),_:1},8,["onClick"])])]),m(C,{ref:"userProductModal",userCart:o.userCart,productId:o.productId,productTitle:o.productTitle},null,8,["userCart","productId","productTitle"])],64)}const xt=x(E,[["render",bt]]);export{xt as default};
