import{s as h}from"./sweetAlert-qsZBwJtF.js";import{_ as P,c as o,b as u,a as t,w as k,f as m,v as y,t as l,F as p,h as v,r as C,o as r,d as _,j as g,i as q,n as T}from"./index-RR-LHgYl.js";const f="https://two024-south-json-server-vercel.onrender.com",U={data(){return{category:"",packageTitle:"",products:[],newProductsContent:"",enabledProducts:[],carts:[],quantity:1,newQty:0,newCarts:[],cartId:null,bsOffcanvas:null,userId:"",token:"",currentDate:"",endDate:"",isDisabled:!1,cartsLength:0,isLoading:!1,status:{loadingItem:!1,loadingItem2:"",loadingItem3:"",loadingItem4:"",loadingItem5:""}}},created(){this.category=this.$route.params.category,this.packageTitle=this.$route.params.title},methods:{redirectToA(i){this.$router.push({path:"/TouristPackage",query:{category:i}})},checkDate(){var i=new Date,e={year:i.getFullYear(),month:i.getMonth()+1,date:i.getDate()},n=(e.month<10?"0":"")+e.month,d=(e.date<10?"0":"")+e.date,a=e.year+"-"+n+"-"+d;this.currentDate=a},getProducts(){this.axios.get(`${f}/products`).then(i=>{this.products=i.data,this.products.forEach(e=>{e.is_enabled===1&&e.title===this.packageTitle&&(this.enabledProducts.push(e),this.isLoading=!1)}),this.endDate=this.enabledProducts[0].endDate,this.getNewText()}).catch(()=>{this.isLoading=!1,h.threeLayerCheckType("error","取得產品資料失敗")})},thousand(i){return i!==void 0&&(i=i.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${i}`},getNewText(){const i={};this.enabledProducts.forEach(e=>{e.content&&e.content.split(";").forEach(d=>{const a=d.trim();a!==""&&(i[e.id]||(i[e.id]=[]),i[e.id].push(a))})});for(const e in i)i[e].length===0&&delete i[e];this.newProductsContent=Object.entries(i).map(([e,n])=>({id:e,content:n}))},addToCart(i,e=1,n,d=1){if(this.status.loadingItem3=i,!this.token)h.threeLayerCheckType("warning","請登入會員後，才能預約套裝行程");else{let a=!1;this.newCarts.forEach(c=>{c.productId===i&&c.id&&(a=!0,this.cartId=c.id)}),a?this.axios.put(`${f}/carts/${this.cartId}`,{productId:i,qty:e,price:n,total:e*n,userId:this.userId,final_total:e*n*d}).then(()=>{this.status.loadingItem3="",h.threeLayerCheckType("success","已更新預約人數"),this.getCart()}).catch(()=>{this.status.loadingItem3="",h.threeLayerCheckType("error","已更新預約人數失敗")}):this.axios.post(`${f}/carts`,{productId:i,qty:e,price:n,total:e*n,userId:this.userId,final_total:e*n*d}).then(()=>{this.status.loadingItem3="",h.threeLayerCheckType("success",`已預約${this.packageTitle}成功`),this.getCart()}).catch(()=>{this.status.loadingItem3="",h.threeLayerCheckType("error","預約失敗，再重新登入預約")})}},incrementQuantity(i,e){this.status.loadingItem2=i,this.quantity<e?(this.status.loadingItem2="",this.quantity+=1):(this.status.loadingItem2="",h.threeLayerCheckType("warning",`預約人數上限為${e}人`))},decrementQuantity(i){this.status.loadingItem4=i,this.quantity>1&&(this.status.loadingItem4="",this.quantity-=1)},checkMaxValue(i){this.quantity>i&&(this.quantity=i)},handlePlus(i){this.quantity=i++},saveCardId(){this.token?this.$router.push("/cart"):h.threeLayerCheckType("warning","請登入會員後，才能預約套裝行程")},getCart(){this.axios.get(`${f}/carts`).then(i=>{this.carts=i.data,this.carts.forEach(d=>{this.userId===d.userId&&this.newCarts.push(d)});const e=[],n=new Set;this.newCarts.forEach(d=>{n.has(d.productId)||(n.add(d.productId),e.push(d))}),this.newCarts=e,this.cartsLength=this.newCarts.length,this.$emitter.emit("updateCart",this.cartsLength)}).catch(()=>{h.threeLayerCheckType("error","取得購物車資料失敗")})},getCookie(i){const e=document.cookie.split(";");for(let n of e){const[d,a]=n.trim().split("=");if(d===i)return a}return null}},mounted(){this.isLoading=!0,this.getProducts(),this.getCart();const i=this.getCookie("userId"),e=this.getCookie("hexTokenU");this.userId=i*1,this.token=e,this.checkDate(),window.scrollTo(0,0)}},E={class:"container py-10 py-lg-30"},S={style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",class:"pb-5 pb-lg-15"},V={class:"breadcrumb mb-0 fs-5"},N={class:"breadcrumb-item"},j={class:"breadcrumb-item"},A={class:"breadcrumb-item"},Q={class:"breadcrumb-item"},B={class:"col-12 col-md-7 col-lg-9 my-8 my-md-0"},M={class:"d-flex"},F=t("div",{class:"w-5 d-none d-xl-flex"},[t("i",{class:"bi bi-geo-alt-fill position-relative fs-5"},[t("div",{class:"line"}),t("i",{class:"bi bi-arrow-down-circle-fill arrow"})])],-1),z={class:"w-100 w-xl-95 position-relative pe-0 pe-lg-5"},O=t("h4",{class:"d-flex"},[t("i",{class:"bi bi-geo-fill d-flex d-xl-none me-2 align-items-end"}),_("第一天 ")],-1),Y=t("ul",{class:"nav nav-underline nav-fill mb-4 w-100 w-lg-60",id:"pills-tab",role:"tablist"},[t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true"}," 早上 ")]),t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"pills-profile-tab","data-bs-toggle":"pill","data-bs-target":"#pills-profile",type:"button",role:"tab","aria-controls":"pills-profile","aria-selected":"false"}," 下午 ")])],-1),G={class:"tab-content card-att",id:"pills-tabContent"},H={class:"tab-pane fade show active",id:"pills-home",role:"tabpanel","aria-labelledby":"pills-home-tab",tabindex:"0"},J={class:"row"},K={class:"w-100 w-lg-60 mb-4"},R={class:"card-att-img card-att-img-2"},W=["src","alt"],X={class:"w-100 w-lg-40"},Z={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4"},I={class:"text-dark mb-4"},$={class:"tab-pane fade",id:"pills-profile",role:"tabpanel","aria-labelledby":"pills-profile-tab",tabindex:"0"},tt={class:"row"},st={class:"w-100 w-lg-60 mb-4"},et={class:"card-att-img card-att-img-2"},it=["src","alt"],at={class:"w-100 w-lg-40"},lt={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4"},nt={class:"text-dark"},ot={key:0},rt={class:"d-flex my-12"},dt=t("div",{class:"w-5 d-none d-xl-flex"},[t("i",{class:"bi bi-geo-alt-fill position-relative fs-5"},[t("div",{class:"line"}),t("i",{class:"bi bi-arrow-down-circle-fill arrow"})])],-1),ct={class:"w-100 w-xl-95 position-relative pe-0 pe-lg-5"},_t=t("h4",{class:"d-flex"},[t("i",{class:"bi bi-geo-fill d-flex d-xl-none me-2 align-items-end"}),_("第二天 ")],-1),ht=t("ul",{class:"nav nav-underline nav-fill mb-4 w-100 w-lg-60",id:"pills-tab",role:"tablist"},[t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home2",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true"}," 早上 ")]),t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"pills-profile-tab","data-bs-toggle":"pill","data-bs-target":"#pills-profile2",type:"button",role:"tab","aria-controls":"pills-profile","aria-selected":"false"}," 下午 ")])],-1),bt={class:"tab-content card-att",id:"pills-tabContent"},gt={class:"tab-pane fade show active",id:"pills-home2",role:"tabpanel","aria-labelledby":"pills-home-tab",tabindex:"0"},mt={class:"row"},pt={class:"w-100 w-lg-60 mb-4"},ft={class:"card-att-img card-att-img-2"},ut=["src","alt"],yt={class:"w-100 w-lg-40"},vt={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4"},wt={class:"text-dark mb-4"},xt={class:"tab-pane fade",id:"pills-profile2",role:"tabpanel","aria-labelledby":"pills-profile-tab",tabindex:"0"},kt={class:"row"},Ct={class:"w-100 w-lg-60 mb-4"},Tt={class:"card-att-img card-att-img-2"},Dt=["src","alt"],Lt={class:"w-lg-40"},Pt={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4"},qt={class:"text-dark"},Ut={key:1},Et={class:"d-flex my-12"},St=t("div",{class:"w-5 d-none d-xl-flex"},[t("i",{class:"bi bi-geo-alt-fill position-relative fs-5"},[t("div",{class:"line"}),t("i",{class:"bi bi-arrow-down-circle-fill arrow"})])],-1),Vt={class:"w-100 w-xl-95 position-relative pe-0 pe-lg-5"},Nt=t("h4",{class:"d-flex"},[t("i",{class:"bi bi-geo-fill d-flex d-xl-none me-2 align-items-end"}),_("第三天 ")],-1),jt=t("ul",{class:"nav nav-underline nav-fill mb-4 w-100 w-lg-60",id:"pills-tab",role:"tablist"},[t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home2",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true"}," 早上 ")]),t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"pills-profile-tab","data-bs-toggle":"pill","data-bs-target":"#pills-profile2",type:"button",role:"tab","aria-controls":"pills-profile","aria-selected":"false"}," 下午 ")])],-1),At={class:"tab-content card-att",id:"pills-tabContent"},Qt={class:"tab-pane fade show active",id:"pills-home2",role:"tabpanel","aria-labelledby":"pills-home-tab",tabindex:"0"},Bt={class:"row"},Mt={class:"w-100 w-lg-60 mb-4"},Ft={class:"card-att-img card-att-img-2"},zt=["src","alt"],Ot={class:"w-100 w-lg-40"},Yt={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4"},Gt={class:"text-dark mb-4"},Ht={class:"tab-pane fade",id:"pills-profile2",role:"tabpanel","aria-labelledby":"pills-profile-tab",tabindex:"0"},Jt={class:"row"},Kt={class:"w-100 w-lg-60 mb-4"},Rt={class:"card-att-img card-att-img-2"},Wt=["src","alt"],Xt={class:"w-lg-40"},Zt={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4"},It={class:"text-dark"},$t={class:"col-12 col-md-5 col-lg-3"},ts={class:"d-flex mb-4"},ss={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},es={class:"fs-3 fs-sm-4 fs-xl-3 mb-6 text-primary-700 fw-bold"},is=t("span",{class:"fs-4 fs-sm-5 fs-xl-4 mb-2 border-bottom border-primary-400 border-3 text-primary-600"},[t("i",{class:"bi bi-person-walking me-2"}),_("景點行程 ")],-1),as={class:"mt-2 mb-6"},ls={class:"d-flex mb-4 flex-column mb-6"},ns=t("h5",{class:"mb-2"},[t("span",{class:"fs-4 fs-sm-5 fs-xl-4 mb-2 border-bottom border-primary-400 border-3 text-primary-600"},[t("i",{class:"bi bi-calendar-plus me-2"}),_("預約期間 ")])],-1),os={key:0,class:"mt-2"},rs={key:1,class:"mt-2 text-danger"},ds={class:"d-flex mb-4 flex-column"},cs=t("h5",{class:"mb-2"},[t("span",{class:"fs-4 fs-sm-5 fs-xl-4 mb-2 border-bottom border-primary-400 border-3 text-primary-600"},[t("i",{class:"bi bi-car-front-fill me-2"}),_("出發時間 ")])],-1),_s={class:"mt-2"},hs={class:"d-flex justify-content-between mb-4 align-items-end"},bs={class:"fs-4 fs-lg-5 text-decoration-line-through text-end"},gs={class:"d-flex flex-sm-column align-items-end justify-content-end"},ms=t("p",{class:"fs-6 text-danger fw-bold d-none d-sm-block"},"促銷價",-1),ps={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},fs={class:"d-flex mb-2"},us=["disabled","onClick"],ys={key:0,class:"spinner-border spinner-grow-sm",role:"status"},vs=t("i",{class:"bi bi-dash-lg"},null,-1),ws=["disabled"],xs=["onClick"],ks={key:0,class:"spinner-border spinner-grow-sm",role:"status"},Cs=t("i",{class:"bi bi-plus-lg"},null,-1),Ts=t("button",{type:"button",class:"btn btn-outline-dark rounded-0 ms-2"},[t("i",{class:"bi bi-heart"})],-1),Ds={class:"mb-2"},Ls={class:"text-danger"},Ps={key:0,class:"mb-5"},qs=t("span",{class:"text-danger"},"0",-1),Us={class:"text-danger"},Es=["onClick"],Ss={key:0,class:"spinner-border spinner-grow-sm",role:"status"},Vs={key:2,class:"btn btn-danger w-100 fs-5 mb-4 disabled btn-danger-rounded",type:"button"};function Ns(i,e,n,d,a,c){const D=C("VueLoading"),w=C("router-link");return r(),o(p,null,[u(D,{active:a.isLoading,class:"text-center","z-index":1060},null,8,["active"]),t("div",E,[t("nav",S,[t("ol",V,[t("li",N,[u(w,{to:"/",exact:"","active-class":"active-link"},{default:k(()=>[_(" 首頁 ")]),_:1})]),t("li",j,[u(w,{to:"/TouristPackage",exact:"","active-class":"active-link"},{default:k(()=>[_(" 南部旅遊方案 ")]),_:1})]),t("li",A,[m(t("a",{onClick:e[0]||(e[0]=s=>c.redirectToA("台南")),class:"navbar-brand"},"台南",512),[[y,a.category==="台南"]]),m(t("a",{onClick:e[1]||(e[1]=s=>c.redirectToA("嘉義")),class:"navbar-brand"},"嘉義",512),[[y,a.category==="嘉義"]]),m(t("a",{onClick:e[2]||(e[2]=s=>c.redirectToA("高雄")),class:"navbar-brand"},"高雄",512),[[y,a.category==="高雄"]])]),t("li",Q,l(a.packageTitle),1)])]),(r(!0),o(p,null,v(a.enabledProducts,s=>(r(),o("div",{class:"row h-100 flex-wrap-reverse flex-md-nowrap",key:s.id},[t("div",B,[t("div",M,[F,t("div",z,[O,Y,t("div",G,[t("div",H,[t("div",J,[t("div",K,[t("div",R,[t("img",{src:s.imagesUrl[0],class:"img-fluid pb-4 pb-lg-0",alt:s.title},null,8,W)])]),t("div",X,[t("h4",Z,l(s.itinerary_data[0].itinerary_first_day_am_title),1),t("p",I,l(s.itinerary_data[0].itinerary_first_day_am_content),1)])])]),t("div",$,[t("div",tt,[t("div",st,[t("div",et,[t("img",{src:s.imagesUrl[1],class:"img-fluid pb-4 pb-lg-0",alt:s.title},null,8,it)])]),t("div",at,[t("h4",lt,l(s.itinerary_data[0].itinerary_first_day_pm_title),1),t("p",nt,l(s.itinerary_data[0].itinerary_first_day_pm_content),1)])])])])])]),s.itinerary_data.length>1?(r(),o("div",ot,[t("div",rt,[dt,t("div",ct,[_t,ht,t("div",bt,[t("div",gt,[t("div",mt,[t("div",pt,[t("div",ft,[t("img",{src:s.imagesUrl[2],class:"img-fluid pb-4 pb-lg-0",alt:s.title},null,8,ut)])]),t("div",yt,[t("h4",vt,l(s.itinerary_data[1].itinerary_second_day_am_title),1),t("p",wt,l(s.itinerary_data[1].itinerary_second_day_am_content),1)])])]),t("div",xt,[t("div",kt,[t("div",Ct,[t("div",Tt,[t("img",{src:s.imagesUrl[3],class:"img-fluid pb-4 pb-lg-0",alt:s.title},null,8,Dt)])]),t("div",Lt,[t("h4",Pt,l(s.itinerary_data[1].itinerary_second_day_pm_title),1),t("p",qt,l(s.itinerary_data[1].itinerary_second_day_pm_content),1)])])])])])])])):g("",!0),s.itinerary_data.length>2?(r(),o("div",Ut,[t("div",Et,[St,t("div",Vt,[Nt,jt,t("div",At,[t("div",Qt,[t("div",Bt,[t("div",Mt,[t("div",Ft,[t("img",{src:s.imagesUrl[4],class:"img-fluid pb-4 pb-lg-0",alt:s.title},null,8,zt)])]),t("div",Ot,[t("h4",Yt,l(s.itinerary_data[2].itinerary_third_day_am_title),1),t("p",Gt,l(s.itinerary_data[2].itinerary_third_day_am_content),1)])])]),t("div",Ht,[t("div",Jt,[t("div",Kt,[t("div",Rt,[t("img",{src:s.imagesUrl[5],class:"img-fluid pb-4 pb-lg-0",alt:s.title},null,8,Wt)])]),t("div",Xt,[t("h4",Zt,l(s.itinerary_data[2].itinerary_third_day_pm_title),1),t("p",It,l(s.itinerary_data[2].itinerary_third_day_pm_content),1)])])])])])])])):g("",!0)]),t("div",$t,[t("div",ts,[t("span",ss,l(a.category),1)]),t("h2",es,l(a.packageTitle),1),is,t("div",as,[(r(!0),o(p,null,v(a.newProductsContent,(b,L)=>(r(),o("div",{key:L+123},[(r(!0),o(p,null,v(b.content,x=>(r(),o("p",{key:x},l(x),1))),128))]))),128))]),t("div",ls,[ns,a.currentDate<=s.endDate?(r(),o("h6",os,l(s.startDate)+" 至 "+l(s.endDate),1)):(r(),o("h5",rs,"預約時間已截止"))]),t("div",ds,[cs,t("h6",_s,l(s.goStartDate)+" 至 "+l(s.goEndDate),1)]),t("div",hs,[t("p",bs," NT"+l(c.thousand(s.origin_price)),1),t("div",gs,[ms,t("p",ps," NT"+l(c.thousand(s.price)),1)])]),t("div",fs,[t("button",{class:"btn btn-outline-dark rounded-0",type:"button",disabled:a.quantity===1,onClick:b=>c.decrementQuantity(s.id)},[a.status.loadingItem4===s.id?(r(),o("span",ys)):g("",!0),vs],8,us),m(t("input",{min:"1",max:"10",type:"number",disabled:a.quantity>s.max_travelers,class:"form-control text-center rounded-0 border border-dark","onUpdate:modelValue":e[3]||(e[3]=b=>a.quantity=b),readonly:""},null,8,ws),[[q,a.quantity]]),t("button",{class:"btn btn-outline-dark rounded-0",type:"button",onClick:b=>c.incrementQuantity(s.id,s.max_travelers)},[a.status.loadingItem2===s.id?(r(),o("span",ks)):g("",!0),Cs],8,xs),Ts]),t("h6",Ds,[_(" 注意： "),t("span",Ls," 至少3位成團，最多"+l(s.max_travelers)+"位出遊 ",1)]),a.currentDate<=s.endDate?(r(),o("h6",Ps,[_(" 目前已有 "),qs,_(" 位預約，剩 "),t("span",Us,l(s.max_travelers),1),_(" 位可預約 ")])):g("",!0),a.currentDate<=a.endDate?(r(),o("button",{key:1,class:T(["btn-square w-100 fs-5 mb-4",{"disabled-btn":a.currentDate>a.endDate}]),type:"button",onClick:b=>c.addToCart(s.id,a.quantity,s.price)},[a.status.loadingItem3===s.id?(r(),o("span",Ss)):g("",!0),_(" 預約套裝行程 ")],10,Es)):(r(),o("button",Vs," 預約時間截止 ")),t("button",{class:T(["btn-square fs-5 w-100",{"disabled-btn":a.currentDate>a.endDate||a.newCarts.length===0}]),type:"button",onClick:e[4]||(e[4]=(...b)=>c.saveCardId&&c.saveCardId(...b))}," 直接結帳 ",2)])]))),128))])],64)}const Qs=P(U,[["render",Ns]]);export{Qs as default};
