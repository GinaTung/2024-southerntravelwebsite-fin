import{_ as x,c,F as _,h as p,e as k,o as n,a as e,t as d,j as m,b,w as v,d as C,r as w}from"./index-ZsUpPqry.js";const h="https://two024-south-json-server-vercel.onrender.com",y={data(){return{text:"南部旅遊方案",products:[],user:"",newProductsDes:"",enabledProducts:[],searchChiayi:[],serchTainan:[],searchKaohsiung:[],newProductsContent:"",enabledProducts:[],carts:[],quantity:1,newQty:"",newCarts:[],cartId:null,userId:"",token:""}},methods:{getProducts(){this.axios.get(`${h}/products`).then(s=>{this.products=s.data,this.products.forEach(t=>{t.is_enabled===1&&this.enabledProducts.push(t)}),this.getNewText()}).catch(s=>{alert(`${s.message}`)})},thousand(s){return s!==void 0&&(s=s.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${s}`},truncateContent(s,t){return s&&s.length>t?s.substring(0,t)+"...":s},getNewText(){const s={};this.products.forEach(t=>{t.description&&t.description.split(";").forEach(l=>{const r=l.trim();s[t.id]||(s[t.id]=[]),s[t.id].push(r)})}),this.newProductsDes=Object.entries(s).map(([t,i])=>({id:t,descriptions:i}))},searchProducts(){this.axios.get(`${h}/products?category=嘉義`).then(s=>{this.products=s.data,this.products.forEach(t=>{t.is_enabled===1&&this.searchChiayi.push(t)})}).catch(s=>{alert(`${s.message}`)})},addToCart(s,t=1,i){if(!this.token)alert("請登入會員後，才能預約套裝行程");else{let l=!1,r=1;this.newCarts.forEach(o=>{o.productId===s&&o.id&&(l=!0,this.cartId=o.id)}),l?this.axios.put(`${h}/carts/${this.cartId}`,{productId:s,qty:t,price:i,total:t*i,userId:this.userId,final_total:t*i*r}).then(o=>{alert("已更新預約人數"),this.getCart()}).catch(o=>{alert("更新預約人數失敗")}):this.axios.post(`${h}/carts`,{productId:s,qty:t,price:i,total:t*i,userId:this.userId,final_total:t*i*r}).then(o=>{alert("已預約成功"),this.getCart()}).catch(o=>{alert("預約失敗，再重新登入預約")})}},getCart(){this.axios.get(`${h}/carts`).then(s=>{this.carts=s.data,this.carts.forEach(t=>{t.userId===this.userId&&this.newCarts.push(t)})}).catch(s=>{alert("取得購物車資料失敗")})},getCookie(s){const t=document.cookie.split(";");for(let i of t){const[l,r]=i.trim().split("=");if(l===s)return r}return null}},mounted(){this.searchProducts(),this.getProducts();const s=this.getCookie("userId"),t=this.getCookie("hexTokenU");this.userId=s*1,this.token=t}},T={class:"row g-0"},P={class:"col-md-4"},N={class:"tag text-white"},E={class:"card-att-img h-100"},$=["src","alt"],S={class:"col-md-8"},V={class:"card h-100 border-0 bg-transparent"},j={class:"card-body px-3 px-md-4"},D=e("div",{class:"heart3"},[e("i",{class:"bi bi-heart heart-click","data-heartStatus":"false"})],-1),B={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-8"},U={class:"d-flex mb-4"},F={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},K={class:"row"},M={class:"col-12 col-sm-8 my-2"},O={key:0},Q={class:"col-12 col-sm-4"},z={class:"d-flex flex-column"},A={class:"fs-4 fs-lg-5 fs-xl-4 text-decoration-line-through text-end"},G={class:"d-flex flex-sm-column align-items-end justify-content-end"},H=e("p",{class:"text-danger fw-bold d-none d-sm-block"},"促銷價",-1),I={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},J=e("div",{class:"col-12"},null,-1),L={class:"card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4"},R={class:"d-flex align-items-end"},W=["onClick"],X=k('<nav aria-label="Page navigation example " class="my-10"><ul class="pagination justify-content-center"><li class="page-item disabled"><a class="page-link page-link-radius-2">Previous</a></li><li class="page-item"><a class="page-link page-link-0 rounded-0" href="#">1</a></li><li class="page-item"><a class="page-link page-link-0 rounded-0" href="#">2</a></li><li class="page-item"><a class="page-link page-link-0 rounded-0" href="#">3</a></li><li class="page-item"><a class="page-link page-link-radius" href="#">Next</a></li></ul></nav>',1);function Y(s,t,i,l,r,o){const f=w("router-link");return n(),c(_,null,[(n(!0),c(_,null,p(r.searchChiayi,a=>(n(),c("div",{class:"card mb-4 card-att",key:a.id},[e("div",T,[e("div",P,[e("span",N,d(a.category),1),e("div",E,[e("img",{src:a.imageUrl,class:"card-img-top img-fluid",alt:a.title},null,8,$)])]),e("div",S,[e("div",V,[e("div",j,[D,e("h4",B,d(a.title),1),e("div",U,[e("span",F,d(a.tag_2),1)]),e("div",K,[e("div",M,[(n(!0),c(_,null,p(r.newProductsDes,u=>(n(),c("div",{key:u.id},[u.id===a.id?(n(),c("div",O,[(n(!0),c(_,null,p(u.descriptions,g=>(n(),c("p",{key:g},d(o.truncateContent(g,85)),1))),128))])):m("",!0)]))),128))]),e("div",Q,[e("div",z,[e("p",A,"NT"+d(o.thousand(a.origin_price)),1),e("div",G,[H,e("p",I,"NT"+d(o.thousand(a.price)),1)])])])]),J]),e("div",L,[e("div",R,[b(f,{to:{name:"TouristSinglePackage",params:{category:a.category,title:a.title}},class:"btn-outline-square w-100 me-2 px-2 px-md-3",type:"button"},{default:v(()=>[C("行程介紹")]),_:2},1032,["to"]),e("a",{class:"btn-square w-100 ms-2 px-2 px-md-3",onClick:u=>o.addToCart(a.id,r.quantity,a.price),type:"button"},"預約套裝行程",8,W)])])])])])]))),128)),X],64)}const q=x(y,[["render",Y]]);export{q as default};
