import{B as T}from"./BannerBlock-qPLDnGQ7.js";import{s as n}from"./sweetAlert-3mmwl4KR.js";import{_ as P,c as l,b as v,a as s,w as m,g as A,A as p,t as h,j as L,F as u,h as b,n as y,r as C,o,d as k,e as F}from"./index-jP5mHpEK.js";const g="https://two024-south-json-server-vercel.onrender.com",B={components:{BannerBlock:T},data(){return{allAttractions:[],enabledAttractions:[],searchChiayi:[],serchTainan:[],searchKaohsiung:[],fullPath:"",currentURL:"",selectedCategory:"全部",currentPage:1,limitPage:6,pageTotal:0,attractionsCategory:[],status:{loadingItem:!1},category:"全部",heartData:[],isFavorite:{},userId:"",token:"",isLoading:!1}},computed:{filterCategory(){const e=this.attractionsCategory.map(c=>c.category),t=[...new Set(e)];return t.unshift("全部"),t},filterCateNum(){const e={};return this.attractionsCategory.forEach(t=>{e[t.category]?e[t.category]+=1:e[t.category]=1}),e.全部=this.attractionsCategory.length,e},filteredProducts(){return this.selectedCategory==="全部"||!this.selectedCategory?this.enabledAttractions:this.enabledAttractions.filter(e=>e.category===this.selectedCategory)}},watch:{$route(e,t){this.currentURL=e.fullPath,this.$root.navigatedFromHeader&&e.fullPath!=="/TouristAttractions"&&(this.selectedCategory="全部",this.status.loadingItem=!0,this.getAttractions(),this.$root.navigatedFromHeader=!1)}},created(){this.category=this.$route.query.category,this.selectedCategory=this.category,this.getAttractions()},methods:{getHeartData(){this.axios.get(`${g}/hearts`).then(e=>{e.data.forEach(t=>{t.userId===this.userId&&t.tag==="旅遊景點"&&(this.isFavorite[t.product]=!0)})}).catch(e=>{n.threeLayerCheckType("error","取得愛心收藏資料失敗")})},toggleFavorite(e,t,c){this.token?this.axios.get(`${g}/hearts`).then(d=>{const r=d.data.find(i=>i.product===e&&i.userId===this.userId&&i.tag==="旅遊景點");r?this.axios.delete(`${g}/hearts/${r.id}`).then(i=>{this.isFavorite[e]=!1,n.threeLayerCheckType("success",`取消收藏 ${c} 成功`),this.getHeartData()}).catch(i=>{n.threeLayerCheckType("error","取消收藏資料失敗")}):this.axios.post(`${g}/hearts`,{product:e,category:t,title:c,userId:this.userId,tag:"旅遊景點"}).then(i=>{this.isFavorite[e]=!0,n.threeLayerCheckType("success",`已加入收藏 ${c} 成功`),this.getHeartData()}).catch(i=>{n.threeLayerCheckType("error","收藏資料失敗")})}).catch(d=>{n.threeLayerCheckType("error","取得愛心收藏資料失敗")}):n.threeLayerCheckType("warning","請登入會員後，才能加入收藏")},getAttractions(e=1){this.axios.get(`${g}/attractions`).then(t=>{this.attractionsCategory=t.data.filter(c=>c.is_enabled===1)}).catch(t=>{n.threeLayerCheckType("error","取得景點資料失敗")}),this.selectedCategory==="全部"||!this.selectedCategory?this.axios.get(`${g}/attractions?_limit=${this.limitPage}&_page=${e}`).then(t=>{var c=parseInt(t.headers["x-total-count"]);this.pageTotal=Math.ceil(c/this.limitPage),this.currentPage=e,this.allAttractions=t.data,this.enabledAttractions=this.allAttractions.filter(d=>d.is_enabled===1),this.isLoading=!1,this.status.loadingItem=!1,this.$router.push({path:"/TouristAttractions",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(t=>{n.threeLayerCheckType("error","取得全部景點資料失敗")}):this.axios.get(`${g}/attractions?category=${this.selectedCategory}&_limit=${this.limitPage}&_page=${e}`).then(t=>{var c=parseInt(t.headers["x-total-count"]);this.pageTotal=Math.ceil(c/this.limitPage),this.currentPage=e,this.allAttractions=t.data,this.enabledAttractions=this.allAttractions.filter(d=>d.is_enabled===1),this.isLoading=!1,this.status.loadingItem=!1,this.$router.push({path:"/TouristAttractions",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(t=>{n.threeLayerCheckType("error","取得區域景點資料失敗")})},filterProducts(e){this.selectedCategory=e,this.status.loadingItem=!0,this.getAttractions()},truncateContent(e,t){return e&&e.length>t?e.substring(0,t)+"...":e},getCookie(e){const t=document.cookie.split(";");for(let c of t){const[d,r]=c.trim().split("=");if(d===e)return r}return null}},mounted(){const e=this.getCookie("userId"),t=this.getCookie("hexTokenU");this.userId=e*1,this.token=t,this.getAttractions(),this.getHeartData(),window.scrollTo(0,0),this.isLoading=!0,this.fullPath=this.$route.fullPath}},N={class:"container py-10 py-lg-30"},D={style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",class:"pb-5 pb-lg-15"},j={class:"breadcrumb mb-0 fs-5"},H={class:"breadcrumb-item"},V={class:"breadcrumb-item","aria-current":"page"},q={key:1},I={key:0,class:"breadcrumb-item","aria-current":"page"},S={class:"tourist-list"},U={class:"row"},E={class:"col-12 col-md-3 mb-5 mb-md-6 mb-lg-0 d-none d-lg-flex"},M={class:"border-1 border w-100 rounded-1 h-100"},$=s("p",{class:"fs-4 p-5 bg-primary-500 text-white"},"地區篩選",-1),z={class:"nav flex-column"},R=["onClick"],G={class:"col-12 col-lg-9"},K={key:0,class:"row g-3"},J=F('<div class="card card-att h-100"><span class="tag text-white placeholder-glow"></span><button class="heart border-0"><i class="bi bi-heart"></i></button><img src="https://raw.githubusercontent.com/GinaTung/2024-southerntravelwebsite-fin/dev/public/products/duck.jpg" class="img-fluid opacity-25" alt="Placeholder Image"><div class="card-body"><span class="placeholder w-60"></span><div class="col-12 placeholder-glow"><span class="placeholder w-100"></span><span class="placeholder w-100"></span><span class="placeholder w-100"></span><span class="placeholder w-100"></span></div></div><div class="card-footer text-end border-0 pt-0 pb-3 placeholder-glow"><div class="d-flex justify-content-end"><span class="placeholder w-25"></span></div></div></div>',1),O=[J],Q={key:0,class:"text-center",style:{margin:"150px"}},W=s("div",{class:"spinner-border",role:"status",style:{width:"3rem",height:"3rem",color:"#43b8bd"}},[s("span",{class:"visually-hidden"},"Loading...")],-1),X=[W],Y={key:1},Z={class:"row g-3"},tt={class:"card card-att h-100"},et={class:"tag text-white"},st={class:"card-att-img"},at=["src"],rt=["onClick"],it={style:{transform:"rotate(0)"}},ot={class:"card-body"},ct={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title stretched-link"},lt={class:"card-text card-font-truncate card-body-att"},nt={class:"card-footer text-end border-0"},dt={"aria-label":"Page navigation example",class:"my-10"},ht={class:"pagination justify-content-center"},gt=["onClick"];function ut(e,t,c,d,r,i){const w=C("BannerBlock"),_=C("router-link");return o(),l(u,null,[v(w),s("div",N,[s("nav",D,[s("ol",j,[s("li",H,[v(_,{to:"/",exact:"","active-class":"active-link"},{default:m(()=>[k("首頁")]),_:1})]),s("li",V,[r.selectedCategory!=="全部"?(o(),A(_,{key:0,exact:"","active-class":"active-link",to:{path:"/TouristAttractions",query:{category:"全部",page:"1"}},onClick:t[0]||(t[0]=p(a=>i.filterProducts("全部"),["prevent"]))},{default:m(()=>[k(" 南部旅遊景點 ")]),_:1})):(o(),l("span",q," 南部旅遊景點 "))]),r.selectedCategory!=="全部"?(o(),l("li",I,[s("span",null,h(r.selectedCategory),1)])):L("",!0)])]),s("div",S,[s("div",U,[s("div",E,[s("div",M,[$,s("ul",z,[(o(!0),l(u,null,b(i.filterCategory,(a,f)=>(o(),l("li",{class:"nav-item",key:f},[s("a",{class:y(["nav-link p-5 fs-5 link-color d-flex justify-content-between",{"active-category":r.selectedCategory===a}]),href:"#","aria-current":"page",onClick:p(x=>i.filterProducts(a),["prevent"])},[k(h(a)+" ",1),s("span",null,h(i.filterCateNum[a]),1)],10,R)]))),128))])])]),s("div",G,[r.isLoading?(o(),l("div",K,[(o(),l(u,null,b(3,a=>s("div",{key:a,class:"col-12 col-md-6 col-lg-4"},O)),64))])):(o(),l(u,{key:1},[r.status.loadingItem?(o(),l("div",Q,X)):(o(),l("div",Y,[s("div",Z,[(o(!0),l(u,null,b(i.filteredProducts,(a,f)=>(o(),l("div",{class:"col-12 col-md-6 col-lg-4",key:f+123},[s("div",tt,[s("span",et,h(a.category),1),s("div",st,[s("img",{src:a.imageUrl,class:"img-fluid",alt:"attractionItem.title"},null,8,at)]),s("button",{class:"heart border-0",onClick:x=>i.toggleFavorite(a.id,a.category,a.title),type:"button"},[s("i",{class:y(["bi",{"bi-heart-fill":r.isFavorite[a.id],"bi-heart":!r.isFavorite[a.id]}]),style:{"font-size":"24px"}},null,2)],8,rt),s("div",it,[s("div",ot,[v(_,{to:{name:"TouristSingleAttraction",params:{category:a.category,title:a.title}}},{default:m(()=>[s("h4",ct,h(a.title),1)]),_:2},1032,["to"]),s("p",lt,h(i.truncateContent(a.description,65)),1)]),s("div",nt,[v(_,{to:{name:"TouristSingleAttraction",params:{category:a.category,title:a.title}},class:"fs-5 text-primary-500"},{default:m(()=>[k("more")]),_:2},1032,["to"])])])])]))),128)),s("nav",dt,[s("ul",ht,[s("li",{class:y(["page-item",{disabled:!r.currentPage||r.currentPage===1}])},[s("button",{class:"page-link page-link-radius-2",onClick:t[1]||(t[1]=p(a=>r.currentPage>1&&i.getAttractions(r.currentPage-1),["prevent"]))}," 上一頁 ")],2),(o(!0),l(u,null,b(r.pageTotal,a=>(o(),l("li",{class:"page-item",key:`page-${a}`},[s("button",{class:y(["page-link page-link-0 rounded-0",{active:a===r.currentPage}]),onClick:p(f=>i.getAttractions(a),["prevent"])},h(a),11,gt)]))),128)),s("li",{class:y(["page-item",{disabled:!r.currentPage||r.currentPage===r.pageTotal}])},[s("button",{class:"page-link page-link-radius",onClick:t[2]||(t[2]=p(a=>r.currentPage<r.pageTotal&&i.getAttractions(r.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])])]))],64))])])])])],64)}const ft=P(B,[["render",ut]]);export{ft as default};
