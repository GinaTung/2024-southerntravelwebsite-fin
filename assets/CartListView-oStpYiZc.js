import{C as x}from"./CartNavbar-6vTgcsfI.js";import{_ as y,c as l,a as t,b,j as C,F as k,h as m,d as _,t as u,w as D,r as f,o as i,f as w,i as v}from"./index-ZsUpPqry.js";const r="https://two024-south-json-server-vercel.onrender.com",I={components:{CartNavbar:x},data(){return{userId:"",products:[],enabledProducts:[],carts:[],userCarts:[],userProductId:[],cartsData:[],isCartProductsFetched:!1,isGetProductsTriggered:!1,isGetCartsTriggered:!1,quantity:"",cartIdData:[],resData:[]}},methods:{thousand(a){return a!==void 0&&(a=a.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${a}`},getProducts(){this.axios.get(`${r}/products`).then(a=>{this.products=a.data,this.products.forEach(c=>{c.is_enabled===1&&this.enabledProducts.push(c)});let e=0;this.userCarts.forEach(c=>{const s=c.productId,d=this.enabledProducts.find(p=>p.id===s);d&&(c.product=d,e+=c.final_total,this.cartsData.push(c))}),this.cartsData.total=e;let n=1;this.cartsData.final_total=e*n}).catch(a=>{alert(`${a.message}`)})},getCarts(){this.axios.get(`${r}/carts`).then(a=>{this.carts=a.data,this.carts.forEach(e=>{e.userId===this.userId&&this.userCarts.push(e)}),this.getProducts()}).catch(a=>{alert(`${a.message}`)})},incrementQuantity(a,e,n){e<10?(e+=1,this.axios.patch(`${r}/carts/${a}`,{qty:e,price:n,total:e*n,final_total:e*n*1}).then(s=>{console.log(s),this.$router.go(0)}).catch(s=>{alert("取得購物車資料失敗")})):alert("預約人數上限為10人")},decrementQuantity(a,e,n){e>1&&(e-=1,this.axios.patch(`${r}/carts/${a}`,{qty:e,price:n,total:e*n,final_total:e*n*1}).then(s=>{console.log(s),this.$router.go(0)}).catch(s=>{alert("更新購物車資料失敗")}))},deleteCart(a,e){this.axios.delete(`${r}/carts/${a}`).then(n=>{console.log(n),alert(`已刪除${e}`),this.$router.go(0)}).catch(n=>{alert("刪除購物車資料失敗")})},back(){this.$router.back()},getCookie(a){const e=document.cookie.split(";");for(let n of e){const[c,s]=n.trim().split("=");if(c===a)return s}return null},getCartSData(){this.axios.get(`${r}/cartsData`).then(a=>{this.cartIdData=a.data})},saveCartData(a,e){const n=this.cartIdData.some(s=>s.userId===this.userId&&s.status===!1);console.log(n);let c=0;this.cartIdData.forEach(s=>{s.userId===this.userId&&s.status===!1&&(c=s.id)}),console.log(c),n&&c!==0?this.axios.put(`${r}/cartsData/${c}`,{data:this.cartsData,total:e,final_total:a,status:!1,userId:this.userId,orderStatus:!1,orderStatus:!1}).then(s=>{document.cookie=`cartDataId=${c}`,console.log("s"),this.getCartSData()}).catch(s=>{console.log(s),alert("更新購物車資料失敗")}):this.axios.post(`${r}/cartsData`,{data:this.cartsData,total:e,final_total:a,status:!1,userId:this.userId,orderStatus:!1}).then(s=>{console.log(s.data.id),document.cookie=`cartDataId=${s.data.id}`,this.getCartSData()}).catch(s=>{console.log(s),alert("儲存購物車資料失敗")})}},mounted(){const a=this.getCookie("userId");this.userId=a*1,this.getCarts(),this.getCartSData()}},$={class:"container py-10 py-lg-30"},P={class:"row"},S={class:"col-md-6 mx-auto pb-5 pb-lg-15"},N={class:"table-responsive"},V={class:"table align-middle table-rwd"},E=t("tr",{class:"tr-only-hide"},[t("th",{style:{width:"100px"}}),t("th",{style:{width:"170px"}},"圖片"),t("th",{style:{width:"170px"}},"行程名稱"),t("th",{style:{width:"170px"}},"數量/單位"),t("th",{style:{width:"100px"},class:"text-end"},"單價"),t("th",{class:"text-end",style:{width:"100px"}},"小計")],-1),T={key:0,class:"d-md-none"},B=t("th",{style:{width:"80px"}},null,-1),F=t("th",{style:{width:"170px"}},"圖片",-1),Q=t("th",{style:{width:"170px"}},"行程名稱",-1),U=t("th",{style:{width:"170px"}},"數量/單位",-1),j=t("th",{style:{width:"100px"},class:"text-end"},"單價",-1),G=t("th",{class:"text-end",style:{width:"100px"}},"小計",-1),L=[B,F,Q,U,j,G],q={key:0},M=t("td",{colspan:"6",class:"text-center"},"購物車是空的",-1),z=[M],A={"data-th":""},H=["onClick"],J=t("i",{class:"bi bi-x"},null,-1),K={"data-th":"圖片",class:""},O=["src","alt"],R={"data-th":"行程名稱",class:"fs-6 pb-0 pb-md-2"},W={class:"td-p-left"},X={class:"py-0 py-md-2"},Y={class:"td-number-direction"},Z=t("span",{class:"fw-bold d-md-none fs-6"},"數量/單位",-1),tt={class:"input-group my-3 w-length"},st=["onClick"],et=t("i",{class:"bi bi-dash-lg"},null,-1),at=[et],ot=["onClick"],nt=t("i",{class:"bi bi-trash"},null,-1),ct=[nt],dt=["disabled","onUpdate:modelValue"],rt=["onClick"],lt=t("i",{class:"bi bi-plus-lg"},null,-1),it=[lt],ht={"data-th":"單價",class:"text-end"},ut={class:"td-p-left"},_t={class:"text-end","data-th":"小計"},pt={class:"td-p-left"},bt={class:"tr-border-bottom-0"},ft={colspan:"6",class:"text-end text-success"},gt=t("span",{class:"td-p-right"},"預約",-1),xt={class:"tr-border-bottom-0"},yt={colspan:"6",class:"text-end fs-5"},Ct=t("span",{class:"td-p-right"},"總計 ",-1),kt={class:"d-flex justify-content-between"};function mt(a,e,n,c,s,d){const p=f("CartNavbar"),g=f("router-link");return i(),l("div",$,[t("div",P,[t("div",S,[b(p)])]),t("div",N,[t("table",V,[t("thead",null,[E,s.cartsData.length===0?(i(),l("tr",T,L)):C("",!0)]),t("tbody",null,[s.cartsData.length===0?(i(),l("tr",q,z)):(i(!0),l(k,{key:1},m(s.cartsData,o=>(i(),l("tr",{key:o.id},[t("td",A,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:h=>d.deleteCart(o.id,o.product.title)},[J,_("刪除 ")],8,H)]),t("td",K,[t("img",{src:o.product.imageUrl,alt:o.product.title,class:"img-fluid"},null,8,O)]),t("td",R,[t("span",W,u(o.product.title),1)]),t("td",X,[t("div",Y,[Z,t("div",tt,[o.qty>1?(i(),l("button",{key:0,class:"btn btn-outline-dark rounded-0 btn-sm",type:"button",onClick:h=>d.decrementQuantity(o.id,o.qty,o.price)},at,8,st)):(i(),l("button",{key:1,type:"button",class:"btn btn-outline-danger rounded-0 btn-sm",onClick:h=>d.deleteCart(o.id,o.product.title)},ct,8,ot)),w(t("input",{min:"1",max:"10",type:"number",disabled:o.qty>10,class:"form-control rounded-0 border border-dark d-flex","onUpdate:modelValue":h=>o.qty=h,readonly:"",style:{"text-align":"center"}},null,8,dt),[[v,o.qty]]),t("button",{class:"btn btn-outline-dark rounded-0 btn-sm",type:"button",onClick:h=>d.incrementQuantity(o.id,o.qty,o.price)},it,8,rt)])])]),t("td",ht,[t("span",ut,u(d.thousand(o.price)),1)]),t("td",_t,[t("span",pt,u(d.thousand(o.final_total)),1)])]))),128))]),t("tfoot",null,[t("tr",bt,[t("td",ft,[gt,_(" "+u(s.cartsData.length)+" 項行程 ",1)])]),t("tr",xt,[t("td",yt,[Ct,_(" "+u(d.thousand(s.cartsData.final_total)),1)])])])])]),t("div",kt,[t("a",{class:"btn-outline-square w-50 w-md-25 fs-5 mt-4 me-1",onClick:e[0]||(e[0]=(...o)=>d.back&&d.back(...o)),type:"button"},"繼續預約"),b(g,{class:"btn-square mt-4 fs-5 w-50 w-md-25",type:"button",to:"/cart/CartForm",onClick:e[1]||(e[1]=o=>d.saveCartData(s.cartsData.final_total,s.cartsData.total))},{default:D(()=>[_("下一步")]),_:1})])])}const vt=y(I,[["render",mt]]);export{vt as default};
