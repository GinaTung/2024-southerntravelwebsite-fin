import{M as T}from"./bootstrap.esm-7VYY3Y02.js";import{s as p}from"./sweetAlert-TAVH8QNa.js";import{_ as L,o as s,c as r,b as y,a as e,t as n,l as g,F as h,i as m,d as f,k as x,J as M,r as k,n as C,g as w,p as I,f as A}from"./index-EDi3ziPX.js";import{A as j}from"./AdminSidebar-oWgtftoi.js";const E="https://two024-south-json-server-vercel.onrender.com",U={props:{order:{type:Object},ordersDate:{type:Array},updatePaid:{type:Function},getOrders:{type:Function}},data(){return{orderModal:null,tempOrder:{},isLoading:!1}},methods:{isCheckout(){p.twoLayerCheckType("已收到款項時，請更新付款狀態")},openModal(){this.isCheckout(),this.orderModal.show()},closeModal(){this.orderModal.hide()},thousand(o){return o!==void 0&&(o=o.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${o}`},updateOrderStatue(o){this.isLoading=!0;const i={status:o.user.status,...o.user};this.axios.patch(`${E}/orders/${o.id}`,{user:i,billStatus:o.billStatus,checkDataStatus:o.checkDataStatus,status:o.status}).then(a=>{this.getOrders(),this.isLoading=!1,this.orderModal.hide(),p.threeLayerCheckType("success","更新訂單狀態")}).catch(a=>{p.threeLayerCheckType("error",`${a.message}`)})}},watch:{order(){this.tempOrder=this.order}},mounted(){this.orderModal=new T(this.$refs.orderModal)}},N={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",ref:"orderModal"},$={class:"modal-dialog modal-xl"},q={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},F={class:"modal-title",id:"exampleModalLabel"},z=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},G={class:"row"},H={class:"col-md-4"},K=e("h3",null,"用戶資料",-1),Q={class:"table"},R={key:0},W=e("th",{style:{width:"100px"}},"主要聯繫人",-1),X=e("th",null,"身分證字號",-1),Y=e("th",null,"護照號碼",-1),Z=e("th",null,"Email",-1),ee=e("th",null,"電話",-1),te=e("th",null,"地址",-1),se={class:"col-md-8"},re=e("h3",null,"訂單細節",-1),oe={class:"table"},le=e("th",{style:{width:"100px"}},"訂單編號",-1),de=e("th",null,"下單時間",-1),ne={key:0},ae=e("th",null,"付款時間",-1),ce={key:0},ie={key:1},ue=e("th",null,"付款狀態",-1),he={key:0,class:"text-success"},_e={key:1,class:"text-muted"},pe=e("th",null,"總金額",-1),me=e("h3",{class:"mb-3"},"選購商品",-1),be={class:"table"},ye=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"行程名稱"),e("th",{scope:"col"},"預約數量"),e("th",{scope:"col"},"金額")])],-1),ke={class:"d-flex justify-content-start"},ge={key:0,class:"me-10"},fe={key:0,class:"text-primary-emphasis"},Oe={key:1,class:"text-primary"},ve={key:2,class:"text-warning"},xe={key:3,class:"text-danger"},Me={key:4,class:"text-success"},Se={key:1},Ce={class:"form-check me-4"},we={class:"form-check-label",for:"flexCheckDefault2"},Le={key:0},De={key:1},Pe={class:"form-check me-4"},Te={class:"form-check-label",for:"flexCheckDefault3"},Ve={key:0},Ie={key:1},Ae={class:"form-check me-4"},je={class:"form-check-label",for:"flexCheckDefault4"},Ee={key:0},Ue={key:1},Ne={key:2},$e=e("span",{class:"text-danger"},"已收到款項時，請更新付款狀態",-1),qe=[$e],Be={class:"modal-footer"},Fe=e("button",{type:"button",class:"btn btn-outline-secondary px-6 py-2","data-bs-dismiss":"modal"}," 取消 ",-1);function ze(o,d,i,a,t,c){var O;const b=k("VueLoading");return s(),r(h,null,[y(b,{active:t.isLoading,"z-index":1060},null,8,["active"]),e("div",N,[e("div",$,[e("div",q,[e("div",B,[e("h5",F,[e("span",null,"訂單細節(目前查看訂單編號："+n(t.tempOrder.id)+")",1)]),z]),e("div",J,[e("div",G,[e("div",H,[K,e("table",Q,[t.tempOrder.user?(s(),r("tbody",R,[e("tr",null,[W,e("td",null,n(t.tempOrder.user.name)+" "+n(t.tempOrder.user.appellation),1)]),e("tr",null,[X,e("td",null,n(t.tempOrder.user.memberId),1)]),e("tr",null,[Y,e("td",null,n(t.tempOrder.user.passport),1)]),e("tr",null,[Z,e("td",null,n(t.tempOrder.user.email),1)]),e("tr",null,[ee,e("td",null,n(t.tempOrder.user.tel),1)]),e("tr",null,[te,e("td",null,n(t.tempOrder.user.address),1)])])):g("",!0)])]),e("div",se,[re,e("table",oe,[e("tbody",null,[e("tr",null,[le,e("td",null,n(t.tempOrder.id),1)]),e("tr",null,[de,t.tempOrder.user?(s(),r("td",ne,n(t.tempOrder.user.create_at),1)):g("",!0)]),e("tr",null,[ae,e("td",null,[t.tempOrder.paid_date?(s(),r("span",ce,n(t.tempOrder.paid_date),1)):(s(),r("span",ie,"時間不正確"))])]),e("tr",null,[ue,e("td",null,[(O=t.tempOrder.user)!=null&&O.status?(s(),r("strong",he,"已付款")):(s(),r("span",_e,"尚未付款"))])]),e("tr",null,[pe,e("td",null,[(s(!0),r(h,null,m(t.tempOrder.product,u=>(s(),r(h,{key:u.id},[f(n(c.thousand(u.final_total)),1)],64))),128))])])])]),me,e("table",be,[ye,e("tbody",null,[(s(!0),r(h,null,m(t.tempOrder.product,(u,S)=>(s(),r(h,{key:S+123},[(s(!0),r(h,null,m(u.products,l=>(s(),r("tr",{key:l.id},[e("th",null,n(l.title),1),e("td",null,"預約 "+n(l.qty)+" / 位",1),e("td",null,n(c.thousand(l.final_total)),1)]))),128))],64))),128))])]),e("div",ke,[t.tempOrder.user?(s(),r("div",ge,[f(" 目前訂單狀態 : "),!t.tempOrder.status&&!t.tempOrder.billStatus&&!t.tempOrder.checkDataStatus&&!t.tempOrder.user.status?(s(),r("span",fe," 訂單處理中 ")):!t.tempOrder.status&&!t.tempOrder.billStatus&&!t.tempOrder.checkDataStatus&&t.tempOrder.user.status?(s(),r("span",Oe," 確認出遊資料中 ")):!t.tempOrder.status&&!t.tempOrder.billStatus&&t.tempOrder.checkDataStatus&&t.tempOrder.user.status?(s(),r("span",ve," 發票開立中 ")):!t.tempOrder.status&&t.tempOrder.billStatus&&t.tempOrder.checkDataStatus&&t.tempOrder.user.status?(s(),r("span",xe," 訂單即將完成，準備出遊 ")):(s(),r("span",Me,"已出遊結束"))])):g("",!0),t.tempOrder.user&&t.tempOrder.user.status===!0?(s(),r("div",Se,[e("div",Ce,[x(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault2","onUpdate:modelValue":d[0]||(d[0]=u=>t.tempOrder.checkDataStatus=u)},null,512),[[M,t.tempOrder.checkDataStatus]]),e("label",we,[t.tempOrder.checkDataStatus?(s(),r("span",Le,"已確認出遊資料完成")):(s(),r("span",De,"未確認出遊資料"))])]),e("div",Pe,[x(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault3","onUpdate:modelValue":d[1]||(d[1]=u=>t.tempOrder.billStatus=u)},null,512),[[M,t.tempOrder.billStatus]]),e("label",Te,[t.tempOrder.billStatus?(s(),r("span",Ve,"已開立發票")):(s(),r("span",Ie,"未開立發票"))])]),e("div",Ae,[x(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault4","onUpdate:modelValue":d[2]||(d[2]=u=>t.tempOrder.status=u)},null,512),[[M,t.tempOrder.status]]),e("label",je,[t.tempOrder.status?(s(),r("span",Ee,"出遊結束")):(s(),r("span",Ue,"最後確認訂單資料"))])])])):(s(),r("div",Ne,qe))])])])]),e("div",Be,[Fe,e("button",{type:"button",class:"btn-turquoise",onClick:d[3]||(d[3]=u=>c.updateOrderStatue(t.tempOrder))}," 修改付款狀態 ")])])])],512)],64)}const Je=L(U,[["render",ze]]),Ge={props:{item:Object,delOrder:Function},data(){return{delModal:null,tempOrder:{}}},methods:{openModal(){this.delModal.show()},closeModal(){this.delModal.hide()}},mounted(){this.delModal=new T(this.$refs.delorderModal)}},He={class:"modal fade",id:"delorderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"delorderModal"},Ke={class:"modal-dialog",role:"document"},Qe={class:"modal-content border-0"},Re={class:"modal-header bg-danger text-white"},We={class:"modal-title"},Xe=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ye={key:0,class:"modal-body"},Ze={class:"text-danger me-2"},et={class:"text-primary"},tt={class:"modal-footer"},st=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function rt(o,d,i,a,t,c){return s(),r("div",He,[e("div",Ke,[e("div",Qe,[e("div",Re,[e("h5",We,[e("span",null,"刪除訂單編號: "+n(i.item.id),1)]),Xe]),i.item.user?(s(),r("div",Ye,[f(" 是否刪除 "),e("strong",Ze,"訂單編號："+n(i.item.id),1),e("span",et,"客戶："+n(i.item.user.name),1),f("(刪除後將無法恢復)。 ")])):g("",!0),e("div",tt,[st,e("button",{type:"button",class:"btn btn-danger",onClick:d[0]||(d[0]=(...b)=>i.delOrder&&i.delOrder(...b))},"確認刪除")])])])],512)}const ot=L(Ge,[["render",rt]]),v="https://two024-south-json-server-vercel.onrender.com",lt={components:{OrderModal:Je,DelOrderModal:ot,AdminSidebar:j},data(){return{orders:[],isNew:!1,pageTotal:0,currentPage:1,limitPage:10,isLoading:!1,tempOrder:{},orderModal:null,delModal:null}},methods:{thousand(o){return o!==void 0&&(o=o.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${o}`},getOrders(o=1){this.isLoading=!0,this.axios.get(`${v}/orders?_limit=${this.limitPage}&_page=${o}`).then(d=>{var i=parseInt(d.headers["x-total-count"]);this.pageTotal=Math.ceil(i/this.limitPage),this.currentPage=o,this.orders=d.data,this.orders.forEach(a=>{var t=new Date(a.user.create_at),c=t.toISOString(),b=c.slice(0,10);a.user.create_at=b}),this.getOrderProducts(),this.isLoading=!1}).catch(d=>{this.isLoading=!1,p.threeLayerCheckType("error","取得訂單資料失敗")})},getOrderProducts(){this.axios.get(`${v}/cartsData`).then(o=>{const d={};o.data.forEach(a=>{d[a.id]||(d[a.id]={final_total:a.final_total,userId:a.userId,cartDataId:a.id,total:a.total,products:[]}),a.data.forEach(t=>{d[a.id].products.push({id:t.productId,title:t.product.title,qty:t.qty,price:t.price,total:t.total,final_total:t.final_total})})});const i=Object.values(d);this.orders.forEach(a=>{i.forEach(t=>{a.user.cartDataId===t.cartDataId&&(a.product=[],a.product.push(t))})})}).catch(o=>{p.threeLayerCheckType("error","取得訂單的產品資料失敗")})},openModal(o){this.tempOrder={...o},this.isNew=!1,this.$refs.orderModal.openModal()},openDelOrderModal(o){this.tempOrder={...o},this.$refs.delModal.openModal()},updatePaid(o){this.isLoading=!0;const d=o.user.status,i={...o.user,status:d};this.axios.patch(`${v}/orders/${o.id}`,{user:i}).then(a=>{this.getOrders(),this.isLoading=!1,this.$refs.orderModal.closeModal(),p.threeLayerCheckType("success","更新付款狀態")}).catch(a=>{this.isLoading=!1,p.threeLayerCheckType("error","更新付款狀態失敗")})},delOrder(){this.isLoading=!0,this.axios.delete(`${v}/orders/${this.tempOrder.id}`,this.tempOrder).then(o=>{this.getOrders(),this.isLoading=!1,this.$refs.delModal.closeModal(),p.threeLayerCheckType("success","已刪除訂單成功")}).catch(o=>{this.isLoading=!1,p.threeLayerCheckType("error",`${o.message}`)})}},mounted(){this.getOrders()}},D=o=>(I("data-v-df50ac0b"),o=o(),A(),o),dt={class:"container"},nt={class:"row flex-column flex-md-row"},at={class:"col-12 col-md-3"},ct={class:"col-12 col-md-9"},it=D(()=>e("h2",{class:"my-5"},"訂單列表",-1)),ut={class:"table-responsive"},ht={class:"table mt-4"},_t=D(()=>e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"聯繫人"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"處理狀態"),e("th",null,"編輯")])],-1)),pt={style:{width:"100px"}},mt=["textContent"],bt={class:"list-unstyled"},yt=D(()=>e("br",null,null,-1)),kt={style:{width:"80px"}},gt={class:"form-check form-switch",style:{width:"100px"}},ft=["onUpdate:modelValue","onChange"],Ot={class:"form-check-label"},vt={key:0},xt={key:1,class:"text-danger"},Mt={style:{width:"80px"}},St={key:0,class:"text-primary-emphasis"},Ct={key:1,class:"text-primary"},wt={key:2,class:"text-warning"},Lt={key:3,class:"text-danger"},Dt={key:4,class:"text-success"},Pt={class:"btn-group"},Tt=["onClick"],Vt=["onClick"],It={"aria-label":"Page navigation example",class:"my-10"},At={class:"pagination justify-content-center"},jt=["onClick"];function Et(o,d,i,a,t,c){const b=k("VueLoading"),O=k("AdminSidebar"),u=k("order-modal"),S=k("del-order-modal");return s(),r(h,null,[y(b,{active:t.isLoading,"z-index":1060},null,8,["active"]),e("div",dt,[e("div",nt,[e("div",at,[y(O)]),e("div",ct,[it,e("div",ut,[e("table",ht,[_t,e("tbody",null,[(s(!0),r(h,null,m(t.orders,l=>(s(),r("tr",{key:l.id},[e("td",null,[e("div",pt,n(l.user.create_at),1)]),e("td",null,[l.user?(s(),r("span",{key:0,textContent:n(l.user.email),style:{width:"80px"}},null,8,mt)):g("",!0)]),e("td",null,[e("ul",bt,[(s(!0),r(h,null,m(l.product,_=>(s(),r(h,{key:_.id},[(s(!0),r(h,null,m(_.products,(P,V)=>(s(),r("li",{key:V+123,style:{width:"200px"}},[f(n(P.title)+" 預約："+n(P.qty)+"位 ",1),yt]))),128))],64))),128))])]),(s(!0),r(h,null,m(l.product,_=>(s(),r("td",{class:"text-right",key:_.id},[e("div",kt,n(c.thousand(_.final_total)),1)]))),128)),e("td",null,[e("div",gt,[x(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":_=>l.user.status=_,onChange:_=>c.updatePaid(l)},null,40,ft),[[M,l.user.status]]),e("label",Ot,[l.user.status?(s(),r("span",vt,"已付款")):(s(),r("span",xt,"未付款"))])])]),e("td",null,[e("div",Mt,[!l.status&&!l.billStatus&&!l.checkDataStatus&&!l.user.status?(s(),r("p",St," 訂單處理中 ")):!l.status&&!l.billStatus&&!l.checkDataStatus&&l.user.status?(s(),r("p",Ct," 預約安排出遊 ")):!l.status&&!l.billStatus&&l.checkDataStatus&&l.user.status?(s(),r("p",wt," 發票開立中 ")):!l.status&&l.billStatus&&l.checkDataStatus&&l.user.status?(s(),r("p",Lt," 訂單即將完成，準備出遊 ")):(s(),r("p",Dt,"已出遊結束"))])]),e("td",null,[e("div",Pt,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:_=>c.openModal(l)}," 檢視 ",8,Tt),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:_=>c.openDelOrderModal(l)}," 刪除 ",8,Vt)])])]))),128))])])]),e("nav",It,[e("ul",At,[e("li",{class:C(["page-item",{disabled:!t.currentPage||t.currentPage===1}])},[e("button",{class:"page-link page-link-radius-2",onClick:d[0]||(d[0]=w(l=>t.currentPage>1&&c.getOrders(t.currentPage-1),["prevent"]))}," 上一頁 ")],2),(s(!0),r(h,null,m(t.pageTotal,l=>(s(),r("li",{class:"page-item",key:`page-${l}`},[e("button",{class:C(["page-link page-link-0 rounded-0",{active:l===t.currentPage}]),onClick:w(_=>c.getOrders(l),["prevent"])},n(l),11,jt)]))),128)),e("li",{class:C(["page-item",{disabled:!t.currentPage||t.currentPage===t.pageTotal}])},[e("button",{class:"page-link page-link-radius",onClick:d[1]||(d[1]=w(l=>t.currentPage<t.pageTotal&&c.getOrders(t.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])])])]),y(u,{ref:"orderModal",order:t.tempOrder,"update-paid":c.updatePaid,"get-orders":c.getOrders},null,8,["order","update-paid","get-orders"]),y(S,{ref:"delModal",item:t.tempOrder,"del-order":c.delOrder},null,8,["item","del-order"])],64)}const Bt=L(lt,[["render",Et],["__scopeId","data-v-df50ac0b"]]);export{Bt as default};
