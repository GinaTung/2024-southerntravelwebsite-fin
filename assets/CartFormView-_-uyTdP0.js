import{U as M}from"./UserProductModal-hVwLXBIz.js";import{C as U}from"./CartNavbar-79_qkU_G.js";import{C as w}from"./collapse-2HEcf_yr.js";import{_ as E,c as h,b as l,a as e,d as y,t as _,f as I,v as O,F as k,h as P,w as p,r as g,o as f,n as c,i as x}from"./index-EB2s3bge.js";const V="https://two024-south-json-server-vercel.onrender.com",q={components:{CartNavbar:U,UserProductModal:M},data(){return{cartsData:[],userCart:[],userId:"",isOpen:!1,headerCollapse:{},user:{name:"",email:"",tel:"",address:"",birthday:"",comment:"",shippingMethod:"",passport:"",memberId:"",appellation:""},shippingMethod:["電子郵件","郵寄"],total:0,productId:"",productTitle:"",cartDataId:"",ordersData:[],isLoading:!1,orderId:0}},watch:{$route(){this.headerCollapse.hide()}},methods:{verifyId(o){if(o=o.trim(),o.length===0)return"身份證字號 為必填";if(o.length!=10)return"身份證字號 長度需為10";let s=o.charCodeAt(0);if(s<65|s>90)return"身份證字號 字首英文代號，縣市不正確";let u=o.charCodeAt(1);if(u!=49&&u!=50)return"身份證字號 性別代碼不正確";let m=o.slice(2);for(let i in m){let d=m.charCodeAt(i);if(d<48|d>57)return"身份證字號 數字區出現非數字字元"}let t="ABCDEFGHJKLMNPQRSTUVXYWZIO",n=[1,9,8,7,6,5,4,3,2,1,1];o=String(t.indexOf(o[0])+10)+o.slice(1);let b=0;for(let i=0;i<o.length;i++){let d=parseInt(o[i]),D=n[i];b+=d*D}let v=b%10==0;return v||"身份證字號 檢核碼錯誤"},isOver18(o){if(o.length===0)return"生日 為必填";const s=new Date(o),u=new Date,m=u.getFullYear()-s.getFullYear();return u.getMonth()<s.getMonth()||u.getMonth()===s.getMonth()&&u.getDate()<s.getDate()?m-1<18?"主要聯繫人需滿18歲":!0:m<18?"主要聯繫人需滿18歲":!0},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"需要正確的電話號碼"},backPage(){this.$router.go(-1)},toggleOpen(){this.isOpen=!this.isOpen},forId(o,s){this.productId=o,this.productTitle=s,this.$refs.userProductModal.openModal()},getCartsData(){this.axios.get(`${V}/cartsData`).then(o=>{this.cartsData=o.data,this.cartsData.forEach(s=>{s.status===!1&&s.userId===this.userId&&s.data.forEach(u=>{this.userCart.push(u),this.isLoading=!1})}),console.log(this.userCart),this.userCart.forEach(s=>{this.total+=s.final_total})}).catch(o=>{console.log(o),this.isLoading=!1})},getCookie(o){const s=document.cookie.split(";");for(let u of s){const[m,t]=u.trim().split("=");if(m===o)return t}return null},thousand(o){return o!==void 0&&(o=o.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${o}`},orderData(){if(this.orderId){if(!this.ordersData.user.name||!this.ordersData.user.email||!this.ordersData.user.tel||!this.ordersData.user.address||!this.ordersData.user.birthday||!this.ordersData.user.shippingMethod){alert("請填寫所有必填欄位");return}}else if(!this.user.name||!this.user.email||!this.user.tel||!this.user.address||!this.user.birthday||!this.user.shippingMethod){alert("請填寫所有必填欄位");return}if(console.log(this.cartDataId,"cartDataId"),console.log(this.orderId,"orderId"),this.orderId){const o={create_at:new Date,name:this.ordersData.user.name,email:this.ordersData.user.email,tel:this.ordersData.user.tel,address:this.ordersData.user.address,birthday:this.ordersData.user.birthday,comment:this.ordersData.user.comment,shippingMethod:this.ordersData.user.shippingMethod,passport:this.ordersData.user.passport,memberId:this.ordersData.user.memberId,appellation:this.ordersData.user.appellation,userId:this.ordersData.userId,cartDataId:this.cartDataId,status:!1};this.axios.put(`${V}/orders/${this.orderId}`,{user:o}).then(s=>{this.ordersData=s.data,console.log(this.ordersData)}).catch(s=>{console.log(s)})}else{const o={create_at:new Date,name:this.user.name,email:this.user.email,tel:this.user.tel,address:this.user.address,birthday:this.user.birthday,comment:this.user.comment,shippingMethod:this.user.shippingMethod,passport:this.user.passport,memberId:this.user.memberId,appellation:this.user.appellation,userId:this.userId,cartDataId:this.cartDataId,status:!1};this.axios.post(`${V}/orders`,{user:o}).then(s=>{this.ordersData=s.data,console.log(this.ordersData),document.cookie=`orderId=${s.data.id}`}).catch(s=>{console.log(s)})}this.$router.push("/cart/payList")},getOrder(){this.axios.get(`${V}/orders/${this.orderId}`).then(o=>{this.ordersData=o.data,console.log(this.ordersData)}).catch(o=>{console.log(o)})}},mounted(){const o=this.getCookie("userId");this.userId=o*1,this.isLoading=!0,this.getCartsData(),this.headerCollapse=new w(this.$refs.headerCollapse,{toggle:!1}),setTimeout(()=>{const u=this.getCookie("cartDataId");this.cartDataId=u*1,console.log(this.cartDataId,"cartDataId")},3e3);const s=this.getCookie("orderId");this.orderId=s*1,this.orderId&&this.getOrder()}},T={class:"container py-10 py-lg-30"},A={class:"row"},F={class:"col-md-6 mx-auto pb-5 pb-lg-15"},L={class:"mb-4"},S={class:"d-grid gap-2"},N=e("br",null,null,-1),B={key:0,class:"bi bi-chevron-down"},j={key:1,class:"bi bi-chevron-up"},Y={class:"collapse",id:"collapseExample",ref:"headerCollapse"},z={class:"card card-body rounded-0"},G={class:"col-12 col-md-5 col-lg-4"},H=["src","alt"],J={class:"col-12 col-md-7 col-lg-8 d-flex flex-column justify-content-between"},K={class:"mt-4 mt-md-0 mb-4"},Q={class:"mb-4"},R={class:"mb-4"},W={class:"mb-4"},X=["onClick"],Z={key:0},$={class:"row"},ee={class:"col-12 col-md-6 mb-4"},se=e("h3",{class:"mb-4"},"訂單資料",-1),te={class:"form-floating mb-4"},oe=e("label",{for:"floatingInput",class:"form-label"},"主要聯繫人姓名",-1),le={class:"form-floating mb-4"},ae=e("option",{selected:"",value:"",disabled:""},"請選擇稱謂",-1),re=e("option",{value:"female"},"女士",-1),ie=e("option",{value:"male"},"男士",-1),de=e("label",{for:"floatingAppellation"},"稱謂",-1),ne={class:"form-floating mb-4"},ce=e("label",{for:"floatingMemberId"},"身分證字號",-1),ue={class:"form-floating mb-4"},me=e("label",{for:"floatingPassport"},"護照號碼",-1),he={class:"form-floating mb-4"},fe=e("label",{for:"floatingDate"},"生日(主要聯繫人需滿18歲)",-1),pe={class:"form-floating mb-4"},ge=e("label",{for:"floatingTel"},"請輸入手機號碼",-1),_e={class:"form-floating mb-4"},be=e("label",{for:"floatingEmail"},"請輸入 Email",-1),ve={class:"form-floating mb-4"},De=e("label",{for:"floatingAddress"},"住址",-1),Ve={class:"col-12 col-md-6 mb-4"},Ie=e("h3",{class:"mb-4"},"取件方式",-1),ye={class:"form-floating mb-4"},ke=e("option",{selected:"",value:"",disabled:""},"請選擇取件方式",-1),xe=e("option",{value:"電子郵件"},"電子郵件",-1),Ce=e("option",{value:"郵寄"},"郵寄",-1),Me=e("label",{for:"floatingSelect2"},"選擇取件方式",-1),Ue={class:"form-floating mb-4"},we=e("label",{for:"floatingTextarea2"},"備註(如:飲食、暈車等注意事項)",-1),Ee={key:1},Oe={class:"row"},Pe={class:"col-12 col-md-6 mb-4"},qe=e("h3",{class:"mb-4"},"訂單資料",-1),Te={class:"form-floating mb-4"},Ae=e("label",{for:"floatingInput",class:"form-label"},"主要聯繫人姓名",-1),Fe={class:"form-floating mb-4"},Le=e("option",{selected:"",value:"",disabled:""},"請選擇稱謂",-1),Se=e("option",{value:"female"},"女士",-1),Ne=e("option",{value:"male"},"男士",-1),Be=e("label",{for:"floatingAppellation"},"稱謂",-1),je={class:"form-floating mb-4"},Ye=e("label",{for:"floatingMemberId"},"身分證字號",-1),ze={class:"form-floating mb-4"},Ge=e("label",{for:"floatingPassport"},"護照號碼",-1),He={class:"form-floating mb-4"},Je=e("label",{for:"floatingDate"},"生日(主要聯繫人需滿18歲)",-1),Ke={class:"form-floating mb-4"},Qe=e("label",{for:"floatingTel"},"請輸入手機號碼",-1),Re={class:"form-floating mb-4"},We=e("label",{for:"floatingEmail"},"請輸入 Email",-1),Xe={class:"form-floating mb-4"},Ze=e("label",{for:"floatingAddress"},"住址",-1),$e={class:"col-12 col-md-6 mb-4"},es=e("h3",{class:"mb-4"},"取件方式",-1),ss={class:"form-floating mb-4"},ts=e("option",{selected:"",value:"",disabled:""},"請選擇取件方式",-1),os=e("option",{value:"電子郵件"},"電子郵件",-1),ls=e("option",{value:"郵寄"},"郵寄",-1),as=e("label",{for:"floatingSelect2"},"選擇取件方式",-1),rs={class:"form-floating mb-4"},is=e("label",{for:"floatingTextarea2"},"備註(如:飲食、暈車等注意事項)",-1),ds={class:"d-flex justify-content-between"};function ns(o,s,u,m,t,n){const b=g("VueLoading"),v=g("CartNavbar"),i=g("VeeField"),d=g("ErrorMessage"),D=g("VeeForm"),C=g("UserProductModal");return f(),h(k,null,[l(b,{active:t.isLoading,class:"text-center","z-index":1060},null,8,["active"]),e("div",T,[e("div",A,[e("div",F,[l(v)])]),e("div",L,[e("p",S,[e("button",{class:"btn btn-primary-600 border-top",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample",onClick:s[0]||(s[0]=(...r)=>n.toggleOpen&&n.toggleOpen(...r))},[y(" 總計："+_(n.thousand(t.total))+"元",1),N,y("購買清單 "),t.isOpen===!1?(f(),h("i",B)):(f(),h("i",j))])]),I(e("div",Y,[e("div",z,[(f(!0),h(k,null,P(t.userCart,r=>(f(),h("div",{class:"row p-4 p-md-10",key:r.id},[e("div",G,[e("img",{src:r.product.imageUrl,alt:r.product.title,class:"img-fluid h-100"},null,8,H)]),e("div",J,[e("div",null,[e("h4",K,"套裝行程名稱："+_(r.product.title),1),e("h5",Q,"單價："+_(n.thousand(r.product.price)),1),e("h5",R,"預約數量："+_(r.qty)+" 位",1),e("h5",W,"總計："+_(n.thousand(r.final_total)),1)]),e("div",null,[e("button",{type:"button",class:"btn-turquoise border-0 rounded-1",onClick:a=>n.forId(r.product.id,r.product.title)}," 查看更多 ",8,X)])])]))),128))])],512),[[O,t.isOpen]])]),t.orderId===t.ordersData.id?(f(),h("div",Z,[l(D,{id:"form",ref:"form"},{default:p(({errors:r})=>[e("div",$,[e("div",ee,[se,e("div",te,[l(i,{type:"text",class:c(["form-control rounded-1",{"is-invalid":r.主要聯繫人姓名}]),modelValue:t.ordersData.user.name,"onUpdate:modelValue":s[1]||(s[1]=a=>t.ordersData.user.name=a),id:"floatingInput",name:"主要聯繫人姓名",placeholder:"請輸入姓名",rules:"required"},null,8,["class","modelValue"]),oe,l(d,{name:"主要聯繫人姓名",class:"invalid-feedback"})]),e("div",le,[l(i,{id:"floatingAppellation",name:"稱謂",class:c(["form-control rounded-1",{"is-invalid":r.稱謂}]),placeholder:"請選擇稱謂",rules:"required",modelValue:t.ordersData.user.appellation,"onUpdate:modelValue":s[2]||(s[2]=a=>t.ordersData.user.appellation=a),as:"select"},{default:p(()=>[ae,re,ie]),_:2},1032,["class","modelValue"]),de,l(d,{name:"稱謂",class:"invalid-feedback"})]),e("div",ne,[l(i,{type:"text",name:"身分證字號",class:c(["form-control rounded-1",{"is-invalid":r.身分證字號}]),id:"floatingMemberId",placeholder:"請輸入身分證字號",modelValue:t.ordersData.user.memberId,"onUpdate:modelValue":s[3]||(s[3]=a=>t.ordersData.user.memberId=a),rules:n.verifyId},null,8,["class","modelValue","rules"]),ce,l(d,{name:"身分證字號",class:"invalid-feedback"})]),e("div",ue,[l(i,{type:"text",name:"護照號碼",class:c(["form-control rounded-1",{"is-invalid":r.護照號碼}]),id:"floatingPassport",placeholder:"請輸入護照號碼",modelValue:t.ordersData.user.passport,"onUpdate:modelValue":s[4]||(s[4]=a=>t.ordersData.user.passport=a),rules:"numeric:true|length:9|required"},null,8,["class","modelValue"]),me,l(d,{name:"護照號碼",class:"invalid-feedback"})]),e("div",he,[l(i,{type:"date",name:"生日",class:c(["form-control rounded-1",{"is-invalid":r.生日}]),id:"floatingDate",placeholder:"2024/03/08",modelValue:t.ordersData.user.birthday,"onUpdate:modelValue":s[5]||(s[5]=a=>t.ordersData.user.birthday=a),rules:n.isOver18},null,8,["class","modelValue","rules"]),fe,l(d,{name:"生日",class:"invalid-feedback"})]),e("div",pe,[l(i,{id:"floatingTel",name:"手機號碼",type:"text",class:c(["form-control rounded-1",{"is-invalid":r.手機號碼}]),placeholder:"請輸入手機號碼",rules:n.isPhone,modelValue:t.ordersData.user.tel,"onUpdate:modelValue":s[6]||(s[6]=a=>t.ordersData.user.tel=a)},null,8,["class","rules","modelValue"]),ge,l(d,{name:"手機號碼",class:"invalid-feedback"})]),e("div",_e,[l(i,{type:"email",name:"email",class:c(["form-control rounded-1",{"is-invalid":r.email}]),modelValue:t.ordersData.user.email,"onUpdate:modelValue":s[7]||(s[7]=a=>t.ordersData.user.email=a),id:"floatingEmail",placeholder:"請輸入 Email",rules:"email|required",autocomplete:"useremail"},null,8,["modelValue","class"]),be,l(d,{name:"email",class:"invalid-feedback"})]),e("div",ve,[l(i,{name:"住址",type:"text",class:c(["form-control rounded-1",{"is-invalid":r.住址}]),id:"floatingAddress",placeholder:"縣市鄉鎮市區",modelValue:t.ordersData.user.address,"onUpdate:modelValue":s[8]||(s[8]=a=>t.ordersData.user.address=a),rules:"min:10|required"},null,8,["class","modelValue"]),De,l(d,{name:"住址",class:"invalid-feedback"})])]),e("div",Ve,[Ie,e("div",ye,[l(i,{name:"取件方式",modelValue:t.ordersData.user.shippingMethod,"onUpdate:modelValue":s[9]||(s[9]=a=>t.ordersData.user.shippingMethod=a),class:c(["form-select rounded-1",{"is-invalid":r.取件方式}]),id:"floatingSelect2","aria-label":"Floating label select example",rules:"required",as:"select"},{default:p(()=>[ke,xe,Ce]),_:2},1032,["modelValue","class"]),Me,l(d,{name:"取件方式",class:"invalid-feedback"})]),e("div",Ue,[I(e("textarea",{class:"form-control rounded-1",placeholder:"備註",id:"floatingTextarea2",style:{height:"280px"},"onUpdate:modelValue":s[10]||(s[10]=a=>t.ordersData.user.comment=a)},null,512),[[x,t.ordersData.user.comment]]),we])])])]),_:1},512)])):(f(),h("div",Ee,[l(D,{id:"form",ref:"form"},{default:p(({errors:r})=>[e("div",Oe,[e("div",Pe,[qe,e("div",Te,[l(i,{type:"text",class:c(["form-control rounded-1",{"is-invalid":r.主要聯繫人姓名}]),modelValue:t.user.name,"onUpdate:modelValue":s[11]||(s[11]=a=>t.user.name=a),id:"floatingInput",name:"主要聯繫人姓名",placeholder:"請輸入姓名",rules:"required"},null,8,["class","modelValue"]),Ae,l(d,{name:"主要聯繫人姓名",class:"invalid-feedback"})]),e("div",Fe,[l(i,{id:"floatingAppellation",name:"稱謂",class:c(["form-control rounded-1",{"is-invalid":r.稱謂}]),placeholder:"請選擇稱謂",rules:"required",modelValue:t.user.appellation,"onUpdate:modelValue":s[12]||(s[12]=a=>t.user.appellation=a),as:"select"},{default:p(()=>[Le,Se,Ne]),_:2},1032,["class","modelValue"]),Be,l(d,{name:"稱謂",class:"invalid-feedback"})]),e("div",je,[l(i,{type:"text",name:"身分證字號",class:c(["form-control rounded-1",{"is-invalid":r.身分證字號}]),id:"floatingMemberId",placeholder:"請輸入身分證字號",modelValue:t.user.memberId,"onUpdate:modelValue":s[13]||(s[13]=a=>t.user.memberId=a),rules:n.verifyId},null,8,["class","modelValue","rules"]),Ye,l(d,{name:"身分證字號",class:"invalid-feedback"})]),e("div",ze,[l(i,{type:"text",name:"護照號碼",class:c(["form-control rounded-1",{"is-invalid":r.護照號碼}]),id:"floatingPassport",placeholder:"請輸入護照號碼",modelValue:t.user.passport,"onUpdate:modelValue":s[14]||(s[14]=a=>t.user.passport=a),rules:"numeric:true|length:9|required"},null,8,["class","modelValue"]),Ge,l(d,{name:"護照號碼",class:"invalid-feedback"})]),e("div",He,[l(i,{type:"date",name:"生日",class:c(["form-control rounded-1",{"is-invalid":r.生日}]),id:"floatingDate",placeholder:"2024/03/08",modelValue:t.user.birthday,"onUpdate:modelValue":s[15]||(s[15]=a=>t.user.birthday=a),rules:n.isOver18},null,8,["class","modelValue","rules"]),Je,l(d,{name:"生日",class:"invalid-feedback"})]),e("div",Ke,[l(i,{id:"floatingTel",name:"手機號碼",type:"text",class:c(["form-control rounded-1",{"is-invalid":r.手機號碼}]),placeholder:"請輸入手機號碼",rules:n.isPhone,modelValue:t.user.tel,"onUpdate:modelValue":s[16]||(s[16]=a=>t.user.tel=a)},null,8,["class","rules","modelValue"]),Qe,l(d,{name:"手機號碼",class:"invalid-feedback"})]),e("div",Re,[l(i,{type:"email",name:"email",class:c(["form-control rounded-1",{"is-invalid":r.email}]),modelValue:t.user.email,"onUpdate:modelValue":s[17]||(s[17]=a=>t.user.email=a),id:"floatingEmail",placeholder:"請輸入 Email",rules:"email|required",autocomplete:"useremail"},null,8,["modelValue","class"]),We,l(d,{name:"email",class:"invalid-feedback"})]),e("div",Xe,[l(i,{name:"住址",type:"text",class:c(["form-control rounded-1",{"is-invalid":r.住址}]),id:"floatingAddress",placeholder:"縣市鄉鎮市區",modelValue:t.user.address,"onUpdate:modelValue":s[18]||(s[18]=a=>t.user.address=a),rules:"min:10|required"},null,8,["class","modelValue"]),Ze,l(d,{name:"住址",class:"invalid-feedback"})])]),e("div",$e,[es,e("div",ss,[l(i,{name:"取件方式",modelValue:t.user.shippingMethod,"onUpdate:modelValue":s[19]||(s[19]=a=>t.user.shippingMethod=a),class:c(["form-select rounded-1",{"is-invalid":r.取件方式}]),id:"floatingSelect2","aria-label":"Floating label select example",rules:"required",as:"select"},{default:p(()=>[ts,os,ls]),_:2},1032,["modelValue","class"]),as,l(d,{name:"取件方式",class:"invalid-feedback"})]),e("div",rs,[I(e("textarea",{class:"form-control rounded-1",placeholder:"備註",id:"floatingTextarea2",style:{height:"280px"},"onUpdate:modelValue":s[20]||(s[20]=a=>t.user.comment=a)},null,512),[[x,t.user.comment]]),is])])])]),_:1},512)])),e("div",ds,[e("button",{class:"btn-cerulean w-50 w-md-25 fs-5 mt-4 me-1",onClick:s[21]||(s[21]=(...r)=>n.backPage&&n.backPage(...r)),type:"button"}," 上一步 "),e("button",{class:"btn-square mt-4 fs-5 w-50 w-md-25",onClick:s[22]||(s[22]=(...r)=>n.orderData&&n.orderData(...r)),type:"button"}," 下一步 ")])]),l(C,{ref:"userProductModal","user-cart":t.userCart,"product-id":t.productId,"product-title":t.productTitle},null,8,["user-cart","product-id","product-title"])],64)}const fs=E(q,[["render",ns]]);export{fs as default};
