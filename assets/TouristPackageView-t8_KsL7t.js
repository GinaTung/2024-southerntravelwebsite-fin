import{s as _}from"./sweetAlert--BVu_RmJ.js";import{_ as D,c as i,b as v,a as s,w as x,g as L,t as l,j as C,F as h,h as f,n as m,A as k,r as w,o,d as p}from"./index-Z8Wx9WA5.js";const u="https://two024-south-json-server-vercel.onrender.com",N={data(){return{text:"南部旅遊方案",products:[],user:"",userId:"",token:"",carts:[],newCarts:[],newProductsDes:"",enabledProducts:[],fullPath:"",currentURL:"",productsCategory:[],selectedCategory:"全部",currentDate:"",currentPage:1,limitPage:5,pageTotal:0,isLoading:!1,status:{loadingItem:""},category:"全部"}},watch:{$route(t,e){this.currentURL=t.fullPath}},computed:{filterCategory(){const t=this.productsCategory.map(n=>n.category),e=[...new Set(t)];return e.unshift("全部"),e},filterCateNum(){const t={};return this.productsCategory.forEach(e=>{t[e.category]?t[e.category]+=1:t[e.category]=1}),t.全部=this.productsCategory.length,t},filteredProducts(){return this.selectedCategory==="全部"||!this.selectedCategory?this.enabledProducts:this.enabledProducts.filter(t=>t.category===this.selectedCategory)}},created(){const t=this.getCookie("category");this.category=t,this.selectedCategory=this.category,this.getProducts(),setTimeout(()=>{this.isLoading=!1,document.cookie="category="},1e4)},methods:{getProducts(t=1){this.axios.get(`${u}/products`).then(e=>{this.productsCategory=e.data.filter(n=>n.is_enabled===1),setTimeout(()=>{this.isLoading=!1},1e3)}).catch(e=>{alert(`${e.message}`)}),this.selectedCategory==="全部"||!this.selectedCategory?this.axios.get(`${u}/products?_limit=${this.limitPage}&_page=${t}`).then(e=>{var n=parseInt(e.headers["x-total-count"]);this.pageTotal=Math.ceil(n/this.limitPage),this.currentPage=t,this.products=e.data,this.getNewText(),this.enabledProducts=this.products.filter(d=>d.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristPackage",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(e=>{alert(`${e.message}`)}):this.axios.get(`${u}/products?category=${this.selectedCategory}&_limit=${this.limitPage}&_page=${t}`).then(e=>{var n=parseInt(e.headers["x-total-count"]);this.pageTotal=Math.ceil(n/this.limitPage),this.currentPage=t,this.products=e.data,this.getNewText(),this.enabledProducts=this.products.filter(d=>d.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristPackage",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(e=>{alert(`${e.message}`)})},filterProducts(t){this.selectedCategory=t,this.status.loadingItem=!0,this.getProducts()},checkDate(){var t=new Date,e={year:t.getFullYear(),month:t.getMonth()+1,date:t.getDate()},n=(e.month<10?"0":"")+e.month,d=(e.date<10?"0":"")+e.date,r=e.year+"-"+n+"-"+d;this.currentDate=r},thousand(t){return t!==void 0&&(t=t.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${t}`},truncateContent(t,e){return t&&t.length>e?t.substring(0,e)+"...":t},getNewText(){const t={};this.products.forEach(e=>{e.description&&e.description.split(";").forEach(d=>{const r=d.trim();t[e.id]||(t[e.id]=[]),t[e.id].push(r)})}),this.newProductsDes=Object.entries(t).map(([e,n])=>({id:e,descriptions:n}))},getCart(){this.axios.get(`${u}/carts`).then(t=>{this.carts=t.data,this.carts.forEach(e=>{e.userId===this.userId&&this.newCarts.push(e)})}).catch(t=>{alert("取得購物車資料失敗")})},addToCart(t,e=1,n){if(this.status.loadingItem=t,!this.token)_.threeLayerCheckType("warning","請登入會員後，才能預約套裝行程"),this.status.loadingItem="";else{let d=!1,r=1;this.newCarts.forEach(c=>{c.productId===t&&c.id&&(d=!0,this.cartId=c.id)}),d?this.axios.put(`${u}/carts/${this.cartId}`,{productId:t,qty:e,price:n,total:e*n,userId:this.userId,final_total:e*n*r}).then(c=>{this.status.loadingItem="",_.threeLayerCheckType("success","已更新預約人數"),this.getCart()}).catch(c=>{_.threeLayerCheckType("error","更新預約人數失敗")}):this.axios.post(`${u}/carts`,{productId:t,qty:e,price:n,total:e*n,userId:this.userId,final_total:e*n*r}).then(c=>{this.status.loadingItem="",_.threeLayerCheckType("success","已預約成功"),this.getCart(),this.$emitter.emit("updateCart")}).catch(c=>{_.threeLayerCheckType("error","預約失敗，再重新登入預約")})}},getCookie(t){const e=document.cookie.split(";");for(let n of e){const[d,r]=n.trim().split("=");if(d===t)return r}return null}},mounted(){const e=new URLSearchParams(window.location.search).get("category");if(!e||e.trim()===""){const r=this.getCookie("category");r?this.selectedCategory=r:this.selectedCategory="全部"}else this.selectedCategory=e;this.isLoading=!0,this.getProducts(),window.scrollTo(0,0);const n=this.getCookie("userId"),d=this.getCookie("hexTokenU");this.userId=n*1,this.token=d,this.getCart(),this.checkDate(),this.fullPath=this.$route.fullPath}},S={class:"container py-10 py-lg-30"},E={style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",class:"pb-5 pb-lg-15"},j={class:"breadcrumb mb-0 fs-5"},V={class:"breadcrumb-item"},U={class:"breadcrumb-item","aria-current":"page"},B={key:1},M={key:0,class:"breadcrumb-item","aria-current":"page"},F={class:"tourist-list"},R={class:"row"},z={class:"col-12 col-md-3 mb-5 mb-md-6 mb-lg-0 d-none d-lg-flex"},A={class:"border-info2 border-1 border w-100 rounded-1 h-100"},q=s("p",{class:"fs-4 p-5 bg-primary-500 text-white rounded-top"},"地區篩選",-1),O={class:"nav flex-column"},Y=["value","onClick"],G={class:"col-12 col-lg-9"},H={key:0,class:"text-center",style:{margin:"150px"}},J=s("div",{class:"spinner-border",role:"status",style:{width:"3rem",height:"3rem",color:"#43b8bd"}},[s("span",{class:"visually-hidden"},"Loading...")],-1),K=[J],Q={key:1},W={class:"row g-0"},X={class:"col-md-4"},Z={class:"tag text-white"},I={class:"card-att-img h-100"},$=["src","alt"],ee={class:"col-md-8"},te={class:"card h-100 border-0 bg-transparent"},se={class:"card-body px-3 px-md-4"},ae=s("div",{class:"heart3"},[s("i",{class:"bi bi-heart heart-click","data-heartStatus":"false"})],-1),re={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-10"},oe={class:"d-flex mb-4"},ie={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},ne={class:"row"},ce={class:"col-12 col-md-8 my-2"},le={key:0},de={class:"col-12 col-md-4"},he={class:"d-flex flex-column"},ue={class:"fs-4 fs-lg-5 fs-xl-4 text-decoration-line-through text-end"},ge={class:"d-flex flex-md-column align-items-end justify-content-end justify-content-sm-between justify-content-md-end"},_e=s("p",{class:"text-danger fw-bold d-none d-md-block"},"促銷價",-1),fe={class:"d-sm-flex flex-sm-column d-none d-md-none"},pe={key:0,class:"fs-7 fs-sm-6 text-dark2"},ye={key:1,class:"fs-7 fs-sm-6 text-danger"},me={key:2,class:"fs-7 fs-sm-6 text-dark2"},ke={key:3,class:"fs-6 text-danger"},be={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},ve={class:"col-12 d-none d-md-flex flex-md-column"},xe={key:0,class:"fs-6 text-dark2"},Ce={key:1,class:"fs-6 text-danger"},Pe={key:2,class:"fs-6 text-dark2"},we={key:3,class:"fs-6 text-danger"},Te={class:"card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4"},De={class:"d-flex align-items-end"},Le=["onClick","disabled"],Ne={key:0,class:"spinner-border spinner-grow-sm",role:"status"},Se={key:1,class:"btn btn-danger w-100 ms-2 px-2 px-md-3 py-2 disabled btn-danger-rounded",type:"button"},Ee={"aria-label":"Page navigation example",class:"my-10"},je={class:"pagination justify-content-center"},Ve=["value","onClick"],Ue={class:"page-item"};function Be(t,e,n,d,r,c){const T=w("VueLoading"),b=w("router-link");return o(),i(h,null,[v(T,{active:r.isLoading,class:"text-center","z-index":1060},null,8,["active"]),s("div",S,[s("nav",E,[s("ol",j,[s("li",V,[v(b,{to:"/",exact:"","active-class":"active-link"},{default:x(()=>[p(" 首頁 ")]),_:1})]),s("li",U,[r.fullPath!=="/TouristPackage"?(o(),L(b,{key:0,to:{path:"/TouristPackage"},exact:"","active-class":"active-link"},{default:x(()=>[p(" 南部旅遊方案 ")]),_:1})):(o(),i("span",B," 南部旅遊方案 "))]),r.selectedCategory!=="全部"?(o(),i("li",M,[s("span",null,l(r.selectedCategory),1)])):C("",!0)])]),s("div",F,[s("div",R,[s("div",z,[s("div",A,[q,s("ul",O,[(o(!0),i(h,null,f(c.filterCategory,(a,y)=>(o(),i("li",{class:"nav-item",key:y},[s("a",{class:m(["nav-link p-5 fs-5 link-color d-flex justify-content-between",{"active-category":r.selectedCategory===a}]),"data-name":"item","aria-current":"page",value:a,onClick:k(g=>c.filterProducts(a),["prevent"])},[p(l(a)+" ",1),s("span",null,l(c.filterCateNum[a]),1)],10,Y)]))),128))])])]),s("div",G,[r.status.loadingItem?(o(),i("div",H,K)):(o(),i("div",Q,[(o(!0),i(h,null,f(c.filteredProducts,(a,y)=>(o(),i("div",{class:"card mb-4 card-att",key:y+123},[s("div",W,[s("div",X,[s("span",Z,l(a.category),1),s("div",I,[s("img",{src:a.imageUrl,class:"card-img-top img-fluid",alt:a.title},null,8,$)])]),s("div",ee,[s("div",te,[s("div",se,[ae,s("h4",re,l(a.title),1),s("div",oe,[s("span",ie,l(a.tag_2),1)]),s("div",ne,[s("div",ce,[(o(!0),i(h,null,f(r.newProductsDes,g=>(o(),i("div",{key:g.id},[g.id===a.id?(o(),i("div",le,[(o(!0),i(h,null,f(g.descriptions,P=>(o(),i("p",{key:P},l(c.truncateContent(P,85)),1))),128))])):C("",!0)]))),128))]),s("div",de,[s("div",he,[s("p",ue," NT"+l(c.thousand(a.origin_price)),1),s("div",ge,[_e,s("div",fe,[r.currentDate<=a.endDate?(o(),i("p",pe," 預約："+l(a.startDate)+" ~ "+l(a.endDate),1)):(o(),i("p",ye,"預約時間已截止")),r.currentDate<=a.endDate?(o(),i("p",me," 出遊："+l(a.goStartDate)+" ~ "+l(a.goEndDate),1)):(o(),i("p",ke,"已出遊完成"))]),s("p",be," NT"+l(c.thousand(a.price)),1)])])])]),s("div",ve,[r.currentDate<=a.endDate?(o(),i("p",xe," 預約時間："+l(a.startDate)+" ~ "+l(a.endDate),1)):(o(),i("p",Ce,"預約時間已截止")),r.currentDate<=a.endDate?(o(),i("p",Pe," 出遊時間："+l(a.goStartDate)+" ~ "+l(a.goEndDate),1)):(o(),i("p",we,"已出遊完成"))])]),s("div",Te,[s("div",De,[v(b,{to:{name:"TouristSinglePackage",params:{category:a.category,title:a.title}},class:"btn-outline-square w-100 me-2 px-2 px-md-3",type:"button"},{default:x(()=>[p("行程介紹")]),_:2},1032,["to"]),r.currentDate<=a.endDate?(o(),i("a",{key:0,class:"btn-square w-100 ms-2 px-2 px-md-3",onClick:g=>c.addToCart(a.id,t.quantity,a.price),disabled:r.status.loadingItem===a.id,type:"button"},[r.status.loadingItem===a.id?(o(),i("span",Ne)):C("",!0),p(" 預約套裝行程")],8,Le)):(o(),i("a",Se,"預約時間截止"))])])])])])]))),128)),s("nav",Ee,[s("ul",je,[s("li",{class:m(["page-item",{disabled:!r.currentPage||r.currentPage===1}])},[s("a",{class:"page-link page-link-radius-2",href:"",onClick:e[0]||(e[0]=k(a=>c.getProducts(r.currentPage-1),["prevent"]))},"上一頁")],2),(o(!0),i(h,null,f(r.pageTotal,a=>(o(),i("li",{class:"page-item",key:a+123},[s("a",{class:m(["page-link page-link-0 rounded-0",{active:a===r.currentPage}]),href:"",value:a,onClick:k(y=>c.getProducts(a),["prevent"])},l(a),11,Ve)]))),128)),s("li",Ue,[s("a",{class:m(["page-link page-link-radius",{disabled:!r.currentPage||r.currentPage===r.pageTotal}]),href:"",onClick:e[1]||(e[1]=k(a=>c.getProducts(r.currentPage+1),["prevent"]))},"下一頁",2)])])])]))])])])])],64)}const Re=D(N,[["render",Be]]);export{Re as default};
