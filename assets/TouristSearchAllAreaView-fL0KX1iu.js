import{_ as m,c as r,F as u,h as _,a,n as f,A as p,o,t as c,j as v,b,w as y,d as D,r as C}from"./index-CnCUfF1T.js";const g="https://two024-south-json-server-vercel.onrender.com",w={data(){return{pageTotal:0,currentPage:1,limitPage:5,parsedLinks:"",products:[],user:"",newProductsDes:"",enabledProducts:[],carts:[],quantity:1,newQty:"",userId:"",token:"",newCarts:[],cartId:null,userCarts:[],transCartNumberStatus:!1,currentDate:""}},methods:{checkDate(){var e=new Date,t={year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate()},i=(t.month<10?"0":"")+t.month,d=(t.date<10?"0":"")+t.date,n=t.year+"-"+i+"-"+d;this.currentDate=n},getProducts(e=1){this.axios.get(`${g}/products?_limit=${this.limitPage}&_page=${e}`).then(t=>{var i=parseInt(t.headers["x-total-count"]);this.pageTotal=Math.ceil(i/this.limitPage),this.currentPage=e,this.products=t.data,this.enabledProducts=[],this.products.forEach(d=>{d.is_enabled===1&&this.enabledProducts.push(d)}),this.getNewText()}).catch(t=>{alert(`${t.message}`)})},thousand(e){return e!==void 0&&(e=e.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${e}`},truncateContent(e,t){return e&&e.length>t?e.substring(0,t)+"...":e},getNewText(){const e={};this.products.forEach(t=>{t.description&&t.description.split(";").forEach(d=>{const n=d.trim();e[t.id]||(e[t.id]=[]),e[t.id].push(n)})}),this.newProductsDes=Object.entries(e).map(([t,i])=>({id:t,descriptions:i}))},addToCart(e,t=1,i){if(console.log(e,t,i),!this.token)alert("請登入會員後，才能預約套裝行程");else{let d=!1,n=1;this.newCarts.forEach(l=>{l.productId===e&&l.id&&(d=!0,this.cartId=l.id)}),d?this.axios.put(`${g}/carts/${this.cartId}`,{productId:e,qty:t,price:i,total:t*i,userId:this.userId,final_total:t*i*n}).then(l=>{alert("已更新預約人數"),this.getCart()}).catch(l=>{console.error("更新預約人數失敗:",l),alert("更新預約人數失敗")}):this.axios.post(`${g}/carts`,{productId:e,qty:t,price:i,total:t*i,userId:this.userId,final_total:t*i*n}).then(l=>{alert("已預約成功"),this.getCart(),this.$emitter.emit("updateCart")}).catch(l=>{console.log(l),alert("預約失敗，再重新登入預約")})}},getCart(){this.axios.get(`${g}/carts`).then(e=>{this.carts=e.data,this.carts.forEach(t=>{t.userId===this.userId&&this.newCarts.push(t)})}).catch(e=>{alert("取得購物車資料失敗")})},getCookie(e){const t=document.cookie.split(";");for(let i of t){const[d,n]=i.trim().split("=");if(d===e)return n}return null}},mounted(){this.getProducts();const e=this.getCookie("userId"),t=this.getCookie("hexTokenU");this.userId=e*1,this.token=t,this.getCart(),this.checkDate()}},P={class:"row g-0"},T={class:"col-md-4"},S={class:"tag text-white"},E={class:"card-att-img h-100"},N=["src","alt"],j={class:"col-md-8"},V={class:"card h-100 border-0 bg-transparent"},B={class:"card-body px-3 px-md-4"},M=a("div",{class:"heart3"},[a("i",{class:"bi bi-heart heart-click","data-heartStatus":"false"})],-1),A={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-10"},F={class:"d-flex mb-4"},U={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},z={class:"row"},L={class:"col-12 col-md-8 my-2"},O={key:0},Q={class:"col-12 col-md-4"},Y={class:"d-flex flex-column"},G={class:"fs-4 fs-lg-5 fs-xl-4 text-decoration-line-through text-end"},H={class:"d-flex flex-md-column align-items-end justify-content-end justify-content-sm-between justify-content-md-end"},J=a("p",{class:"text-danger fw-bold d-none d-md-block"},"促銷價",-1),K={class:"d-sm-flex flex-sm-column d-none d-md-none"},R={key:0,class:"fs-7 fs-sm-6 text-dark2"},W={key:1,class:"fs-7 fs-sm-6 text-danger"},X={key:2,class:"fs-7 fs-sm-6 text-dark2"},Z={key:3,class:"fs-6 text-danger"},q={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},$={class:"col-12 d-none d-md-flex flex-md-column"},I={key:0,class:"fs-6 text-dark2"},tt={key:1,class:"fs-6 text-danger"},et={key:2,class:"fs-6 text-dark2"},st={key:3,class:"fs-6 text-danger"},at={class:"card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4"},nt={class:"d-flex align-items-end"},rt=["onClick"],ot={key:1,class:"btn btn-danger w-100 ms-2 px-2 px-md-3 py-2 disabled btn-danger-rounded",type:"button"},it={"aria-label":"Page navigation example",class:"my-10"},lt={class:"pagination justify-content-center"},ct=["value","onClick"],dt={class:"page-item"};function ht(e,t,i,d,n,l){const k=C("router-link");return o(),r(u,null,[(o(!0),r(u,null,_(n.enabledProducts,s=>(o(),r("div",{class:"card mb-4 card-att",key:s.id},[a("div",P,[a("div",T,[a("span",S,c(s.category),1),a("div",E,[a("img",{src:s.imageUrl,class:"card-img-top img-fluid",alt:s.title},null,8,N)])]),a("div",j,[a("div",V,[a("div",B,[M,a("h4",A,c(s.title),1),a("div",F,[a("span",U,c(s.tag_2),1)]),a("div",z,[a("div",L,[(o(!0),r(u,null,_(n.newProductsDes,h=>(o(),r("div",{key:h.id},[h.id===s.id?(o(),r("div",O,[(o(!0),r(u,null,_(h.descriptions,x=>(o(),r("p",{key:x},c(l.truncateContent(x,85)),1))),128))])):v("",!0)]))),128))]),a("div",Q,[a("div",Y,[a("p",G," NT"+c(l.thousand(s.origin_price)),1),a("div",H,[J,a("div",K,[n.currentDate<=s.endDate?(o(),r("p",R," 預約："+c(s.startDate)+" ~ "+c(s.endDate),1)):(o(),r("p",W,"預約時間已截止")),n.currentDate<=s.endDate?(o(),r("p",X," 出遊："+c(s.goStartDate)+" ~ "+c(s.goEndDate),1)):(o(),r("p",Z,"已出遊完成"))]),a("p",q," NT"+c(l.thousand(s.price)),1)])])])]),a("div",$,[n.currentDate<=s.endDate?(o(),r("p",I," 預約時間："+c(s.startDate)+" ~ "+c(s.endDate),1)):(o(),r("p",tt,"預約時間已截止")),n.currentDate<=s.endDate?(o(),r("p",et," 出遊時間："+c(s.goStartDate)+" ~ "+c(s.goEndDate),1)):(o(),r("p",st,"已出遊完成"))])]),a("div",at,[a("div",nt,[b(k,{to:{name:"TouristSinglePackage",params:{category:s.category,title:s.title}},class:"btn-outline-square w-100 me-2 px-2 px-md-3",type:"button"},{default:y(()=>[D("行程介紹")]),_:2},1032,["to"]),n.currentDate<=s.endDate?(o(),r("a",{key:0,class:"btn-square w-100 ms-2 px-2 px-md-3",onClick:h=>l.addToCart(s.id,n.quantity,s.price),type:"button"},"預約套裝行程",8,rt)):(o(),r("a",ot,"預約時間截止"))])])])])])]))),128)),a("nav",it,[a("ul",lt,[a("li",{class:f(["page-item",{disabled:!n.currentPage||n.currentPage===1}])},[a("a",{class:"page-link page-link-radius-2",href:"",onClick:t[0]||(t[0]=p(s=>l.getProducts(n.currentPage-1),["prevent"]))},"上一頁")],2),(o(!0),r(u,null,_(n.pageTotal,s=>(o(),r("li",{class:"page-item",key:s+123},[a("a",{class:f(["page-link page-link-0 rounded-0",{active:s===n.currentPage}]),href:"",value:s,onClick:p(h=>l.getProducts(s),["prevent"])},c(s),11,ct)]))),128)),a("li",dt,[a("a",{class:f(["page-link page-link-radius",{disabled:!n.currentPage||n.currentPage===n.pageTotal}]),href:"",onClick:t[1]||(t[1]=p(s=>l.getProducts(n.currentPage+1),["prevent"]))},"下一頁",2)])])])],64)}const _t=m(w,[["render",ht]]);export{_t as default};
