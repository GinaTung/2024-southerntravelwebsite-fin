import{s as n}from"./sweetAlert-M_FrQGf7.js";import{_ as A,c as l,b as v,a as e,w as k,g as P,t as d,j as w,F as _,h as C,n as u,A as p,r as b,o as c,d as f}from"./index-CrQ_lYDm.js";const g="http://localhost:3000",L={data(){return{allAttractions:[],enabledAttractions:[],searchChiayi:[],serchTainan:[],searchKaohsiung:[],fullPath:"",currentURL:"",selectedCategory:"全部",currentPage:1,limitPage:6,pageTotal:0,attractionsCategory:[],isLoading:!1,status:{loadingItem:!1},category:"全部",heartData:[],isFavorite:{},userId:"",token:""}},computed:{filterCategory(){const t=this.attractionsCategory.map(o=>o.category),s=[...new Set(t)];return s.unshift("全部"),s},filterCateNum(){const t={};return this.attractionsCategory.forEach(s=>{t[s.category]?t[s.category]+=1:t[s.category]=1}),t.全部=this.attractionsCategory.length,t},filteredProducts(){return this.selectedCategory==="全部"||!this.selectedCategory?this.enabledAttractions:this.enabledAttractions.filter(t=>t.category===this.selectedCategory)}},watch:{$route(t,s){this.currentURL=t.fullPath,this.$root.navigatedFromHeader&&t.fullPath!=="/TouristAttractions"&&(this.selectedCategory="全部",this.status.loadingItem=!0,this.getAttractions(),this.$root.navigatedFromHeader=!1)}},created(){this.category=this.$route.query.category,this.selectedCategory=this.category,this.getAttractions()},methods:{getHeartData(){this.axios.get(`${g}/hearts`).then(t=>{t.data.forEach(s=>{s.userId===this.userId&&(this.isFavorite[s.productId]=!0)})}).catch(t=>{n.threeLayerCheckType("error","取得愛心收藏資料失敗")})},toggleFavorite(t,s,o){this.token?this.axios.get(`${g}/hearts`).then(h=>{const r=h.data.find(i=>i.productId===t&&i.userId===this.userId);r?(console.log(r),this.axios.delete(`${g}/hearts/${r.id}`).then(i=>{console.log(i),this.isFavorite[t]=!1,n.threeLayerCheckType("success",`取消收藏 ${o} 成功`),this.getHeartData()}).catch(i=>{n.threeLayerCheckType("error","取消收藏資料失敗")})):this.axios.post(`${g}/hearts`,{productId:t,category:s,title:o,userId:this.userId,tag:"旅遊景點"}).then(i=>{this.isFavorite[t]=!0,n.threeLayerCheckType("success",`已加入收藏 ${o} 成功`),this.getHeartData()}).catch(i=>{n.threeLayerCheckType("error","收藏資料失敗")})}).catch(h=>{n.threeLayerCheckType("error","取得愛心收藏資料失敗")}):n.threeLayerCheckType("warning","請登入會員後，才能加入收藏")},getAttractions(t=1){this.axios.get(`${g}/attractions`).then(s=>{this.attractionsCategory=s.data.filter(o=>o.is_enabled===1),setTimeout(()=>{this.isLoading=!1},1e3)}).catch(s=>{n.threeLayerCheckType("error","取得景點資料失敗")}),this.selectedCategory==="全部"||!this.selectedCategory?this.axios.get(`${g}/attractions?_limit=${this.limitPage}&_page=${t}`).then(s=>{var o=parseInt(s.headers["x-total-count"]);this.pageTotal=Math.ceil(o/this.limitPage),this.currentPage=t,this.allAttractions=s.data,this.enabledAttractions=this.allAttractions.filter(h=>h.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristAttractions",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(s=>{n.threeLayerCheckType("error","取得全部景點資料失敗")}):this.axios.get(`${g}/attractions?category=${this.selectedCategory}&_limit=${this.limitPage}&_page=${t}`).then(s=>{var o=parseInt(s.headers["x-total-count"]);this.pageTotal=Math.ceil(o/this.limitPage),this.currentPage=t,this.allAttractions=s.data,this.enabledAttractions=this.allAttractions.filter(h=>h.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristAttractions",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(s=>{n.threeLayerCheckType("error","取得區域景點資料失敗")})},filterProducts(t){this.selectedCategory=t,this.status.loadingItem=!0,this.getAttractions()},truncateContent(t,s){return t&&t.length>s?t.substring(0,s)+"...":t},getCookie(t){const s=document.cookie.split(";");for(let o of s){const[h,r]=o.trim().split("=");if(h===t)return r}return null}},mounted(){this.isLoading=!0;const t=this.getCookie("userId"),s=this.getCookie("hexTokenU");this.userId=t*1,this.token=s,this.getAttractions(),this.getHeartData(),window.scrollTo(0,0),this.fullPath=this.$route.fullPath}},F={class:"container py-10 py-lg-30"},D={style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",class:"pb-5 pb-lg-15"},I={class:"breadcrumb mb-0 fs-5"},N={class:"breadcrumb-item"},V={class:"breadcrumb-item","aria-current":"page"},H={key:1},U={key:0,class:"breadcrumb-item","aria-current":"page"},j={class:"tourist-list"},q={class:"row"},B={class:"col-12 col-md-3 mb-5 mb-md-6 mb-lg-0 d-none d-lg-flex"},z={class:"border-1 border w-100 rounded-1 h-100"},E=e("p",{class:"fs-4 p-5 bg-primary-500 text-white"},"地區篩選",-1),M={class:"nav flex-column"},S=["onClick"],$={class:"col-12 col-lg-9"},R={key:0,class:"text-center",style:{margin:"150px"}},K=e("div",{class:"spinner-border",role:"status",style:{width:"3rem",height:"3rem",color:"#43b8bd"}},[e("span",{class:"visually-hidden"},"Loading...")],-1),G=[K],J={key:1},O={class:"row g-3"},Q={class:"card card-att h-100"},W={class:"tag text-white"},X={class:"card-att-img"},Y=["src"],Z=["onClick"],tt={style:{transform:"rotate(0)"}},et={class:"card-body card-body-att"},st={class:"card-title d-flex justify-content-between align-items-center card-title-att"},rt={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att"},at={class:"card-text card-font-truncate"},it={class:"card-footer text-end border-0"},ot={"aria-label":"Page navigation example",class:"my-10"},ct={class:"pagination justify-content-center"},lt=["onClick"];function nt(t,s,o,h,r,i){const x=b("VueLoading"),m=b("router-link");return c(),l(_,null,[v(x,{active:r.isLoading,class:"text-center","z-index":1060},null,8,["active"]),e("div",F,[e("nav",D,[e("ol",I,[e("li",N,[v(m,{to:"/",exact:"","active-class":"active-link"},{default:k(()=>[f("首頁")]),_:1})]),e("li",V,[r.fullPath!=="/TouristAttractions"?(c(),P(m,{key:0,to:{path:"/TouristAttractions"},exact:"","active-class":"active-link"},{default:k(()=>[f(" 南部旅遊景點 ")]),_:1})):(c(),l("span",H," 南部旅遊景點 "))]),r.selectedCategory!=="全部"?(c(),l("li",U,[e("span",null,d(r.selectedCategory),1)])):w("",!0)])]),e("div",j,[e("div",q,[e("div",B,[e("div",z,[E,e("ul",M,[(c(!0),l(_,null,C(i.filterCategory,(a,y)=>(c(),l("li",{class:"nav-item",key:y},[e("a",{class:u(["nav-link p-5 fs-5 link-color d-flex justify-content-between",{"active-category":r.selectedCategory===a}]),href:"#","aria-current":"page",onClick:p(T=>i.filterProducts(a),["prevent"])},[f(d(a)+" ",1),e("span",null,d(i.filterCateNum[a]),1)],10,S)]))),128))])])]),e("div",$,[r.status.loadingItem?(c(),l("div",R,G)):(c(),l("div",J,[e("div",O,[(c(!0),l(_,null,C(i.filteredProducts,(a,y)=>(c(),l("div",{class:"col-12 col-md-6 col-lg-4",key:y+123},[e("div",Q,[e("span",W,d(a.category),1),e("div",X,[e("img",{src:a.imageUrl,class:"img-fluid",alt:""},null,8,Y)]),e("div",{class:"heart",onClick:T=>i.toggleFavorite(a.id,a.category,a.title)},[e("i",{class:u(["bi",{"bi-heart-fill":r.isFavorite[a.id],"bi-heart":!r.isFavorite[a.id]}]),style:{"font-size":"24px"}},null,2)],8,Z),e("div",tt,[e("div",et,[e("div",st,[e("h4",rt,d(a.title),1)]),e("p",at,d(i.truncateContent(a.description,65)),1)]),e("div",it,[v(m,{to:{name:"TouristSingleAttraction",params:{category:a.category,title:a.title}},class:"fs-5 stretched-link"},{default:k(()=>[f("more")]),_:2},1032,["to"])])])])]))),128))]),e("nav",ot,[e("ul",ct,[e("li",{class:u(["page-item",{disabled:!r.currentPage||r.currentPage===1}])},[e("button",{class:"page-link page-link-radius-2",onClick:s[0]||(s[0]=p(a=>r.currentPage>1&&i.getAttractions(r.currentPage-1),["prevent"]))}," 上一頁 ")],2),(c(!0),l(_,null,C(r.pageTotal,a=>(c(),l("li",{class:"page-item",key:`page-${a}`},[e("button",{class:u(["page-link page-link-0 rounded-0",{active:a===r.currentPage}]),onClick:p(y=>i.getAttractions(a),["prevent"])},d(a),11,lt)]))),128)),e("li",{class:u(["page-item",{disabled:!r.currentPage||r.currentPage===r.pageTotal}])},[e("button",{class:"page-link page-link-radius",onClick:s[1]||(s[1]=p(a=>r.currentPage<r.pageTotal&&i.getAttractions(r.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])]))])])])])],64)}const gt=A(L,[["render",nt]]);export{gt as default};
