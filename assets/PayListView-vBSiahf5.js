import{U as M}from"./UserProductModal-hVwLXBIz.js";import{C as N}from"./CartNavbar-79_qkU_G.js";import{C as w}from"./collapse-2HEcf_yr.js";import{_ as U,c,b as l,a as e,d as b,t as n,f as D,v as O,F as v,h as C,w as E,r as f,o as u,B as S,n as _,j as F}from"./index-EB2s3bge.js";const g="https://two024-south-json-server-vercel.onrender.com",L={components:{CartNavbar:N,UserProductModal:M},data(){return{activities:["帳號匯款","信用卡付款"],cartsData:[],isOpen:!1,isOrderOpen:!1,headerCollapse:{},products:[],product:{},cartTotal:0,orderData:[],userOrderData:[],userOrderData_user:"",user:{payMethod:"",cardDate:"",cardNum:"",firstNum:"",secondNum:"",thirdNum:"",fourthNum:""},product_id:"",userId:"",cartDataId:"",userCart:[],total:0,productId:"",productTitle:"",orderId:0,isLoading:!1,userCarts:[],cartsLength:0,isStatus:!1}},watch:{$route(){this.headerCollapse.hide(),this.orderCollapse.hide()}},methods:{backPage(){this.$router.go(-1),this.getCartsData()},toggleOpen(){this.isOpen=!this.isOpen},toggleOpenOrder(){this.isOrderOpen=!this.isOrderOpen},isOver18(s){if(s.length===0)return"信用卡有效月年 為必填";const t=new Date(s),o=new Date,h=o.getFullYear()-t.getFullYear();return o.getMonth()<t.getMonth()||o.getMonth()===t.getMonth()?h-1<18?"主要聯繫人需滿18歲":!0:h<18?"主要聯繫人需滿18歲":!0},forId(s,t){this.productId=s,this.productTitle=t,this.$refs.userProductModal.openModal()},getCartsData(){this.axios.get(`${g}/cartsData`).then(s=>{this.cartsData=s.data,this.cartsData.forEach(t=>{t.status===!1&&t.data.forEach(o=>{o.userId===this.userId&&(this.userCart.push(o),this.isLoading=!1)})}),this.userCart.forEach(t=>{this.total+=t.final_total})}).catch(s=>{this.isLoading=!1,console.log(s)})},getCookie(s){const t=document.cookie.split(";");for(let o of t){const[h,r]=o.trim().split("=");if(h===s)return r}return null},deleteCartsUSerData(){this.axios.get(`${g}/carts?userId=${this.userId}`).then(s=>{s.data.map(o=>o.id).forEach(o=>{this.axios.delete(`${g}/carts/${o}`).then(h=>{}).catch(h=>{console.error(`Failed to delete cart with ID: ${o}`,h)})})}).catch(s=>{console.error("Error fetching cart IDs:",s)})},changeCartsDataStatus(){this.axios.patch(`${g}/cartsData/${this.cartDataId}`,{status:!0,orderId:this.orderId}).then(s=>{}).catch(s=>{console.log(s)})},getOrderData(){this.axios.get(`${g}/orders`).then(s=>{this.orderData=s.data,this.orderData.forEach(t=>{t.user.userId===this.userId&&t.user.status===!1&&(this.userOrderData=t,this.orderId=t.id)}),this.userOrderData_user=this.userOrderData.user,this.isStatus===!0&&(this.changeCartsDataStatus(),this.status=!1)}).catch(s=>{console.log(s)})},updateOderData(){if(console.log(this.user.payMethod),!this.user.payMethod){alert("請填寫所有必填欄位");return}if(this.user.payMethod==="信用卡付款"&&!this.user.cardDate&&!this.user.cardNum){alert("請填寫所有必填欄位");return}if(this.user.payMethod==="信用卡付款"&&!this.user.firstNum&&!this.user.secondNum&&!this.user.thirdNum&&!this.user.fourthNum){alert("請填寫所有必填欄位");return}this.status=!0,this.getOrderData(),this.deleteCartsUSerData(),this.changeCartsDataStatus(),this.orderData.forEach(s=>{if(s.user.userId===this.userId&&s.user.cartDataId===this.cartDataId){const t={create_at:new Date,name:s.user.name,email:s.user.email,tel:s.user.tel,address:s.user.address,birthday:s.user.birthday,comment:s.user.comment,shippingMethod:s.user.shippingMethod,userId:s.user.userId,cartDataId:s.user.cartDataId,passport:s.user.passport,memberId:s.user.memberId,appellation:s.user.appellation,status:!1,payMethod:this.user.payMethod};this.axios.patch(`${g}/orders/${s.id}`,{user:t,status:!1,billStatus:!1,checkDataStatus:!1}).then(o=>{console.log(o),this.$router.push({path:"/cart/orderDone"}),document.cookie="cartDataId=; expires="}).catch(o=>{console.log(o)})}})},thousand(s){return s!==void 0&&(s=s.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${s}`}},mounted(){const s=this.getCookie("userId"),t=this.getCookie("cartDataId");this.userId=s*1,this.cartDataId=t*1,this.isLoading=!0,this.getCartsData(),this.getOrderData(),this.headerCollapse=new w(this.$refs.headerCollapse,{toggle:!1})}},P={class:"container py-10 py-lg-30"},T={class:"row"},B={class:"col-md-6 mx-auto pb-5 pb-lg-15"},j={class:"mb-4"},q={class:"d-grid gap-2"},z=e("br",null,null,-1),Y={key:0,class:"bi bi-chevron-down"},A={key:1,class:"bi bi-chevron-up"},R={class:"collapse",id:"collapseExample",ref:"headerCollapse"},G={class:"card card-body rounded-0"},H={class:"col-12 col-md-5 col-lg-4"},J=["src","alt"],K={class:"col-12 col-md-7 col-lg-8 d-flex flex-column justify-content-between"},Q={class:"mt-4 mt-md-0 mb-4"},W={class:"mb-4"},X={class:"mb-4"},Z={class:"mb-4"},$=["onClick"],ee={class:"mb-4"},se={class:"d-grid gap-2"},te={key:0,class:"bi bi-chevron-down"},re={key:1,class:"bi bi-chevron-up"},ae={class:"collapse",id:"collapseOrder",ref:"orderCollapse"},oe={class:"card card-body rounded-0"},le={class:"row p-4 p-md-5"},de={class:"col-12 col-md-6 col-lg-6"},ie={class:"col-12 col-md-6 col-lg-6"},ne={class:"row"},ce={class:"col-12 col-md-6 mb-4"},ue=e("h3",{class:"mb-4"},"付款方式",-1),he={class:"form-check mb-4 ps-0"},pe=["value"],me={class:"radio-label pe-5 fs-5"},fe={key:0},_e=e("label",{for:"floatingAddress",class:"fs-5 mb-4"},"信用卡卡號",-1),ge={class:"row g-3 d-flex mb-4"},be={class:"col-3 d-flex flex-column"},De={class:"col-3 d-flex flex-column"},ve={class:"col-3 d-flex flex-column"},Oe={class:"col-3 d-flex flex-column"},Ce={class:"mb-4"},ye=e("label",{for:"floatingDate",class:"fs-5 mb-4"},"信用卡有效月年",-1),Ie={class:"mb-4"},xe=e("label",{for:"floatingDate",class:"fs-5 mb-4"},"信用卡背後末三碼",-1),ke={class:"d-flex justify-content-between"};function Ve(s,t,o,h,r,i){const y=f("VueLoading"),I=f("CartNavbar"),p=f("VeeField"),m=f("ErrorMessage"),x=f("VeeForm"),k=f("UserProductModal");return u(),c(v,null,[l(y,{active:r.isLoading,class:"text-center","z-index":1060},null,8,["active"]),e("div",P,[e("div",T,[e("div",B,[l(I)])]),e("div",j,[e("p",q,[e("button",{class:"btn btn-primary-600 border-top",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample",onClick:t[0]||(t[0]=(...a)=>i.toggleOpen&&i.toggleOpen(...a))},[b(" 總計："+n(i.thousand(r.total))+"元",1),z,b("購買清單 "),r.isOpen===!1?(u(),c("i",Y)):(u(),c("i",A))])]),D(e("div",R,[e("div",G,[(u(!0),c(v,null,C(r.userCart,a=>(u(),c("div",{class:"row p-4 p-md-6",key:a.id},[e("div",H,[e("img",{src:a.product.imageUrl,alt:a.product.title,class:"img-fluid h-100"},null,8,J)]),e("div",K,[e("div",null,[e("h4",Q,"套裝行程名稱："+n(a.product.title),1),e("h5",W,"單價："+n(i.thousand(a.product.price)),1),e("h5",X,"預約數量："+n(a.qty)+" 位",1),e("h5",Z,"總計："+n(i.thousand(a.final_total)),1)]),e("div",null,[e("button",{type:"button",class:"btn-turquoise border-0 rounded-1",onClick:d=>i.forId(a.product.id,a.product.title)}," 查看更多 ",8,$)])])]))),128))])],512),[[O,r.isOpen]])]),e("div",ee,[e("p",se,[e("button",{class:"btn btn-primary-600 border-top",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseOrder","aria-expanded":"false","aria-controls":"collapseOrder",onClick:t[1]||(t[1]=(...a)=>i.toggleOpenOrder&&i.toggleOpenOrder(...a))},[b(" 訂單資料及收件方式 "),r.isOrderOpen===!1?(u(),c("i",te)):(u(),c("i",re))])]),D(e("div",ae,[e("div",oe,[e("div",le,[e("div",de,[e("h5",null,"主要聯繫人名字："+n(r.userOrderData_user.name),1),e("h5",null,"主要聯繫人電話："+n(r.userOrderData_user.tel),1),e("h5",null,"主要聯繫人身分證字號："+n(r.userOrderData_user.memberId),1),e("h5",null,"主要聯繫人護照號碼："+n(r.userOrderData_user.passport),1)]),e("div",ie,[e("h5",null,"主要聯繫人地址："+n(r.userOrderData_user.address),1),e("h5",null,"收取方式："+n(r.userOrderData_user.shippingMethod),1),e("h5",null,"備註："+n(r.userOrderData_user.comment),1)])])])],512),[[O,r.isOrderOpen]])]),l(x,{id:"form",ref:"form"},{default:E(({errors:a})=>[e("div",ne,[e("div",ce,[ue,e("div",he,[(u(!0),c(v,null,C(r.activities,d=>(u(),c("label",{class:"radio is-inline",key:d},[D(e("input",{type:"radio",value:d,class:"radio-input me-1",rules:"required",name:"activity","onUpdate:modelValue":t[2]||(t[2]=V=>r.user.payMethod=V)},null,8,pe),[[S,r.user.payMethod]]),e("span",me,n(d),1)]))),128))]),r.user.payMethod==="信用卡付款"?(u(),c("div",fe,[_e,e("div",ge,[e("div",be,[l(p,{name:"first",type:"text",class:_(["form-control rounded-1",{"is-invalid":a.first}]),placeholder:"4622",id:"first",modelValue:r.user.firstNum,"onUpdate:modelValue":t[3]||(t[3]=d=>r.user.firstNum=d),"aria-label":"First",rules:"numeric:true|length:4"},null,8,["class","modelValue"]),l(m,{name:"first",class:"invalid-feedback mt-4"})]),e("div",De,[l(p,{name:"second",type:"text",class:_(["form-control rounded-1",{"is-invalid":a.second}]),placeholder:"2223","aria-label":"second",modelValue:r.user.secondNum,"onUpdate:modelValue":t[4]||(t[4]=d=>r.user.secondNum=d),id:"second",rules:"numeric:true|length:4"},null,8,["class","modelValue"]),l(m,{name:"second",class:"invalid-feedback mt-4"})]),e("div",ve,[l(p,{name:"third",type:"text",class:_(["form-control rounded-1",{"is-invalid":a.third}]),placeholder:"2223",modelValue:r.user.thirdNum,"onUpdate:modelValue":t[5]||(t[5]=d=>r.user.thirdNum=d),"aria-label":"third",id:"third",rules:"numeric:true|length:4"},null,8,["class","modelValue"]),l(m,{name:"third",class:"invalid-feedback mt-4"})]),e("div",Oe,[l(p,{name:"fourth",type:"text",class:_(["form-control rounded-1",{"is-invalid":a.fourth}]),placeholder:"2223",modelValue:r.user.fourthNum,"onUpdate:modelValue":t[6]||(t[6]=d=>r.user.fourthNum=d),"aria-label":"fourth",id:"fourth",rules:"numeric:true|length:4"},null,8,["class","modelValue"]),l(m,{name:"fourth",class:"invalid-feedback mt-4"})])]),e("div",Ce,[ye,l(p,{type:"month",name:"floatingDate",class:_(["form-control rounded-1",{"is-invalid":a.floatingDate}]),id:"floatingDate",placeholder:"03/2024",modelValue:r.user.cardDate,"onUpdate:modelValue":t[7]||(t[7]=d=>r.user.cardDate=d),rules:i.isOver18},null,8,["class","modelValue","rules"]),l(m,{name:"floatingDate",class:"invalid-feedback"})]),e("div",Ie,[xe,l(p,{type:"number",name:"信用卡背後末三碼",class:_(["form-control rounded-1",{"is-invalid":a.信用卡背後末三碼}]),id:"floatingNum",placeholder:"123",rules:"numeric:true|length:3"},null,8,["class"]),l(m,{name:"信用卡背後末三碼",class:"invalid-feedback"})])])):F("",!0)])])]),_:1},512),e("div",ke,[e("button",{class:"btn-cerulean w-50 w-md-25 fs-5 mt-4 me-1",onClick:t[8]||(t[8]=(...a)=>i.backPage&&i.backPage(...a)),type:"button"}," 上一步 "),e("button",{class:"btn-square mt-4 fs-5 w-50 w-md-25",type:"button",onClick:t[9]||(t[9]=(...a)=>i.updateOderData&&i.updateOderData(...a))}," 下一步 ")])]),l(k,{ref:"userProductModal",userCart:r.userCart,productId:r.productId,productTitle:r.productTitle},null,8,["userCart","productId","productTitle"])],64)}const Ee=U(L,[["render",Ve]]);export{Ee as default};
