import{U as y}from"./UserProductModal-IoPLx4p2.js";import{C as D}from"./CartNavbar-twcb1HKo.js";import{C}from"./collapse-_514yXV3.js";import{_ as k,c,b as m,a as t,d as _,t as u,f as r,v as w,F as g,h as M,i as n,B as b,r as f,o as p}from"./index-xBcrsHzS.js";const h="https://two024-south-json-server-vercel.onrender.com",U={components:{CartNavbar:D,UserProductModal:y},data(){return{cartsData:[],userCart:[],userId:"",isOpen:!1,headerCollapse:{},order:{},user:{name:"",email:"",tel:"",address:"",birthday:"",comment:"",shippingMethod:"",passport:"",memberId:"",appellation:""},shippingMethod:["電子郵件","郵寄"],total:0,productId:"",productTitle:"",cartDataId:"",ordersData:[],isLoading:!1}},watch:{$route(){this.headerCollapse.hide()}},methods:{backPage(){this.$router.go(-1)},toggleOpen(){this.isOpen=!this.isOpen},forId(l,e){this.productId=l,this.productTitle=e,this.$refs.userProductModal.openModal()},getCart(){this.axios.get(`${h}/cartsData`).then(l=>{this.cartsData=l.data,this.cartsData.forEach(e=>{this.cartDataId=e.id,e.status===!1&&e.data.forEach(a=>{a.userId===this.userId&&(this.userCart.push(a),this.isLoading=!1)})}),this.userCart.forEach(e=>{this.total+=e.final_total}),console.log(this.cartDataId)}).catch(l=>{console.log(l),this.isLoading=!1})},getCookie(l){const e=document.cookie.split(";");for(let a of e){const[i,o]=a.trim().split("=");if(i===l)return o}return null},thousand(l){return l!==void 0&&(l=l.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${l}`},getOderData(){this.axios.get(`${h}/orders`).then(l=>{this.ordersData=l.data}).catch(l=>{console.log(l)})},orderData(){const l=this.ordersData.some(a=>a.user.cartDataId===this.cartDataId&&a.user.status===!1);let e=0;if(this.ordersData.forEach(a=>{a.user.cartDataId===this.cartDataId&&a.user.status===!1&&(e=a.id)}),l){const a={create_at:new Date,name:this.user.name,email:this.user.email,tel:this.user.tel,address:this.user.address,birthday:this.user.birthday,comment:this.user.comment,shippingMethod:this.user.shippingMethod,passport:this.user.passport,memberId:this.user.memberId,appellation:this.user.appellation,userId:this.userId,cartDataId:this.cartDataId,status:!1};this.axios.put(`${h}/orders/${e}`,{user:a}).then(i=>{this.order=i.data}).catch(i=>{console.log(i)})}else{const a={create_at:new Date,name:this.user.name,email:this.user.email,tel:this.user.tel,address:this.user.address,birthday:this.user.birthday,comment:this.user.comment,shippingMethod:this.user.shippingMethod,passport:this.user.passport,memberId:this.user.memberId,appellation:this.user.appellation,userId:this.userId,cartDataId:this.cartDataId,status:!1};this.axios.post(`${h}/orders`,{user:a}).then(i=>{this.order=i.data}).catch(i=>{console.log(i)})}}},mounted(){const l=this.getCookie("userId");this.getCookie("cartDataId"),this.userId=l*1,this.getCart(),this.getOderData(),this.headerCollapse=new C(this.$refs.headerCollapse,{toggle:!1}),this.isLoading=!0}},V={class:"container py-10 py-lg-30"},E={class:"row"},T={class:"col-md-6 mx-auto pb-5 pb-lg-15"},O={class:"mb-4"},P={class:"d-grid gap-2"},L=t("br",null,null,-1),N={key:0,class:"bi bi-chevron-down"},S={key:1,class:"bi bi-chevron-up"},B={class:"collapse",id:"collapseExample",ref:"headerCollapse"},F={class:"card card-body rounded-0"},A={class:"col-12 col-md-5 col-lg-4"},j=["src","alt"],q={class:"col-12 col-md-7 col-lg-8 d-flex flex-column justify-content-between"},z={class:"mt-4 mt-md-0 mb-4"},G={class:"mb-4"},H={class:"mb-4"},J={class:"mb-4"},K=["onClick"],Q={class:"row"},R={class:"col-12 col-md-6 mb-4"},W=t("h3",{class:"mb-4"},"訂單資料",-1),X={class:"form-floating mb-4"},Y=t("label",{for:"floatingInput"},"主要聯繫人",-1),Z={class:"form-floating mb-4"},$=t("option",{selected:"",value:"",disabled:""},"請選擇稱謂",-1),tt=t("option",{value:"female"},"女士",-1),et=t("option",{value:"male"},"男士",-1),st=[$,tt,et],ot=t("label",{for:"floatingAppellation"},"稱謂",-1),lt={class:"form-floating mb-4"},at=t("label",{for:"floatingMemberId"},"身分證字號",-1),rt={class:"form-floating mb-4"},it=t("label",{for:"floatingPassport"},"護照號碼",-1),dt={class:"form-floating mb-4"},nt=t("label",{for:"floatingDate"},"生日",-1),ct={class:"form-floating mb-4"},ut=t("label",{for:"floatingTel"},"電話",-1),pt={class:"form-floating mb-4"},ht=t("label",{for:"floatingEmail"},"電子郵件",-1),mt={class:"form-floating mb-4"},ft=t("label",{for:"floatingAddress"},"住址",-1),_t={class:"col-12 col-md-6 mb-4"},gt=t("h3",{class:"mb-4"},"取件方式",-1),bt={class:"form-floating mb-4"},vt=t("option",{selected:"",value:"",disabled:""},"請選擇取件方式",-1),It=t("option",{value:"電子郵件"},"電子郵件",-1),xt=t("option",{value:"郵寄"},"郵寄",-1),yt=[vt,It,xt],Dt=t("label",{for:"floatingSelect2"},"選擇取件方式",-1),Ct={class:"form-floating mb-4"},kt=t("label",{for:"floatingTextarea2"},"備註(如:飲食、暈車等注意事項)",-1),wt={class:"d-flex justify-content-between"};function Mt(l,e,a,i,o,d){const v=f("VueLoading"),I=f("CartNavbar"),x=f("UserProductModal");return p(),c(g,null,[m(v,{active:o.isLoading,class:"text-center","z-index":1060},null,8,["active"]),t("div",V,[t("div",E,[t("div",T,[m(I)])]),t("div",O,[t("p",P,[t("button",{class:"btn btn-primary-600 border-top",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample",onClick:e[0]||(e[0]=(...s)=>d.toggleOpen&&d.toggleOpen(...s))},[_(" 總計："+u(d.thousand(o.total))+"元",1),L,_("購買清單 "),o.isOpen===!1?(p(),c("i",N)):(p(),c("i",S))])]),r(t("div",B,[t("div",F,[(p(!0),c(g,null,M(o.userCart,s=>(p(),c("div",{class:"row p-4 p-md-10",key:s.id},[t("div",A,[t("img",{src:s.product.imageUrl,alt:s.product.title,class:"img-fluid h-100"},null,8,j)]),t("div",q,[t("div",null,[t("h4",z,"套裝行程名稱："+u(s.product.title),1),t("h5",G,"單價："+u(d.thousand(s.product.price)),1),t("h5",H,"預約數量："+u(s.qty)+" 位",1),t("h5",J,"總計："+u(d.thousand(s.final_total)),1)]),t("div",null,[t("button",{type:"button",class:"btn-turquoise border-0 rounded-1",onClick:Ut=>d.forId(s.product.id,s.product.title)}," 查看更多 ",8,K)])])]))),128))])],512),[[w,o.isOpen]])]),t("div",Q,[t("div",R,[W,t("div",X,[r(t("input",{type:"text",class:"form-control rounded-1",id:"floatingInput",placeholder:"王小明","onUpdate:modelValue":e[1]||(e[1]=s=>o.user.name=s)},null,512),[[n,o.user.name]]),Y]),t("div",Z,[r(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.user.appellation=s),class:"form-select rounded-1",id:"floatingAppellation","aria-label":"Floating label select example"},st,512),[[b,o.user.appellation]]),ot]),t("div",lt,[r(t("input",{type:"text",class:"form-control rounded-1",id:"floatingMemberId",placeholder:"身分證字號","onUpdate:modelValue":e[3]||(e[3]=s=>o.user.memberId=s)},null,512),[[n,o.user.memberId]]),at]),t("div",rt,[r(t("input",{type:"text",class:"form-control rounded-1",id:"floatingPassport",placeholder:"護照號碼","onUpdate:modelValue":e[4]||(e[4]=s=>o.user.passport=s)},null,512),[[n,o.user.passport]]),it]),t("div",dt,[r(t("input",{type:"date",class:"form-control rounded-1",id:"floatingDate",placeholder:"2024/03/08","onUpdate:modelValue":e[5]||(e[5]=s=>o.user.birthday=s)},null,512),[[n,o.user.birthday]]),nt]),t("div",ct,[r(t("input",{type:"tel",class:"form-control rounded-1",id:"floatingTel",placeholder:"tel","onUpdate:modelValue":e[6]||(e[6]=s=>o.user.tel=s)},null,512),[[n,o.user.tel]]),ut]),t("div",pt,[r(t("input",{type:"email",class:"form-control rounded-1",id:"floatingEmail",placeholder:"name@example.com","onUpdate:modelValue":e[7]||(e[7]=s=>o.user.email=s)},null,512),[[n,o.user.email]]),ht]),t("div",mt,[r(t("input",{type:"text",class:"form-control rounded-1",id:"floatingAddress",placeholder:"縣市鄉鎮市區","onUpdate:modelValue":e[8]||(e[8]=s=>o.user.address=s)},null,512),[[n,o.user.address]]),ft])]),t("div",_t,[gt,t("div",bt,[r(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.user.shippingMethod=s),class:"form-select rounded-1",id:"floatingSelect2","aria-label":"Floating label select example"},yt,512),[[b,o.user.shippingMethod]]),Dt]),t("div",Ct,[r(t("textarea",{class:"form-control rounded-1",placeholder:"備註",id:"floatingTextarea2",style:{height:"280px"},"onUpdate:modelValue":e[10]||(e[10]=s=>o.user.comment=s)},null,512),[[n,o.user.comment]]),kt])])]),t("div",wt,[t("a",{class:"btn-cerulean w-50 w-md-25 fs-5 mt-4 me-1",onClick:e[11]||(e[11]=(...s)=>d.backPage&&d.backPage(...s)),type:"button"},"上一步"),t("a",{class:"btn-square mt-4 fs-5 w-50 w-md-25",type:"button",href:"#/cart/payList",onClick:e[12]||(e[12]=(...s)=>d.orderData&&d.orderData(...s))},"下一步")])]),m(x,{ref:"userProductModal",userCart:o.userCart,productId:o.productId,productTitle:o.productTitle},null,8,["userCart","productId","productTitle"])],64)}const Pt=k(U,[["render",Mt]]);export{Pt as default};
