import{_ as v,c,F as u,h as g,a as t,n as f,A as x,o as l,t as h,j as b,b as C,w,d as P,r as y}from"./index-8CZ7-rvQ.js";const _="https://two024-south-json-server-vercel.onrender.com",T={data(){return{pageTotal:0,currentPage:1,limitPage:5,parsedLinks:"",products:[],user:"",newProductsDes:"",searchKaohsiung:[],enabledProducts:[],carts:[],quantity:1,newQty:"",newCarts:[],cartId:null,userId:"",token:""}},methods:{thousand(s){return s!==void 0&&(s=s.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${s}`},truncateContent(s,e){return s&&s.length>e?s.substring(0,e)+"...":s},getNewText(){const s={};this.products.forEach(e=>{e.description&&e.description.split(";").forEach(n=>{const r=n.trim();s[e.id]||(s[e.id]=[]),s[e.id].push(r)})}),this.newProductsDes=Object.entries(s).map(([e,i])=>({id:e,descriptions:i}))},searchProducts(s=1){this.axios.get(`${_}/products?category=高雄&_limit=${this.limitPage}&_page=${s}`).then(e=>{var i=parseInt(e.headers["x-total-count"]);this.pageTotal=Math.ceil(i/this.limitPage),this.currentPage=s,this.products=e.data,this.searchKaohsiung=[],this.products.forEach(n=>{n.is_enabled===1&&this.searchKaohsiung.push(n)}),this.getNewText()}).catch(e=>{alert(`${e.message}`)})},parseLinkHeader(s){const e=s.split(", "),i={};return e.forEach(n=>{const[r,o]=n.split("; "),d=/<(.*)>/.exec(r)[1],m=/rel="(.*)"/.exec(o)[1];i[m]=d}),i},addToCart(s,e=1,i){if(!this.token)alert("請登入會員後，才能預約套裝行程");else{let n=!1,r=1;this.newCarts.forEach(o=>{o.productId===s&&o.id&&(n=!0,this.cartId=o.id)}),n?this.axios.put(`${_}/carts/${this.cartId}`,{productId:s,qty:e,price:i,total:e*i,userId:this.userId,final_total:e*i*r}).then(o=>{alert("已更新預約人數"),this.getCart()}).catch(o=>{alert("更新預約人數失敗")}):this.axios.post(`${_}/carts`,{productId:s,qty:e,price:i,total:e*i,userId:this.userId,final_total:e*i*r}).then(o=>{alert("已預約成功"),this.getCart()}).catch(o=>{alert("預約失敗，再重新登入預約")})}},getCart(){this.axios.get(`${_}/carts`).then(s=>{this.carts=s.data,this.carts.forEach(e=>{e.userId===this.userId&&this.newCarts.push(e)})}).catch(s=>{alert("取得購物車資料失敗")})},getCookie(s){const e=document.cookie.split(";");for(let i of e){const[n,r]=i.trim().split("=");if(n===s)return r}return null}},mounted(){this.searchProducts();const s=this.getCookie("userId"),e=this.getCookie("hexTokenU");this.userId=s*1,this.token=e}},E={class:"row g-0"},N={class:"col-md-4"},M={class:"tag text-white"},j={class:"card-att-img h-100"},D=["src","alt"],K={class:"col-md-8"},R={class:"card h-100 border-0 bg-transparent"},S={class:"card-body px-3 px-md-4"},V=t("div",{class:"heart3"},[t("i",{class:"bi bi-heart heart-click","data-heartStatus":"false"})],-1),B={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-8"},U={class:"d-flex mb-4"},L={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},F={class:"row"},z={class:"col12 col-sm-8 my-2"},A={key:0},H={class:"col-12 col-sm-4"},I={class:"d-flex flex-column"},O={class:"fs-4 fs-lg-5 fs-xl-4 text-decoration-line-through text-end"},Q={class:"d-flex flex-sm-column align-items-end justify-content-end"},G=t("p",{class:"text-danger fw-bold d-none d-sm-block"},"促銷價",-1),J={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},W=t("div",{class:"col-12"},null,-1),X={class:"card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4"},Y={class:"d-flex align-items-end"},Z=["onClick"],q={"aria-label":"Page navigation example ",class:"my-10"},$={class:"pagination justify-content-center"},ee=["value","onClick"],te={class:"page-item"};function se(s,e,i,n,r,o){const k=y("router-link");return l(),c(u,null,[(l(!0),c(u,null,g(r.searchKaohsiung,a=>(l(),c("div",{class:"card mb-4 card-att",key:a.id},[t("div",E,[t("div",N,[t("span",M,h(a.category),1),t("div",j,[t("img",{src:a.imageUrl,class:"card-img-top img-fluid",alt:a.title},null,8,D)])]),t("div",K,[t("div",R,[t("div",S,[V,t("h4",B,h(a.title),1),t("div",U,[t("span",L,h(a.tag_2),1)]),t("div",F,[t("div",z,[(l(!0),c(u,null,g(r.newProductsDes,d=>(l(),c("div",{key:d.id},[d.id===a.id?(l(),c("div",A,[(l(!0),c(u,null,g(d.descriptions,p=>(l(),c("p",{key:p},h(o.truncateContent(p,85)),1))),128))])):b("",!0)]))),128))]),t("div",H,[t("div",I,[t("p",O," NT"+h(o.thousand(a.origin_price)),1),t("div",Q,[G,t("p",J," NT"+h(o.thousand(a.price)),1)])])])]),W]),t("div",X,[t("div",Y,[C(k,{to:{name:"TouristSinglePackage",params:{category:a.category,title:a.title}},class:"btn-outline-square w-100 me-2 px-2 px-md-3",type:"button"},{default:w(()=>[P("行程介紹")]),_:2},1032,["to"]),t("a",{class:"btn-square w-100 ms-2 px-2 px-md-3",onClick:d=>o.addToCart(a.id,r.quantity,a.price),type:"button"},"預約套裝行程",8,Z)])])])])])]))),128)),t("nav",q,[t("ul",$,[t("li",{class:f(["page-item",{disabled:!r.currentPage||r.currentPage===1}])},[t("a",{class:"page-link page-link-radius-2",href:"",onClick:e[0]||(e[0]=x(a=>o.searchProducts(r.currentPage-1),["prevent"]))},"上一頁")],2),(l(!0),c(u,null,g(r.pageTotal,a=>(l(),c("li",{class:"page-item",key:a+123},[t("a",{class:f(["page-link page-link-0 rounded-0",{active:a===r.currentPage}]),href:"",value:a,onClick:x(d=>o.searchProducts(a),["prevent"])},h(a),11,ee)]))),128)),t("li",te,[t("a",{class:f(["page-link page-link-radius",{disabled:!r.currentPage||r.currentPage===r.pageTotal}]),href:"",onClick:e[1]||(e[1]=x(a=>o.searchProducts(r.currentPage+1),["prevent"]))},"下一頁",2)])])])],64)}const ie=v(T,[["render",se]]);export{ie as default};
