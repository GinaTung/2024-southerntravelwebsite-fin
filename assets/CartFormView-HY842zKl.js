import{U}from"./UserProductModal-I0RsCyOh.js";import{C as T}from"./CartNavbar-6vXkhYA7.js";import{C as E}from"./collapse-nDVyQud5.js";import{s as _}from"./sweetAlert-vfJG8IL2.js";import{_ as L,c as p,b as l,a as e,d as C,t as v,i as k,l as O,F as x,h as P,w as b,r as g,o as f,n as c,v as w,p as q,f as A}from"./index-pJQ4MDOr.js";import"./modal-o4-Q4bKN.js";import"./selector-engine-0D82vH0F.js";const I="https://two024-south-json-server-vercel.onrender.com",S={components:{CartNavbar:T,UserProductModal:U},data(){return{cartsData:[],userCart:[],userId:"",isOpen:!1,headerCollapse:{},user:{name:"",email:"",tel:"",address:"",birthday:"",comment:"",shippingMethod:"",passport:"",memberId:"",appellation:""},shippingMethod:["電子郵件","郵寄"],total:0,productId:"",productTitle:"",cartDataId:"",ordersData:[],isLoading:!1,orderId:0}},watch:{$route(){this.headerCollapse.hide()}},methods:{verifyId(o){if(o=o.trim(),o.length===0)return"身份證字號 為必填";if(o.length!=10)return"身份證字號 長度需為10";let s=o.charCodeAt(0);if(s<65|s>90)return"身份證字號 字首英文代號，縣市不正確";let m=o.charCodeAt(1);if(m!=49&&m!=50)return"身份證字號 性別代碼不正確";let h=o.slice(2);for(let d in h){let n=h.charCodeAt(d);if(n<48|n>57)return"身份證字號 數字區出現非數字字元"}let t="ABCDEFGHJKLMNPQRSTUVXYWZIO",u=[1,9,8,7,6,5,4,3,2,1,1];o=String(t.indexOf(o[0])+10)+o.slice(1);let D=0;for(let d=0;d<o.length;d++){let n=parseInt(o[d]),y=u[d];D+=n*y}let V=D%10==0;return V||"身份證字號 檢核碼錯誤"},isOver18(o){if(o.length===0)return"生日 為必填";const s=new Date(o),m=new Date,h=m.getFullYear()-s.getFullYear();return m.getMonth()<s.getMonth()||m.getMonth()===s.getMonth()&&m.getDate()<s.getDate()?h-1<18?"主要聯繫人需滿18歲":!0:h<18?"主要聯繫人需滿18歲":!0},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"需要正確的電話號碼"},backPage(){this.$router.go(-1)},toggleOpen(){this.isOpen=!this.isOpen},forId(o,s){this.productId=o,this.productTitle=s,this.$refs.userProductModal.openModal()},getCartsData(){this.axios.get(`${I}/cartsData`).then(o=>{this.cartsData=o.data,this.cartsData.forEach(s=>{s.status===!1&&s.userId===this.userId&&s.data.forEach(m=>{this.userCart.push(m),this.isLoading=!1})}),this.userCart.forEach(s=>{this.total+=s.final_total})}).catch(o=>{this.isLoading=!1,_.threeLayerCheckType("error","取得購買資料失敗")})},getCookie(o){const s=document.cookie.split(";");for(let m of s){const[h,t]=m.trim().split("=");if(h===o)return t}return null},thousand(o){return o!==void 0&&(o=o.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${o}`},orderData(){if(this.orderId){if(!this.ordersData.user.name||!this.ordersData.user.email||!this.ordersData.user.tel||!this.ordersData.user.address||!this.ordersData.user.birthday||!this.ordersData.user.shippingMethod){_.threeLayerCheckType("warning","請填寫所有必填欄位");return}}else if(!this.user.name||!this.user.email||!this.user.tel||!this.user.address||!this.user.birthday||!this.user.shippingMethod){_.threeLayerCheckType("warning","請填寫所有必填欄位");return}if(this.orderId){const o={create_at:new Date,name:this.ordersData.user.name,email:this.ordersData.user.email,tel:this.ordersData.user.tel,address:this.ordersData.user.address,birthday:this.ordersData.user.birthday,comment:this.ordersData.user.comment,shippingMethod:this.ordersData.user.shippingMethod,passport:this.ordersData.user.passport,memberId:this.ordersData.user.memberId,appellation:this.ordersData.user.appellation,userId:this.ordersData.userId,cartDataId:this.cartDataId,status:!1};this.axios.put(`${I}/orders/${this.orderId}`,{user:o}).then(s=>{this.ordersData=s.data}).catch(s=>{_.threeLayerCheckType("error","更新填寫資料內容失敗")})}else{const o={create_at:new Date,name:this.user.name,email:this.user.email,tel:this.user.tel,address:this.user.address,birthday:this.user.birthday,comment:this.user.comment,shippingMethod:this.user.shippingMethod,passport:this.user.passport,memberId:this.user.memberId,appellation:this.user.appellation,userId:this.userId,cartDataId:this.cartDataId,status:!1};this.axios.post(`${I}/orders`,{user:o}).then(s=>{this.ordersData=s.data,document.cookie=`orderId=${s.data.id}`}).catch(s=>{_.threeLayerCheckType("error","新增填寫資料內容失敗")})}this.$router.push("/cart/payList")},getOrder(){this.axios.get(`${I}/orders/${this.orderId}`).then(o=>{this.ordersData=o.data}).catch(o=>{_.threeLayerCheckType("error","取得填寫資料內容失敗")})}},mounted(){window.scrollTo(0,0);const o=this.getCookie("userId");this.userId=o*1,this.isLoading=!0,this.getCartsData(),this.headerCollapse=new E(this.$refs.headerCollapse,{toggle:!1}),setTimeout(()=>{const m=this.getCookie("cartDataId");this.cartDataId=m*1},3e3);const s=this.getCookie("orderId");this.orderId=s*1,this.orderId&&this.getOrder()}},r=o=>(q("data-v-61b2d01e"),o=o(),A(),o),F={class:"container py-10 py-lg-30"},N={class:"row"},B={class:"col-md-6 mx-auto pb-5 pb-lg-15"},j={class:"mb-4"},Y={class:"d-grid gap-2"},z=r(()=>e("br",null,null,-1)),G={key:0,class:"bi bi-chevron-down"},H={key:1,class:"bi bi-chevron-up"},J={class:"collapse",id:"collapseExample",ref:"headerCollapse"},K={class:"card card-body rounded-0"},Q={class:"col-12 col-md-5 col-lg-4"},R=["src","alt"],W={class:"col-12 col-md-7 col-lg-8 d-flex flex-column justify-content-between"},X={class:"mt-4 mt-md-0 mb-4"},Z={class:"mb-4"},$={class:"mb-4"},ee={class:"mb-4"},se=["onClick"],te={key:0},oe={class:"row"},le={class:"col-12 col-md-6 mb-4"},ae=r(()=>e("h3",{class:"mb-4"},"訂單資料",-1)),re={class:"form-floating mb-4"},ie=r(()=>e("label",{for:"floatingInput",class:"form-label"},"主要聯繫人姓名",-1)),de={class:"form-floating mb-4"},ne=r(()=>e("option",{selected:"",value:"",disabled:""},"請選擇稱謂",-1)),ue=r(()=>e("option",{value:"female"},"女士",-1)),ce=r(()=>e("option",{value:"male"},"男士",-1)),me=r(()=>e("label",{for:"floatingAppellation"},"稱謂",-1)),he={class:"form-floating mb-4"},pe=r(()=>e("label",{for:"floatingMemberId"},"身分證字號",-1)),fe={class:"form-floating mb-4"},_e=r(()=>e("label",{for:"floatingPassport"},"護照號碼",-1)),be={class:"form-floating mb-4"},ge=r(()=>e("label",{for:"floatingDate"},"生日(主要聯繫人需滿18歲)",-1)),ve={class:"form-floating mb-4"},De=r(()=>e("label",{for:"floatingTel"},"請輸入手機號碼",-1)),Ve={class:"form-floating mb-4"},ye=r(()=>e("label",{for:"floatingEmail"},"請輸入 Email",-1)),Ie={class:"form-floating mb-4"},ke=r(()=>e("label",{for:"floatingAddress"},"住址",-1)),Ce={class:"col-12 col-md-6 mb-4"},xe=r(()=>e("h3",{class:"mb-4"},"取件方式",-1)),we={class:"form-floating mb-4"},Me=r(()=>e("option",{selected:"",value:"",disabled:""},"請選擇取件方式",-1)),Ue=r(()=>e("option",{value:"電子郵件"},"電子郵件",-1)),Te=r(()=>e("option",{value:"郵寄"},"郵寄",-1)),Ee=r(()=>e("label",{for:"floatingSelect2"},"選擇取件方式",-1)),Le={class:"form-floating mb-4"},Oe=r(()=>e("label",{for:"floatingTextarea2"},"備註(如:飲食、暈車等注意事項)",-1)),Pe={key:1},qe={class:"row"},Ae={class:"col-12 col-md-6 mb-4"},Se=r(()=>e("h3",{class:"mb-4"},"訂單資料",-1)),Fe={class:"form-floating mb-4"},Ne=r(()=>e("label",{for:"floatingInput",class:"form-label"},"主要聯繫人姓名",-1)),Be={class:"form-floating mb-4"},je=r(()=>e("option",{selected:"",value:"",disabled:""},"請選擇稱謂",-1)),Ye=r(()=>e("option",{value:"female"},"女士",-1)),ze=r(()=>e("option",{value:"male"},"男士",-1)),Ge=r(()=>e("label",{for:"floatingAppellation"},"稱謂",-1)),He={class:"form-floating mb-4"},Je=r(()=>e("label",{for:"floatingMemberId"},"身分證字號",-1)),Ke={class:"form-floating mb-4"},Qe=r(()=>e("label",{for:"floatingPassport"},"護照號碼",-1)),Re={class:"form-floating mb-4"},We=r(()=>e("label",{for:"floatingDate"},"生日(主要聯繫人需滿18歲)",-1)),Xe={class:"form-floating mb-4"},Ze=r(()=>e("label",{for:"floatingTel"},"請輸入手機號碼",-1)),$e={class:"form-floating mb-4"},es=r(()=>e("label",{for:"floatingEmail"},"請輸入 Email",-1)),ss={class:"form-floating mb-4"},ts=r(()=>e("label",{for:"floatingAddress"},"住址",-1)),os={class:"col-12 col-md-6 mb-4"},ls=r(()=>e("h3",{class:"mb-4"},"取件方式",-1)),as={class:"form-floating mb-4"},rs=r(()=>e("option",{selected:"",value:"",disabled:""},"請選擇取件方式",-1)),is=r(()=>e("option",{value:"電子郵件"},"電子郵件",-1)),ds=r(()=>e("option",{value:"郵寄"},"郵寄",-1)),ns=r(()=>e("label",{for:"floatingSelect2"},"選擇取件方式",-1)),us={class:"form-floating mb-4"},cs=r(()=>e("label",{for:"floatingTextarea2"},"備註(如:飲食、暈車等注意事項)",-1)),ms={class:"d-flex justify-content-between"};function hs(o,s,m,h,t,u){const D=g("VueLoading"),V=g("CartNavbar"),d=g("VeeField"),n=g("ErrorMessage"),y=g("VeeForm"),M=g("UserProductModal");return f(),p(x,null,[l(D,{active:t.isLoading,class:"text-center","z-index":1060},null,8,["active"]),e("div",F,[e("div",N,[e("div",B,[l(V)])]),e("div",j,[e("p",Y,[e("button",{class:"btn btn-primary-600 border-top",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample",onClick:s[0]||(s[0]=(...i)=>u.toggleOpen&&u.toggleOpen(...i))},[C(" 總計："+v(u.thousand(t.total))+"元",1),z,C("購買清單 "),t.isOpen===!1?(f(),p("i",G)):(f(),p("i",H))])]),k(e("div",J,[e("div",K,[(f(!0),p(x,null,P(t.userCart,i=>(f(),p("div",{class:"row p-4 p-md-10",key:i.id},[e("div",Q,[e("img",{src:i.product.imageUrl,alt:i.product.title,class:"img-fluid h-100 rounded-2"},null,8,R)]),e("div",W,[e("div",null,[e("h4",X,"套裝行程名稱："+v(i.product.title),1),e("h5",Z,"單價："+v(u.thousand(i.product.price)),1),e("h5",$,"預約數量："+v(i.qty)+" 位",1),e("h5",ee,"總計："+v(u.thousand(i.final_total)),1)]),e("div",null,[e("button",{type:"button",class:"btn-turquoise border-0 rounded-1",onClick:a=>u.forId(i.product.id,i.product.title)}," 查看更多 ",8,se)])])]))),128))])],512),[[O,t.isOpen]])]),t.orderId===t.ordersData.id?(f(),p("div",te,[l(y,{id:"form",ref:"form"},{default:b(({errors:i})=>[e("div",oe,[e("div",le,[ae,e("div",re,[l(d,{type:"text",class:c(["form-control rounded-1",{"is-invalid":i.主要聯繫人姓名}]),modelValue:t.ordersData.user.name,"onUpdate:modelValue":s[1]||(s[1]=a=>t.ordersData.user.name=a),id:"floatingInput",name:"主要聯繫人姓名",placeholder:"請輸入姓名",rules:"required"},null,8,["class","modelValue"]),ie,l(n,{name:"主要聯繫人姓名",class:"invalid-feedback"})]),e("div",de,[l(d,{id:"floatingAppellation",name:"稱謂",class:c(["form-control rounded-1",{"is-invalid":i.稱謂}]),placeholder:"請選擇稱謂",rules:"required",modelValue:t.ordersData.user.appellation,"onUpdate:modelValue":s[2]||(s[2]=a=>t.ordersData.user.appellation=a),as:"select"},{default:b(()=>[ne,ue,ce]),_:2},1032,["class","modelValue"]),me,l(n,{name:"稱謂",class:"invalid-feedback"})]),e("div",he,[l(d,{type:"text",name:"身分證字號",class:c(["form-control rounded-1",{"is-invalid":i.身分證字號}]),id:"floatingMemberId",placeholder:"請輸入身分證字號",modelValue:t.ordersData.user.memberId,"onUpdate:modelValue":s[3]||(s[3]=a=>t.ordersData.user.memberId=a),rules:u.verifyId},null,8,["class","modelValue","rules"]),pe,l(n,{name:"身分證字號",class:"invalid-feedback"})]),e("div",fe,[l(d,{type:"text",name:"護照號碼",class:c(["form-control rounded-1",{"is-invalid":i.護照號碼}]),id:"floatingPassport",placeholder:"請輸入護照號碼",modelValue:t.ordersData.user.passport,"onUpdate:modelValue":s[4]||(s[4]=a=>t.ordersData.user.passport=a),rules:"numeric:true|length:9|required"},null,8,["class","modelValue"]),_e,l(n,{name:"護照號碼",class:"invalid-feedback"})]),e("div",be,[l(d,{type:"date",name:"生日",class:c(["form-control rounded-1",{"is-invalid":i.生日}]),id:"floatingDate",placeholder:"2024/03/08",modelValue:t.ordersData.user.birthday,"onUpdate:modelValue":s[5]||(s[5]=a=>t.ordersData.user.birthday=a),rules:u.isOver18},null,8,["class","modelValue","rules"]),ge,l(n,{name:"生日",class:"invalid-feedback"})]),e("div",ve,[l(d,{id:"floatingTel",name:"手機號碼",type:"text",class:c(["form-control rounded-1",{"is-invalid":i.手機號碼}]),placeholder:"請輸入手機號碼",rules:u.isPhone,modelValue:t.ordersData.user.tel,"onUpdate:modelValue":s[6]||(s[6]=a=>t.ordersData.user.tel=a)},null,8,["class","rules","modelValue"]),De,l(n,{name:"手機號碼",class:"invalid-feedback"})]),e("div",Ve,[l(d,{type:"email",name:"email",class:c(["form-control rounded-1",{"is-invalid":i.email}]),modelValue:t.ordersData.user.email,"onUpdate:modelValue":s[7]||(s[7]=a=>t.ordersData.user.email=a),id:"floatingEmail",placeholder:"請輸入 Email",rules:"email|required",autocomplete:"useremail"},null,8,["modelValue","class"]),ye,l(n,{name:"email",class:"invalid-feedback"})]),e("div",Ie,[l(d,{name:"住址",type:"text",class:c(["form-control rounded-1",{"is-invalid":i.住址}]),id:"floatingAddress",placeholder:"縣市鄉鎮市區",modelValue:t.ordersData.user.address,"onUpdate:modelValue":s[8]||(s[8]=a=>t.ordersData.user.address=a),rules:"min:10|required"},null,8,["class","modelValue"]),ke,l(n,{name:"住址",class:"invalid-feedback"})])]),e("div",Ce,[xe,e("div",we,[l(d,{name:"取件方式",modelValue:t.ordersData.user.shippingMethod,"onUpdate:modelValue":s[9]||(s[9]=a=>t.ordersData.user.shippingMethod=a),class:c(["form-select rounded-1",{"is-invalid":i.取件方式}]),id:"floatingSelect2","aria-label":"Floating label select example",rules:"required",as:"select"},{default:b(()=>[Me,Ue,Te]),_:2},1032,["modelValue","class"]),Ee,l(n,{name:"取件方式",class:"invalid-feedback"})]),e("div",Le,[k(e("textarea",{class:"form-control rounded-1",placeholder:"備註",id:"floatingTextarea2",style:{height:"280px"},"onUpdate:modelValue":s[10]||(s[10]=a=>t.ordersData.user.comment=a)},null,512),[[w,t.ordersData.user.comment]]),Oe])])])]),_:1},512)])):(f(),p("div",Pe,[l(y,{id:"form",ref:"form"},{default:b(({errors:i})=>[e("div",qe,[e("div",Ae,[Se,e("div",Fe,[l(d,{type:"text",class:c(["form-control rounded-1",{"is-invalid":i.主要聯繫人姓名}]),modelValue:t.user.name,"onUpdate:modelValue":s[11]||(s[11]=a=>t.user.name=a),id:"floatingInput",name:"主要聯繫人姓名",placeholder:"請輸入姓名",rules:"required"},null,8,["class","modelValue"]),Ne,l(n,{name:"主要聯繫人姓名",class:"invalid-feedback"})]),e("div",Be,[l(d,{id:"floatingAppellation",name:"稱謂",class:c(["form-control rounded-1",{"is-invalid":i.稱謂}]),placeholder:"請選擇稱謂",rules:"required",modelValue:t.user.appellation,"onUpdate:modelValue":s[12]||(s[12]=a=>t.user.appellation=a),as:"select"},{default:b(()=>[je,Ye,ze]),_:2},1032,["class","modelValue"]),Ge,l(n,{name:"稱謂",class:"invalid-feedback"})]),e("div",He,[l(d,{type:"text",name:"身分證字號",class:c(["form-control rounded-1",{"is-invalid":i.身分證字號}]),id:"floatingMemberId",placeholder:"請輸入身分證字號",modelValue:t.user.memberId,"onUpdate:modelValue":s[13]||(s[13]=a=>t.user.memberId=a),rules:u.verifyId},null,8,["class","modelValue","rules"]),Je,l(n,{name:"身分證字號",class:"invalid-feedback"})]),e("div",Ke,[l(d,{type:"text",name:"護照號碼",class:c(["form-control rounded-1",{"is-invalid":i.護照號碼}]),id:"floatingPassport",placeholder:"請輸入護照號碼",modelValue:t.user.passport,"onUpdate:modelValue":s[14]||(s[14]=a=>t.user.passport=a),rules:"numeric:true|length:9|required"},null,8,["class","modelValue"]),Qe,l(n,{name:"護照號碼",class:"invalid-feedback"})]),e("div",Re,[l(d,{type:"date",name:"生日",class:c(["form-control rounded-1",{"is-invalid":i.生日}]),id:"floatingDate",placeholder:"2024/03/08",modelValue:t.user.birthday,"onUpdate:modelValue":s[15]||(s[15]=a=>t.user.birthday=a),rules:u.isOver18},null,8,["class","modelValue","rules"]),We,l(n,{name:"生日",class:"invalid-feedback"})]),e("div",Xe,[l(d,{id:"floatingTel",name:"手機號碼",type:"tel",class:c(["form-control rounded-1",{"is-invalid":i.手機號碼}]),placeholder:"請輸入手機號碼",rules:u.isPhone,modelValue:t.user.tel,"onUpdate:modelValue":s[16]||(s[16]=a=>t.user.tel=a)},null,8,["class","rules","modelValue"]),Ze,l(n,{name:"手機號碼",class:"invalid-feedback"})]),e("div",$e,[l(d,{type:"email",name:"email",class:c(["form-control rounded-1",{"is-invalid":i.email}]),modelValue:t.user.email,"onUpdate:modelValue":s[17]||(s[17]=a=>t.user.email=a),id:"floatingEmail",placeholder:"請輸入 Email",rules:"email|required",autocomplete:"useremail"},null,8,["modelValue","class"]),es,l(n,{name:"email",class:"invalid-feedback"})]),e("div",ss,[l(d,{name:"住址",type:"text",class:c(["form-control rounded-1",{"is-invalid":i.住址}]),id:"floatingAddress",placeholder:"縣市鄉鎮市區",modelValue:t.user.address,"onUpdate:modelValue":s[18]||(s[18]=a=>t.user.address=a),rules:"min:10|required"},null,8,["class","modelValue"]),ts,l(n,{name:"住址",class:"invalid-feedback"})])]),e("div",os,[ls,e("div",as,[l(d,{name:"取件方式",modelValue:t.user.shippingMethod,"onUpdate:modelValue":s[19]||(s[19]=a=>t.user.shippingMethod=a),class:c(["form-select rounded-1",{"is-invalid":i.取件方式}]),id:"floatingSelect2","aria-label":"Floating label select example",rules:"required",as:"select"},{default:b(()=>[rs,is,ds]),_:2},1032,["modelValue","class"]),ns,l(n,{name:"取件方式",class:"invalid-feedback"})]),e("div",us,[k(e("textarea",{class:"form-control rounded-1",placeholder:"備註",id:"floatingTextarea2",style:{height:"280px"},"onUpdate:modelValue":s[20]||(s[20]=a=>t.user.comment=a)},null,512),[[w,t.user.comment]]),cs])])])]),_:1},512)])),e("div",ms,[e("button",{class:"btn-cerulean w-50 w-md-25 fs-5 mt-4 me-1",onClick:s[21]||(s[21]=(...i)=>u.backPage&&u.backPage(...i)),type:"button"}," 上一步 "),e("button",{class:"btn-square mt-4 fs-5 w-50 w-md-25",onClick:s[22]||(s[22]=(...i)=>u.orderData&&u.orderData(...i)),type:"button"}," 下一步 ")])]),l(M,{ref:"userProductModal","user-cart":t.userCart,"product-id":t.productId,"product-title":t.productTitle},null,8,["user-cart","product-id","product-title"])],64)}const Vs=L(S,[["render",hs],["__scopeId","data-v-61b2d01e"]]);export{Vs as default};
