import{B as D}from"./BannerBlock-qPLDnGQ7.js";import{s as h}from"./sweetAlert-3mmwl4KR.js";import{_ as L,c as n,b,a as s,w as x,g as F,A as y,t as d,j as C,F as u,h as _,n as f,r as P,o as i,d as m,e as N}from"./index-jP5mHpEK.js";const g="https://two024-south-json-server-vercel.onrender.com",B={components:{BannerBlock:D},data(){return{products:[],user:"",userId:"",token:"",carts:[],newCarts:[],newProductsDes:"",enabledProducts:[],fullPath:"",currentURL:"",productsCategory:[],selectedCategory:"全部",currentDate:"",currentPage:1,limitPage:5,pageTotal:0,isLoading:!1,status:{loadingItem:"",loadingItem2:""},category:"全部",cartsLength:0,heartData:[],isFavorite:{}}},watch:{$route(t,e){this.currentURL=t.fullPath,this.$root.navigatedFromHeader&&t.fullPath!=="/TouristPackage"&&(this.selectedCategory="全部",this.status.loadingItem=!0,this.getProducts(),this.$root.navigatedFromHeader=!1)}},computed:{filterCategory(){const t=this.productsCategory.map(o=>o.category),e=[...new Set(t)];return e.unshift("全部"),e},filterCateNum(){const t={};return this.productsCategory.forEach(e=>{t[e.category]?t[e.category]+=1:t[e.category]=1}),t.全部=this.productsCategory.length,t},filteredProducts(){return this.selectedCategory==="全部"||!this.selectedCategory?this.enabledProducts:this.enabledProducts.filter(t=>t.category===this.selectedCategory)}},created(){this.category=this.$route.query.category,this.selectedCategory=this.category,this.getProducts()},methods:{getProducts(t=1){this.axios.get(`${g}/products`).then(e=>{this.productsCategory=e.data.filter(o=>o.is_enabled===1),setTimeout(()=>{this.isLoading=!1},1e3)}).catch(e=>{h.threeLayerCheckType("error","取得產品資料失敗")}),this.selectedCategory==="全部"||!this.selectedCategory?this.axios.get(`${g}/products?_limit=${this.limitPage}&_page=${t}`).then(e=>{var o=parseInt(e.headers["x-total-count"]);this.pageTotal=Math.ceil(o/this.limitPage),this.currentPage=t,this.products=e.data,this.getNewText(),this.enabledProducts=this.products.filter(l=>l.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristPackage",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(e=>{h.threeLayerCheckType("error","取得全部產品資料失敗")}):this.axios.get(`${g}/products?category=${this.selectedCategory}&_limit=${this.limitPage}&_page=${t}`).then(e=>{var o=parseInt(e.headers["x-total-count"]);this.pageTotal=Math.ceil(o/this.limitPage),this.currentPage=t,this.products=e.data,this.getNewText(),this.enabledProducts=this.products.filter(l=>l.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristPackage",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(e=>{h.threeLayerCheckType("error","取得區域產品資料失敗")})},filterProducts(t){this.selectedCategory=t,this.status.loadingItem=!0,this.getProducts()},checkDate(){var t=new Date,e={year:t.getFullYear(),month:t.getMonth()+1,date:t.getDate()},o=(e.month<10?"0":"")+e.month,l=(e.date<10?"0":"")+e.date,r=e.year+"-"+o+"-"+l;this.currentDate=r},getHeartData(){this.axios.get(`${g}/hearts`).then(t=>{t.data.forEach(e=>{e.userId===this.userId&&e.tag==="旅遊方案"&&(this.isFavorite[e.product]=!0)})}).catch(t=>{h.threeLayerCheckType("error","取得愛心收藏資料失敗")})},toggleFavorite(t,e,o){this.token?this.axios.get(`${g}/hearts`).then(l=>{const r=l.data.find(c=>c.product===t&&c.userId===this.userId&&c.tag==="旅遊方案");r?this.axios.delete(`${g}/hearts/${r.id}`).then(c=>{this.isFavorite[t]=!1,h.threeLayerCheckType("success",`取消收藏 ${o} 成功`),this.getHeartData()}).catch(c=>{h.threeLayerCheckType("error","取消收藏資料失敗")}):this.axios.post(`${g}/hearts`,{product:t,category:e,title:o,userId:this.userId,tag:"旅遊方案"}).then(c=>{this.isFavorite[t]=!0,h.threeLayerCheckType("success",`已加入收藏 ${o} 成功`),this.getHeartData()}).catch(c=>{h.threeLayerCheckType("error","收藏資料失敗")})}).catch(l=>{h.threeLayerCheckType("error","取得愛心收藏資料失敗")}):h.threeLayerCheckType("warning","請登入會員後，才能加入收藏")},thousand(t){return t!==void 0&&(t=t.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${t}`},truncateContent(t,e){return t&&t.length>e?t.substring(0,e)+"...":t},getNewText(){const t={};this.products.forEach(e=>{e.description&&e.description.split(";").forEach(l=>{const r=l.trim();t[e.id]||(t[e.id]=[]),t[e.id].push(r)})}),this.newProductsDes=Object.entries(t).map(([e,o])=>({id:e,descriptions:o}))},getCart(){this.axios.get(`${g}/carts`).then(t=>{this.carts=t.data,this.carts.forEach(l=>{l.userId===this.userId&&this.newCarts.push(l)});const e=[],o=new Set;this.newCarts.forEach(l=>{o.has(l.productId)||(o.add(l.productId),e.push(l))}),this.newCarts=e,this.cartsLength=this.newCarts.length,this.$emitter.emit("updateCart",this.cartsLength)}).catch(t=>{h.threeLayerCheckType("error","取得購物車資料失敗")})},addToCart(t,e=1,o){if(this.status.loadingItem2=t,!this.token)h.threeLayerCheckType("warning","請登入會員後，才能預約套裝行程"),this.status.loadingItem2="";else{let l=!1,r=1;this.newCarts.forEach(c=>{c.productId===t&&c.id&&(l=!0,this.cartId=c.id)}),l?this.axios.put(`${g}/carts/${this.cartId}`,{productId:t,qty:e,price:o,total:e*o,userId:this.userId,final_total:e*o*r}).then(c=>{this.status.loadingItem2="",h.threeLayerCheckType("success","已更新預約人數"),this.getCart()}).catch(c=>{this.status.loadingItem2="",h.threeLayerCheckType("error","更新預約人數失敗")}):this.axios.post(`${g}/carts`,{productId:t,qty:e,price:o,total:e*o,userId:this.userId,final_total:e*o*r}).then(c=>{this.status.loadingItem2="",h.threeLayerCheckType("success","已預約成功"),this.getCart()}).catch(c=>{this.status.loadingItem2="",h.threeLayerCheckType("error","預約失敗，再重新登入預約")})}},getCookie(t){const e=document.cookie.split(";");for(let o of e){const[l,r]=o.trim().split("=");if(l===t)return r}return null}},mounted(){this.isLoading=!0,this.getProducts(),window.scrollTo(0,0);const t=this.getCookie("userId"),e=this.getCookie("hexTokenU");this.userId=t*1,this.token=e,this.getCart(),this.checkDate(),this.getHeartData(),this.fullPath=this.$route.fullPath}},E={class:"container py-10 py-lg-30"},S={style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",class:"pb-5 pb-lg-15"},j={class:"breadcrumb mb-0 fs-5"},H={class:"breadcrumb-item"},U={class:"breadcrumb-item","aria-current":"page"},V={key:1},M={key:0,class:"breadcrumb-item","aria-current":"page"},q={class:"tourist-list"},I={class:"row"},z={class:"col-12 col-md-3 mb-5 mb-md-6 mb-lg-0 d-none d-lg-flex"},A={class:"border-1 border w-100 rounded-1 h-100"},R=s("p",{class:"fs-4 p-5 bg-primary-500 text-white"},"地區篩選",-1),G={class:"nav flex-column"},O=["onClick"],Y={class:"col-12 col-lg-9"},$=N('<div class="row g-0"><div class="col-md-4"><span class="tag text-white placeholder-glow"></span><div class="card-att-img h-100"><img src="https://raw.githubusercontent.com/GinaTung/2024-southerntravelwebsite-fin/dev/public/products/duck.jpg" class="img-fluid opacity-25" alt="Placeholder Image"></div></div><div class="col-md-8"><div class="card h-100 border-0 bg-transparent"><div class="card-body px-3 px-md-4"><button class="heart border-0"><i class="bi bi-heart"></i></button><h4 class="fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-10 placeholder w-60"></h4><div class="d-flex flex-column"><span class="placeholder w-25"></span></div><div class="row"><div class="col-12 col-md-8 my-2 placeholder-glow"><span class="placeholder w-100"></span><span class="placeholder w-100"></span><span class="placeholder w-100"></span><span class="placeholder w-75 mt-3"></span><span class="placeholder w-75 mt-3"></span></div><div class="col-12 col-md-4 my-2 text-end placeholder-glow"><span class="placeholder w-100"></span><span class="placeholder w-75"></span><span class="placeholder w-100"></span></div></div></div><div class="card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4 placeholder-glow"><div class="d-flex"><span class="placeholder w-50 me-2"></span><span class="placeholder w-50 ms-2"></span></div></div></div></div></div>',1),J=[$],K={key:0,class:"text-center",style:{margin:"150px"}},Q=s("div",{class:"spinner-border",role:"status",style:{width:"3rem",height:"3rem",color:"#43b8bd"}},[s("span",{class:"visually-hidden"},"Loading...")],-1),W=[Q],X={key:1},Z={class:"row g-0"},ee={class:"col-md-4"},te={class:"tag text-white"},se={class:"card-att-img h-100"},ae=["src","alt"],re={class:"col-md-8"},ie={class:"card h-100 border-0 bg-transparent"},oe={class:"card-body px-3 px-md-4"},ce=["onClick"],ne={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-10"},le={class:"d-flex mb-4"},de={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},he={class:"row"},ge={class:"col-12 col-md-8 my-2"},ue={key:0},pe={class:"col-12 col-md-4"},_e={class:"d-flex flex-column"},ye={class:"fs-4 fs-lg-5 fs-xl-4 text-decoration-line-through text-end"},fe={class:"d-flex flex-md-column align-items-end justify-content-end justify-content-sm-between justify-content-md-end"},me=s("p",{class:"text-danger fw-bold d-none d-md-block"},"促銷價",-1),ve={class:"d-sm-flex flex-sm-column d-none d-md-none"},ke={key:0,class:"fs-7 fs-sm-6 text-dark2"},be={key:1,class:"fs-7 fs-sm-6 text-danger"},xe={key:2,class:"fs-7 fs-sm-6 text-dark2"},Ce={key:3,class:"fs-6 text-danger"},we={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},Pe={class:"col-12 d-none d-md-flex flex-md-column"},Te={key:0,class:"fs-6 text-dark2"},De={key:1,class:"fs-6 text-danger"},Le={key:2,class:"fs-6 text-dark2"},Fe={key:3,class:"fs-6 text-danger"},Ne={class:"card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4"},Be={class:"d-flex align-items-end"},Ee=["onClick"],Se={key:0,class:"spinner-border spinner-grow-sm",role:"status"},je={key:1,class:"btn btn-danger w-100 ms-2 px-2 px-md-3 py-2 disabled btn-danger-rounded",type:"button"},He={"aria-label":"Page navigation example",class:"my-10"},Ue={class:"pagination justify-content-center"},Ve=["onClick"];function Me(t,e,o,l,r,c){const T=P("BannerBlock"),k=P("router-link");return i(),n(u,null,[b(T),s("div",E,[s("nav",S,[s("ol",j,[s("li",H,[b(k,{to:"/",exact:"","active-class":"active-link"},{default:x(()=>[m(" 首頁 ")]),_:1})]),s("li",U,[r.selectedCategory!=="全部"?(i(),F(k,{key:0,exact:"","active-class":"active-link",to:{path:"/TouristPackage",query:{category:"全部",page:"1"}},onClick:e[0]||(e[0]=y(a=>c.filterProducts("全部"),["prevent"]))},{default:x(()=>[m(" 南部旅遊方案 ")]),_:1})):(i(),n("span",V," 南部旅遊方案 "))]),r.selectedCategory!=="全部"?(i(),n("li",M,[s("span",null,d(r.selectedCategory),1)])):C("",!0)])]),s("div",q,[s("div",I,[s("div",z,[s("div",A,[R,s("ul",G,[(i(!0),n(u,null,_(c.filterCategory,(a,v)=>(i(),n("li",{class:"nav-item",key:v},[s("a",{class:f(["nav-link p-5 fs-5 link-color d-flex justify-content-between",{"active-category":r.selectedCategory===a}]),href:"#","aria-current":"page",onClick:y(p=>c.filterProducts(a),["prevent"])},[m(d(a)+" ",1),s("span",null,d(c.filterCateNum[a]),1)],10,O)]))),128))])])]),s("div",Y,[r.isLoading?(i(),n(u,{key:0},_(3,a=>s("div",{class:"card mb-4 card-att",key:a},J)),64)):(i(),n(u,{key:1},[r.status.loadingItem?(i(),n("div",K,W)):(i(),n("div",X,[(i(!0),n(u,null,_(c.filteredProducts,(a,v)=>(i(),n("div",{class:"card mb-4 card-att",key:v+123},[s("div",Z,[s("div",ee,[s("span",te,d(a.category),1),s("div",se,[s("img",{src:a.imageUrl,class:"card-img-top img-fluid",alt:a.title,style:{"border-radius":"calc(1.25rem - 1px)"}},null,8,ae)])]),s("div",re,[s("div",ie,[s("div",oe,[s("button",{class:"heart border-0",onClick:p=>c.toggleFavorite(a.id,a.category,a.title),type:"button"},[s("i",{class:f(["bi",{"bi-heart-fill":r.isFavorite[a.id],"bi-heart":!r.isFavorite[a.id]}]),style:{"font-size":"24px"}},null,2)],8,ce),s("h4",ne,d(a.title),1),s("div",le,[s("span",de,d(a.tag_2),1)]),s("div",he,[s("div",ge,[(i(!0),n(u,null,_(r.newProductsDes,p=>(i(),n("div",{key:p.id},[p.id===a.id?(i(),n("div",ue,[(i(!0),n(u,null,_(p.descriptions,w=>(i(),n("p",{key:w},d(c.truncateContent(w,85)),1))),128))])):C("",!0)]))),128))]),s("div",pe,[s("div",_e,[s("p",ye," NT"+d(c.thousand(a.origin_price)),1),s("div",fe,[me,s("div",ve,[r.currentDate<=a.endDate?(i(),n("p",ke," 預約："+d(a.startDate)+" ~ "+d(a.endDate),1)):(i(),n("p",be,"預約時間已截止")),r.currentDate<=a.endDate?(i(),n("p",xe," 出遊："+d(a.goStartDate)+" ~ "+d(a.goEndDate),1)):(i(),n("p",Ce,"已出遊完成"))]),s("p",we," NT"+d(c.thousand(a.price)),1)])])])]),s("div",Pe,[r.currentDate<=a.endDate?(i(),n("p",Te," 預約時間："+d(a.startDate)+" ~ "+d(a.endDate),1)):(i(),n("p",De,"預約時間已截止")),r.currentDate<=a.endDate?(i(),n("p",Le," 出遊時間："+d(a.goStartDate)+" ~ "+d(a.goEndDate),1)):(i(),n("p",Fe,"已出遊完成"))])]),s("div",Ne,[s("div",Be,[b(k,{to:{name:"TouristSinglePackage",params:{category:a.category,title:a.title}},class:"btn-outline-square w-100 me-2 px-2 px-md-3"},{default:x(()=>[m("行程介紹")]),_:2},1032,["to"]),r.currentDate<=a.endDate?(i(),n("button",{key:0,class:"btn-square w-100 ms-2 px-2 px-md-3",onClick:p=>c.addToCart(a.id,t.quantity,a.price),type:"button"},[r.status.loadingItem2===a.id?(i(),n("span",Se)):C("",!0),m(" 立即預約旅遊方案 ")],8,Ee)):(i(),n("button",je," 預約時間截止 "))])])])])])]))),128)),s("nav",He,[s("ul",Ue,[s("li",{class:f(["page-item",{disabled:!r.currentPage||r.currentPage===1}])},[s("button",{class:"page-link page-link-radius-2",onClick:e[1]||(e[1]=y(a=>r.currentPage>1&&c.getProducts(r.currentPage-1),["prevent"]))}," 上一頁 ")],2),(i(!0),n(u,null,_(r.pageTotal,a=>(i(),n("li",{class:"page-item",key:`page-${a}`},[s("button",{class:f(["page-link page-link-0 rounded-0",{active:a===r.currentPage}]),onClick:y(v=>c.getProducts(a),["prevent"])},d(a),11,Ve)]))),128)),s("li",{class:f(["page-item",{disabled:!r.currentPage||r.currentPage===r.pageTotal}])},[s("button",{class:"page-link page-link-radius",onClick:e[2]||(e[2]=y(a=>r.currentPage<r.pageTotal&&c.getProducts(r.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])]))],64))])])])])],64)}const Ae=L(B,[["render",Me]]);export{Ae as default};
