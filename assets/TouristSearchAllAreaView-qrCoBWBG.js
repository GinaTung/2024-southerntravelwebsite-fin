import{s as g}from"./sweetAlert-dKnl1H5J.js";import{_ as b,c as r,F as u,h as _,a,n as p,A as k,o as i,t as c,j as x,b as C,w as D,d as v,r as w}from"./index-bsa4QZMk.js";const f="https://two024-south-json-server-vercel.onrender.com",P={data(){return{pageTotal:0,currentPage:1,limitPage:5,parsedLinks:"",products:[],user:"",newProductsDes:"",enabledProducts:[],carts:[],quantity:1,newQty:"",userId:"",token:"",newCarts:[],cartId:null,userCarts:[],currentDate:"",status:{loadingItem:""}}},methods:{checkDate(){var s=new Date,e={year:s.getFullYear(),month:s.getMonth()+1,date:s.getDate()},o=(e.month<10?"0":"")+e.month,d=(e.date<10?"0":"")+e.date,n=e.year+"-"+o+"-"+d;this.currentDate=n},getProducts(s=1){this.axios.get(`${f}/products?_limit=${this.limitPage}&_page=${s}`).then(e=>{var o=parseInt(e.headers["x-total-count"]);this.pageTotal=Math.ceil(o/this.limitPage),this.currentPage=s,this.products=e.data,this.enabledProducts=[],this.products.forEach(d=>{d.is_enabled===1&&this.enabledProducts.push(d)}),this.getNewText()}).catch(e=>{alert(`${e.message}`)})},thousand(s){return s!==void 0&&(s=s.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${s}`},truncateContent(s,e){return s&&s.length>e?s.substring(0,e)+"...":s},getNewText(){const s={};this.products.forEach(e=>{e.description&&e.description.split(";").forEach(d=>{const n=d.trim();s[e.id]||(s[e.id]=[]),s[e.id].push(n)})}),this.newProductsDes=Object.entries(s).map(([e,o])=>({id:e,descriptions:o}))},addToCart(s,e=1,o){if(this.status.loadingItem=s,!this.token)alert("請登入會員後，才能預約套裝行程");else{let d=!1,n=1;this.newCarts.forEach(l=>{l.productId===s&&l.id&&(d=!0,this.cartId=l.id)}),d?this.axios.put(`${f}/carts/${this.cartId}`,{productId:s,qty:e,price:o,total:e*o,userId:this.userId,final_total:e*o*n}).then(l=>{this.status.loadingItem="",g.threeLayerCheckType("success","已更新預約人數"),this.getCart()}).catch(l=>{g.threeLayerCheckType("error","更新預約人數失敗")}):this.axios.post(`${f}/carts`,{productId:s,qty:e,price:o,total:e*o,userId:this.userId,final_total:e*o*n}).then(l=>{this.status.loadingItem="",g.threeLayerCheckType("success","已預約成功"),this.getCart(),this.$emitter.emit("updateCart")}).catch(l=>{g.threeLayerCheckType("error","預約失敗，再重新登入預約")})}},getCart(){this.axios.get(`${f}/carts`).then(s=>{this.carts=s.data,this.carts.forEach(e=>{e.userId===this.userId&&this.newCarts.push(e)})}).catch(s=>{alert("取得購物車資料失敗")})},getCookie(s){const e=document.cookie.split(";");for(let o of e){const[d,n]=o.trim().split("=");if(d===s)return n}return null}},mounted(){this.getProducts();const s=this.getCookie("userId"),e=this.getCookie("hexTokenU");this.userId=s*1,this.token=e,this.getCart(),this.checkDate()}},T={class:"row g-0"},E={class:"col-md-4"},S={class:"tag text-white"},N={class:"card-att-img h-100"},j=["src","alt"],L={class:"col-md-8"},V={class:"card h-100 border-0 bg-transparent"},A={class:"card-body px-3 px-md-4"},B=a("div",{class:"heart3"},[a("i",{class:"bi bi-heart heart-click","data-heartStatus":"false"})],-1),M={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-10"},F={class:"d-flex mb-4"},U={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},z={class:"row"},O={class:"col-12 col-md-8 my-2"},Q={key:0},Y={class:"col-12 col-md-4"},G={class:"d-flex flex-column"},H={class:"fs-4 fs-lg-5 fs-xl-4 text-decoration-line-through text-end"},J={class:"d-flex flex-md-column align-items-end justify-content-end justify-content-sm-between justify-content-md-end"},K=a("p",{class:"text-danger fw-bold d-none d-md-block"},"促銷價",-1),R={class:"d-sm-flex flex-sm-column d-none d-md-none"},W={key:0,class:"fs-7 fs-sm-6 text-dark2"},X={key:1,class:"fs-7 fs-sm-6 text-danger"},Z={key:2,class:"fs-7 fs-sm-6 text-dark2"},q={key:3,class:"fs-6 text-danger"},$={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},I={class:"col-12 d-none d-md-flex flex-md-column"},ee={key:0,class:"fs-6 text-dark2"},te={key:1,class:"fs-6 text-danger"},se={key:2,class:"fs-6 text-dark2"},ae={key:3,class:"fs-6 text-danger"},ne={class:"card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4"},re={class:"d-flex align-items-end"},ie=["onClick","disabled"],oe={key:0,class:"spinner-border spinner-grow-sm",role:"status"},le={key:1,class:"btn btn-danger w-100 ms-2 px-2 px-md-3 py-2 disabled btn-danger-rounded",type:"button"},ce={"aria-label":"Page navigation example",class:"my-10"},de={class:"pagination justify-content-center"},he=["value","onClick"],ue={class:"page-item"};function ge(s,e,o,d,n,l){const y=w("router-link");return i(),r(u,null,[(i(!0),r(u,null,_(n.enabledProducts,t=>(i(),r("div",{class:"card mb-4 card-att",key:t.id},[a("div",T,[a("div",E,[a("span",S,c(t.category),1),a("div",N,[a("img",{src:t.imageUrl,class:"card-img-top img-fluid",alt:t.title},null,8,j)])]),a("div",L,[a("div",V,[a("div",A,[B,a("h4",M,c(t.title),1),a("div",F,[a("span",U,c(t.tag_2),1)]),a("div",z,[a("div",O,[(i(!0),r(u,null,_(n.newProductsDes,h=>(i(),r("div",{key:h.id},[h.id===t.id?(i(),r("div",Q,[(i(!0),r(u,null,_(h.descriptions,m=>(i(),r("p",{key:m},c(l.truncateContent(m,85)),1))),128))])):x("",!0)]))),128))]),a("div",Y,[a("div",G,[a("p",H," NT"+c(l.thousand(t.origin_price)),1),a("div",J,[K,a("div",R,[n.currentDate<=t.endDate?(i(),r("p",W," 預約："+c(t.startDate)+" ~ "+c(t.endDate),1)):(i(),r("p",X,"預約時間已截止")),n.currentDate<=t.endDate?(i(),r("p",Z," 出遊："+c(t.goStartDate)+" ~ "+c(t.goEndDate),1)):(i(),r("p",q,"已出遊完成"))]),a("p",$," NT"+c(l.thousand(t.price)),1)])])])]),a("div",I,[n.currentDate<=t.endDate?(i(),r("p",ee," 預約時間："+c(t.startDate)+" ~ "+c(t.endDate),1)):(i(),r("p",te,"預約時間已截止")),n.currentDate<=t.endDate?(i(),r("p",se," 出遊時間："+c(t.goStartDate)+" ~ "+c(t.goEndDate),1)):(i(),r("p",ae,"已出遊完成"))])]),a("div",ne,[a("div",re,[C(y,{to:{name:"TouristSinglePackage",params:{category:t.category,title:t.title}},class:"btn-outline-square w-100 me-2 px-2 px-md-3",type:"button"},{default:D(()=>[v("行程介紹")]),_:2},1032,["to"]),n.currentDate<=t.endDate?(i(),r("a",{key:0,class:"btn-square w-100 ms-2 px-2 px-md-3",onClick:h=>l.addToCart(t.id,n.quantity,t.price),disabled:n.status.loadingItem===t.id,type:"button"},[n.status.loadingItem===t.id?(i(),r("span",oe)):x("",!0),v(" 預約套裝行程")],8,ie)):(i(),r("a",le,"預約時間截止"))])])])])])]))),128)),a("nav",ce,[a("ul",de,[a("li",{class:p(["page-item",{disabled:!n.currentPage||n.currentPage===1}])},[a("a",{class:"page-link page-link-radius-2",href:"",onClick:e[0]||(e[0]=k(t=>l.getProducts(n.currentPage-1),["prevent"]))},"上一頁")],2),(i(!0),r(u,null,_(n.pageTotal,t=>(i(),r("li",{class:"page-item",key:t+123},[a("a",{class:p(["page-link page-link-0 rounded-0",{active:t===n.currentPage}]),href:"",value:t,onClick:k(h=>l.getProducts(t),["prevent"])},c(t),11,he)]))),128)),a("li",ue,[a("a",{class:p(["page-link page-link-radius",{disabled:!n.currentPage||n.currentPage===n.pageTotal}]),href:"",onClick:e[1]||(e[1]=k(t=>l.getProducts(n.currentPage+1),["prevent"]))},"下一頁",2)])])])],64)}const pe=b(P,[["render",ge]]);export{pe as default};
