import{U as M}from"./UserProductModal-Abmn3yFw.js";import{C as L}from"./CartNavbar-FMr-QAFg.js";import{C as T}from"./collapse-1IfRo1u2.js";import{s as h}from"./sweetAlert-s9tWgqEY.js";import{_ as S,c as n,b as o,a as e,d as D,t as c,k as y,q as O,F as C,i as k,w as U,r as _,o as u,E,n as b,l as P,p as F,f as q}from"./index-ts6q9ZtP.js";import"./modal--s2LqGxW.js";import"./selector-engine-IXq3eMbB.js";const g="https://two024-south-json-server-vercel.onrender.com",B={components:{CartNavbar:L,UserProductModal:M},data(){return{activities:["帳號匯款","信用卡付款"],cartsData:[],isOpen:!1,isOrderOpen:!1,headerCollapse:{},products:[],product:{},cartTotal:0,orderData:[],userOrderData:[],userOrderData_user:"",user:{payMethod:"",cardDate:"",cardNum:"",firstNum:"",secondNum:"",thirdNum:"",fourthNum:""},product_id:"",userId:"",cartDataId:"",userCart:[],total:0,productId:"",productTitle:"",orderId:0,isLoading:!1,userCarts:[],cartsLength:0,isStatus:!1}},watch:{$route(){this.headerCollapse.hide(),this.orderCollapse.hide()}},methods:{backPage(){this.$router.go(-1),this.getCartsData()},toggleOpen(){this.isOpen=!this.isOpen},toggleOpenOrder(){this.isOrderOpen=!this.isOrderOpen},isOver(s){if(s.length===0)return"信用卡有效月年為必填";const t=parseInt(s.split("-")[0],10),d=parseInt(s.split("-")[1],10)-1,p=new Date(t,d),r=new Date;return r.setDate(1),r.setHours(0,0,0,0),p>=r?!0:"信用卡有效月年要有效狀態"},forId(s,t){this.productId=s,this.productTitle=t,this.$refs.userProductModal.openModal()},getCartsData(){this.axios.get(`${g}/cartsData`).then(s=>{this.cartsData=s.data,this.cartsData.forEach(t=>{t.status===!1&&t.data.forEach(d=>{d.userId===this.userId&&(this.userCart.push(d),this.isLoading=!1)})}),this.userCart.forEach(t=>{this.total+=t.final_total})}).catch(s=>{this.isLoading=!1,h.threeLayerCheckType("error","取得購買資料失敗")})},getCookie(s){const t=document.cookie.split(";");for(let d of t){const[p,r]=d.trim().split("=");if(p===s)return r}return null},deleteCartsUSerData(){this.axios.get(`${g}/carts?userId=${this.userId}`).then(s=>{s.data.map(d=>d.id).forEach(d=>{this.axios.delete(`${g}/carts/${d}`).then(p=>{}).catch(p=>{h.threeLayerCheckType("error","刪除已購買資料失敗")})})}).catch(s=>{h.threeLayerCheckType("error","刪除已購買資料失敗")})},changeCartsDataStatus(){this.axios.patch(`${g}/cartsData/${this.cartDataId}`,{status:!0,orderId:this.orderId}).then(()=>{}).catch(s=>{h.threeLayerCheckType("error","更新已購買資料失敗")})},getOrderData(){this.axios.get(`${g}/orders`).then(s=>{this.orderData=s.data,this.orderData.forEach(t=>{t.user.userId===this.userId&&t.user.status===!1&&(this.userOrderData=t,this.orderId=t.id)}),this.userOrderData_user=this.userOrderData.user,this.isStatus===!0&&(this.changeCartsDataStatus(),this.status=!1)}).catch(s=>{h.threeLayerCheckType("error","更新訂單資料失敗")})},updateOderData(){if(!this.user.payMethod){h.threeLayerCheckType("warning","請填寫所有必填欄位");return}if(this.user.payMethod==="信用卡付款"){if(!this.user.cardDate&&!this.user.cardNum){h.threeLayerCheckType("warning","請填寫所有必填欄位");return}if(!this.user.firstNum&&!this.user.secondNum&&!this.user.thirdNum&&!this.user.fourthNum){h.threeLayerCheckType("warning","請填寫所有必填欄位");return}}this.status=!0,this.getOrderData(),this.deleteCartsUSerData(),this.changeCartsDataStatus(),this.orderData.forEach(s=>{if(s.user.userId===this.userId&&s.user.cartDataId===this.cartDataId){const t={create_at:new Date,name:s.user.name,email:s.user.email,tel:s.user.tel,address:s.user.address,birthday:s.user.birthday,comment:s.user.comment,shippingMethod:s.user.shippingMethod,userId:s.user.userId,cartDataId:s.user.cartDataId,passport:s.user.passport,memberId:s.user.memberId,appellation:s.user.appellation,status:!1,payMethod:this.user.payMethod};this.axios.patch(`${g}/orders/${s.id}`,{user:t,status:!1,billStatus:!1,checkDataStatus:!1}).then(d=>{this.$router.push({path:"/cart/orderDone"}),document.cookie="cartDataId=; expires="}).catch(d=>{h.threeLayerCheckType("error","更新訂單資料失敗")})}})},thousand(s){return s!==void 0&&(s=s.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${s}`}},mounted(){window.scrollTo(0,0);const s=this.getCookie("userId"),t=this.getCookie("cartDataId");this.userId=s*1,this.cartDataId=t*1,this.isLoading=!0,this.getCartsData(),this.getOrderData(),this.headerCollapse=new T(this.$refs.headerCollapse,{toggle:!1})}},v=s=>(F("data-v-7745729a"),s=s(),q(),s),j={class:"container py-10 py-lg-30"},z={class:"row"},A={class:"col-md-6 mx-auto pb-5 pb-lg-15"},H={class:"mb-4"},R={class:"d-grid gap-2"},G=v(()=>e("br",null,null,-1)),J={key:0,class:"bi bi-chevron-down"},K={key:1,class:"bi bi-chevron-up"},Q={class:"collapse",id:"collapseExample",ref:"headerCollapse"},W={class:"card card-body rounded-bottom"},X={class:"col-12 col-md-5 col-lg-4"},Y=["src","alt"],Z={class:"col-12 col-md-7 col-lg-8 d-flex flex-column justify-content-between"},$={class:"mt-4 mt-md-0 mb-4"},ee={class:"mb-4"},se={class:"mb-4"},te={class:"mb-4"},re=["onClick"],ae={class:"mb-4"},oe={class:"d-grid gap-2"},le={key:0,class:"bi bi-chevron-down"},de={key:1,class:"bi bi-chevron-up"},ie={class:"collapse",id:"collapseOrder",ref:"orderCollapse"},ce={class:"card card-body rounded-bottom"},ne={class:"row py-4 py-md-5 px-4 px-md-10"},ue=v(()=>e("h4",{class:"text-center mb-4"},"主要聯繫人資料",-1)),he={class:"col-12 col-md-6 col-lg-6"},pe={class:"mb-4"},me={class:"mb-4"},fe={class:"mb-4"},_e={class:"mb-4"},be={class:"col-12 col-md-6 col-lg-6"},ge={class:"mb-4"},ve={class:"mb-4"},De={class:"mb-4"},ye={class:"row"},Ce={class:"col-12 col-md-6 mb-4"},Oe=v(()=>e("h3",{class:"mb-4"},"付款方式",-1)),ke={class:"form-check mb-4 ps-0"},Ie=["value"],xe={class:"radio-label pe-5 fs-5"},we={key:0},Ve=v(()=>e("label",{for:"floatingAddress",class:"fs-5 mb-4"},"信用卡卡號",-1)),Ne={class:"row g-3 d-flex mb-4"},Me={class:"col-3 d-flex flex-column"},Le={class:"col-3 d-flex flex-column"},Te={class:"col-3 d-flex flex-column"},Se={class:"col-3 d-flex flex-column"},Ue={class:"mb-4"},Ee=v(()=>e("label",{for:"floatingDate",class:"fs-5 mb-4"},"信用卡有效月年",-1)),Pe={class:"mb-4"},Fe=v(()=>e("label",{for:"floatingDate",class:"fs-5 mb-4"},"信用卡背後末三碼",-1)),qe={class:"d-flex justify-content-between"};function Be(s,t,d,p,r,i){const I=_("VueLoading"),x=_("CartNavbar"),m=_("VeeField"),f=_("ErrorMessage"),w=_("VeeForm"),V=_("UserProductModal");return u(),n(C,null,[o(I,{active:r.isLoading,class:"text-center","z-index":1060},null,8,["active"]),e("div",j,[e("div",z,[e("div",A,[o(x)])]),e("div",H,[e("p",R,[e("button",{class:"btn btn-primary-600 border-top",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample",onClick:t[0]||(t[0]=(...a)=>i.toggleOpen&&i.toggleOpen(...a))},[D(" 總計："+c(i.thousand(r.total))+"元",1),G,D("購買清單 "),r.isOpen===!1?(u(),n("i",J)):(u(),n("i",K))])]),y(e("div",Q,[e("div",W,[(u(!0),n(C,null,k(r.userCart,a=>(u(),n("div",{class:"row py-4 py-md-5 px-4 px-md-10",key:a.id},[e("div",X,[e("img",{src:a.product.imageUrl,alt:a.product.title,class:"img-fluid h-100 rounded-2"},null,8,Y)]),e("div",Z,[e("div",null,[e("h4",$,"套裝行程名稱："+c(a.product.title),1),e("h5",ee,"單價："+c(i.thousand(a.product.price)),1),e("h5",se,"預約數量："+c(a.qty)+" 位",1),e("h5",te,"總計："+c(i.thousand(a.final_total)),1)]),e("div",null,[e("button",{type:"button",class:"btn-turquoise border-0 rounded-1",onClick:l=>i.forId(a.product.id,a.product.title)}," 查看更多 ",8,re)])])]))),128))])],512),[[O,r.isOpen]])]),e("div",ae,[e("p",oe,[e("button",{class:"btn btn-primary-600 border-top",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseOrder","aria-expanded":"false","aria-controls":"collapseOrder",onClick:t[1]||(t[1]=(...a)=>i.toggleOpenOrder&&i.toggleOpenOrder(...a))},[D(" 訂單資料及收件方式 "),r.isOrderOpen===!1?(u(),n("i",le)):(u(),n("i",de))])]),y(e("div",ie,[e("div",ce,[e("div",ne,[ue,e("div",he,[e("h5",pe,"姓名："+c(r.userOrderData_user.name),1),e("h5",me,"電話："+c(r.userOrderData_user.tel),1),e("h5",fe,"身分證字號："+c(r.userOrderData_user.memberId),1),e("h5",_e,"護照號碼："+c(r.userOrderData_user.passport),1)]),e("div",be,[e("h5",ge,"地址："+c(r.userOrderData_user.address),1),e("h5",ve,"收取方式："+c(r.userOrderData_user.shippingMethod),1),e("h5",De,"備註："+c(r.userOrderData_user.comment),1)])])])],512),[[O,r.isOrderOpen]])]),o(w,{id:"form",ref:"form"},{default:U(({errors:a})=>[e("div",ye,[e("div",Ce,[Oe,e("div",ke,[(u(!0),n(C,null,k(r.activities,l=>(u(),n("label",{class:"radio is-inline",key:l},[y(e("input",{type:"radio",value:l,class:"radio-input me-1",rules:"required",name:"activity","onUpdate:modelValue":t[2]||(t[2]=N=>r.user.payMethod=N)},null,8,Ie),[[E,r.user.payMethod]]),e("span",xe,c(l),1)]))),128))]),r.user.payMethod==="信用卡付款"?(u(),n("div",we,[Ve,e("div",Ne,[e("div",Me,[o(m,{name:"first",type:"text",class:b(["form-control rounded-1",{"is-invalid":a.first}]),placeholder:"4622",id:"first",modelValue:r.user.firstNum,"onUpdate:modelValue":t[3]||(t[3]=l=>r.user.firstNum=l),"aria-label":"First",rules:"numeric:true|length:4"},null,8,["class","modelValue"]),o(f,{name:"first",class:"invalid-feedback mt-4"})]),e("div",Le,[o(m,{name:"second",type:"text",class:b(["form-control rounded-1",{"is-invalid":a.second}]),placeholder:"2223","aria-label":"second",modelValue:r.user.secondNum,"onUpdate:modelValue":t[4]||(t[4]=l=>r.user.secondNum=l),id:"second",rules:"numeric:true|length:4"},null,8,["class","modelValue"]),o(f,{name:"second",class:"invalid-feedback mt-4"})]),e("div",Te,[o(m,{name:"third",type:"text",class:b(["form-control rounded-1",{"is-invalid":a.third}]),placeholder:"2223",modelValue:r.user.thirdNum,"onUpdate:modelValue":t[5]||(t[5]=l=>r.user.thirdNum=l),"aria-label":"third",id:"third",rules:"numeric:true|length:4"},null,8,["class","modelValue"]),o(f,{name:"third",class:"invalid-feedback mt-4"})]),e("div",Se,[o(m,{name:"fourth",type:"text",class:b(["form-control rounded-1",{"is-invalid":a.fourth}]),placeholder:"2223",modelValue:r.user.fourthNum,"onUpdate:modelValue":t[6]||(t[6]=l=>r.user.fourthNum=l),"aria-label":"fourth",id:"fourth",rules:"numeric:true|length:4"},null,8,["class","modelValue"]),o(f,{name:"fourth",class:"invalid-feedback mt-4"})])]),e("div",Ue,[Ee,o(m,{type:"month",name:"floatingDate",class:b(["form-control rounded-1",{"is-invalid":a.floatingDate}]),id:"floatingDate",placeholder:"03/2024",modelValue:r.user.cardDate,"onUpdate:modelValue":t[7]||(t[7]=l=>r.user.cardDate=l),rules:i.isOver},null,8,["class","modelValue","rules"]),o(f,{name:"floatingDate",class:"invalid-feedback"})]),e("div",Pe,[Fe,o(m,{type:"number",name:"信用卡背後末三碼",class:b(["form-control rounded-1",{"is-invalid":a.信用卡背後末三碼}]),id:"floatingNum",placeholder:"123",rules:"numeric:true|length:3"},null,8,["class"]),o(f,{name:"信用卡背後末三碼",class:"invalid-feedback"})])])):P("",!0)])])]),_:1},512),e("div",qe,[e("button",{class:"btn-cerulean w-50 w-md-25 fs-5 mt-4 me-1",onClick:t[8]||(t[8]=(...a)=>i.backPage&&i.backPage(...a)),type:"button"}," 上一步 "),e("button",{class:"btn-square mt-4 fs-5 w-50 w-md-25",type:"button",onClick:t[9]||(t[9]=(...a)=>i.updateOderData&&i.updateOderData(...a))}," 下一步 ")])]),o(V,{ref:"userProductModal",userCart:r.userCart,productId:r.productId,productTitle:r.productTitle},null,8,["userCart","productId","productTitle"])],64)}const Ke=S(B,[["render",Be],["__scopeId","data-v-7745729a"]]);export{Ke as default};
