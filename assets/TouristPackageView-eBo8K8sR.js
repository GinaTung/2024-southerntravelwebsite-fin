import{s as h}from"./sweetAlert-ZoKiFzaK.js";import{_ as D,c,b as v,a as s,w as C,g as L,A as y,t as d,j as x,F as _,h as p,n as f,r as w,o as n,d as k}from"./index-9NSAOEeI.js";const u="https://two024-south-json-server-vercel.onrender.com",F={data(){return{products:[],user:"",userId:"",token:"",carts:[],newCarts:[],newProductsDes:"",enabledProducts:[],fullPath:"",currentURL:"",productsCategory:[],selectedCategory:"全部",currentDate:"",currentPage:1,limitPage:5,pageTotal:0,isLoading:!1,status:{loadingItem:"",loadingItem2:""},category:"全部",cartsLength:0,heartData:[],isFavorite:{}}},watch:{$route(t,e){this.currentURL=t.fullPath,this.$root.navigatedFromHeader&&t.fullPath!=="/TouristPackage"&&(this.selectedCategory="全部",this.status.loadingItem=!0,this.getProducts(),this.$root.navigatedFromHeader=!1)}},computed:{filterCategory(){const t=this.productsCategory.map(i=>i.category),e=[...new Set(t)];return e.unshift("全部"),e},filterCateNum(){const t={};return this.productsCategory.forEach(e=>{t[e.category]?t[e.category]+=1:t[e.category]=1}),t.全部=this.productsCategory.length,t},filteredProducts(){return this.selectedCategory==="全部"||!this.selectedCategory?this.enabledProducts:this.enabledProducts.filter(t=>t.category===this.selectedCategory)}},created(){this.category=this.$route.query.category,this.selectedCategory=this.category,this.getProducts()},methods:{getProducts(t=1){this.axios.get(`${u}/products`).then(e=>{this.productsCategory=e.data.filter(i=>i.is_enabled===1),setTimeout(()=>{this.isLoading=!1},1e3)}).catch(e=>{h.threeLayerCheckType("error","取得產品資料失敗")}),this.selectedCategory==="全部"||!this.selectedCategory?this.axios.get(`${u}/products?_limit=${this.limitPage}&_page=${t}`).then(e=>{var i=parseInt(e.headers["x-total-count"]);this.pageTotal=Math.ceil(i/this.limitPage),this.currentPage=t,this.products=e.data,this.getNewText(),this.enabledProducts=this.products.filter(l=>l.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristPackage",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(e=>{h.threeLayerCheckType("error","取得全部產品資料失敗")}):this.axios.get(`${u}/products?category=${this.selectedCategory}&_limit=${this.limitPage}&_page=${t}`).then(e=>{var i=parseInt(e.headers["x-total-count"]);this.pageTotal=Math.ceil(i/this.limitPage),this.currentPage=t,this.products=e.data,this.getNewText(),this.enabledProducts=this.products.filter(l=>l.is_enabled===1),this.status.loadingItem=!1,this.$router.push({path:"/TouristPackage",query:{category:this.selectedCategory,page:this.currentPage}}),window.scrollTo(0,0)}).catch(e=>{h.threeLayerCheckType("error","取得區域產品資料失敗")})},filterProducts(t){this.selectedCategory=t,this.status.loadingItem=!0,this.getProducts()},checkDate(){var t=new Date,e={year:t.getFullYear(),month:t.getMonth()+1,date:t.getDate()},i=(e.month<10?"0":"")+e.month,l=(e.date<10?"0":"")+e.date,a=e.year+"-"+i+"-"+l;this.currentDate=a},getHeartData(){this.axios.get(`${u}/hearts`).then(t=>{t.data.forEach(e=>{e.userId===this.userId&&e.tag==="旅遊方案"&&(this.isFavorite[e.product]=!0)})}).catch(t=>{h.threeLayerCheckType("error","取得愛心收藏資料失敗")})},toggleFavorite(t,e,i){this.token?this.axios.get(`${u}/hearts`).then(l=>{const a=l.data.find(o=>o.product===t&&o.userId===this.userId&&o.tag==="旅遊方案");a?this.axios.delete(`${u}/hearts/${a.id}`).then(o=>{this.isFavorite[t]=!1,h.threeLayerCheckType("success",`取消收藏 ${i} 成功`),this.getHeartData()}).catch(o=>{h.threeLayerCheckType("error","取消收藏資料失敗")}):this.axios.post(`${u}/hearts`,{product:t,category:e,title:i,userId:this.userId,tag:"旅遊方案"}).then(o=>{this.isFavorite[t]=!0,h.threeLayerCheckType("success",`已加入收藏 ${i} 成功`),this.getHeartData()}).catch(o=>{h.threeLayerCheckType("error","收藏資料失敗")})}).catch(l=>{h.threeLayerCheckType("error","取得愛心收藏資料失敗")}):h.threeLayerCheckType("warning","請登入會員後，才能加入收藏")},thousand(t){return t!==void 0&&(t=t.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),`$ ${t}`},truncateContent(t,e){return t&&t.length>e?t.substring(0,e)+"...":t},getNewText(){const t={};this.products.forEach(e=>{e.description&&e.description.split(";").forEach(l=>{const a=l.trim();t[e.id]||(t[e.id]=[]),t[e.id].push(a)})}),this.newProductsDes=Object.entries(t).map(([e,i])=>({id:e,descriptions:i}))},getCart(){this.axios.get(`${u}/carts`).then(t=>{this.carts=t.data,this.carts.forEach(l=>{l.userId===this.userId&&this.newCarts.push(l)});const e=[],i=new Set;this.newCarts.forEach(l=>{i.has(l.productId)||(i.add(l.productId),e.push(l))}),this.newCarts=e,this.cartsLength=this.newCarts.length,this.$emitter.emit("updateCart",this.cartsLength)}).catch(t=>{h.threeLayerCheckType("error","取得購物車資料失敗")})},addToCart(t,e=1,i){if(this.status.loadingItem2=t,!this.token)h.threeLayerCheckType("warning","請登入會員後，才能預約套裝行程"),this.status.loadingItem2="";else{let l=!1,a=1;this.newCarts.forEach(o=>{o.productId===t&&o.id&&(l=!0,this.cartId=o.id)}),l?this.axios.put(`${u}/carts/${this.cartId}`,{productId:t,qty:e,price:i,total:e*i,userId:this.userId,final_total:e*i*a}).then(o=>{this.status.loadingItem2="",h.threeLayerCheckType("success","已更新預約人數"),this.getCart()}).catch(o=>{this.status.loadingItem2="",h.threeLayerCheckType("error","更新預約人數失敗")}):this.axios.post(`${u}/carts`,{productId:t,qty:e,price:i,total:e*i,userId:this.userId,final_total:e*i*a}).then(o=>{this.status.loadingItem2="",h.threeLayerCheckType("success","已預約成功"),this.getCart()}).catch(o=>{this.status.loadingItem2="",h.threeLayerCheckType("error","預約失敗，再重新登入預約")})}},getCookie(t){const e=document.cookie.split(";");for(let i of e){const[l,a]=i.trim().split("=");if(l===t)return a}return null}},mounted(){this.isLoading=!0,this.getProducts(),window.scrollTo(0,0);const t=this.getCookie("userId"),e=this.getCookie("hexTokenU");this.userId=t*1,this.token=e,this.getCart(),this.checkDate(),this.getHeartData(),this.fullPath=this.$route.fullPath}},N={class:"container py-10 py-lg-30"},E={style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",class:"pb-5 pb-lg-15"},S={class:"breadcrumb mb-0 fs-5"},j={class:"breadcrumb-item"},V={class:"breadcrumb-item","aria-current":"page"},H={key:1},U={key:0,class:"breadcrumb-item","aria-current":"page"},B={class:"tourist-list"},M={class:"row"},q={class:"col-12 col-md-3 mb-5 mb-md-6 mb-lg-0 d-none d-lg-flex"},z={class:"border-1 border w-100 rounded-1 h-100"},A=s("p",{class:"fs-4 p-5 bg-primary-500 text-white"},"地區篩選",-1),I={class:"nav flex-column"},R=["onClick"],O={class:"col-12 col-lg-9"},Y={key:0,class:"text-center",style:{margin:"150px"}},$=s("div",{class:"spinner-border",role:"status",style:{width:"3rem",height:"3rem",color:"#43b8bd"}},[s("span",{class:"visually-hidden"},"Loading...")],-1),G=[$],J={key:1},K={class:"row g-0"},Q={class:"col-md-4"},W={class:"tag text-white"},X={class:"card-att-img h-100"},Z=["src","alt"],ee={class:"col-md-8"},te={class:"card h-100 border-0 bg-transparent"},se={class:"card-body px-3 px-md-4"},re=["onClick"],ae={class:"fs-5 fs-xl-4 fw-bold text-primary-700 card-title-att mb-4 pe-10"},ie={class:"d-flex mb-4"},oe={class:"badge rounded-pill bg-primary-200 text-primary-600 fw-bold me-1 py-1 px-4 fs-6"},ne={class:"row"},ce={class:"col-12 col-md-8 my-2"},le={key:0},de={class:"col-12 col-md-4"},he={class:"d-flex flex-column"},ue={class:"fs-4 fs-lg-5 fs-xl-4 text-decoration-line-through text-end"},ge={class:"d-flex flex-md-column align-items-end justify-content-end justify-content-sm-between justify-content-md-end"},_e=s("p",{class:"text-danger fw-bold d-none d-md-block"},"促銷價",-1),ye={class:"d-sm-flex flex-sm-column d-none d-md-none"},pe={key:0,class:"fs-7 fs-sm-6 text-dark2"},fe={key:1,class:"fs-7 fs-sm-6 text-danger"},ke={key:2,class:"fs-7 fs-sm-6 text-dark2"},me={key:3,class:"fs-6 text-danger"},be={class:"fs-2 fs-sm-3 fs-lg-4 fs-xl-2 text-danger"},ve={class:"col-12 d-none d-md-flex flex-md-column"},Ce={key:0,class:"fs-6 text-dark2"},xe={key:1,class:"fs-6 text-danger"},Pe={key:2,class:"fs-6 text-dark2"},we={key:3,class:"fs-6 text-danger"},Te={class:"card-footer bg-transparent border-0 pt-0 pb-4 px-3 px-md-4"},De={class:"d-flex align-items-end"},Le=["onClick"],Fe={key:0,class:"spinner-border spinner-grow-sm",role:"status"},Ne={key:1,class:"btn btn-danger w-100 ms-2 px-2 px-md-3 py-2 disabled btn-danger-rounded",type:"button"},Ee={"aria-label":"Page navigation example",class:"my-10"},Se={class:"pagination justify-content-center"},je=["onClick"];function Ve(t,e,i,l,a,o){const T=w("VueLoading"),b=w("router-link");return n(),c(_,null,[v(T,{active:a.isLoading,class:"text-center","z-index":1060},null,8,["active"]),s("div",N,[s("nav",E,[s("ol",S,[s("li",j,[v(b,{to:"/",exact:"","active-class":"active-link"},{default:C(()=>[k(" 首頁 ")]),_:1})]),s("li",V,[a.selectedCategory!=="全部"?(n(),L(b,{key:0,exact:"","active-class":"active-link",to:{path:"/TouristPackage",query:{category:"全部",page:"1"}},onClick:e[0]||(e[0]=y(r=>o.filterProducts("全部"),["prevent"]))},{default:C(()=>[k(" 南部旅遊方案 ")]),_:1})):(n(),c("span",H," 南部旅遊方案 "))]),a.selectedCategory!=="全部"?(n(),c("li",U,[s("span",null,d(a.selectedCategory),1)])):x("",!0)])]),s("div",B,[s("div",M,[s("div",q,[s("div",z,[A,s("ul",I,[(n(!0),c(_,null,p(o.filterCategory,(r,m)=>(n(),c("li",{class:"nav-item",key:m},[s("a",{class:f(["nav-link p-5 fs-5 link-color d-flex justify-content-between",{"active-category":a.selectedCategory===r}]),href:"#","aria-current":"page",onClick:y(g=>o.filterProducts(r),["prevent"])},[k(d(r)+" ",1),s("span",null,d(o.filterCateNum[r]),1)],10,R)]))),128))])])]),s("div",O,[a.status.loadingItem?(n(),c("div",Y,G)):(n(),c("div",J,[(n(!0),c(_,null,p(o.filteredProducts,(r,m)=>(n(),c("div",{class:"card mb-4 card-att",key:m+123},[s("div",K,[s("div",Q,[s("span",W,d(r.category),1),s("div",X,[s("img",{src:r.imageUrl,class:"card-img-top img-fluid",alt:r.title,style:{"border-radius":"calc(1.25rem - 1px)"}},null,8,Z)])]),s("div",ee,[s("div",te,[s("div",se,[s("button",{class:"heart border-0",onClick:g=>o.toggleFavorite(r.id,r.category,r.title),type:"button"},[s("i",{class:f(["bi",{"bi-heart-fill":a.isFavorite[r.id],"bi-heart":!a.isFavorite[r.id]}]),style:{"font-size":"24px"}},null,2)],8,re),s("h4",ae,d(r.title),1),s("div",ie,[s("span",oe,d(r.tag_2),1)]),s("div",ne,[s("div",ce,[(n(!0),c(_,null,p(a.newProductsDes,g=>(n(),c("div",{key:g.id},[g.id===r.id?(n(),c("div",le,[(n(!0),c(_,null,p(g.descriptions,P=>(n(),c("p",{key:P},d(o.truncateContent(P,85)),1))),128))])):x("",!0)]))),128))]),s("div",de,[s("div",he,[s("p",ue," NT"+d(o.thousand(r.origin_price)),1),s("div",ge,[_e,s("div",ye,[a.currentDate<=r.endDate?(n(),c("p",pe," 預約："+d(r.startDate)+" ~ "+d(r.endDate),1)):(n(),c("p",fe,"預約時間已截止")),a.currentDate<=r.endDate?(n(),c("p",ke," 出遊："+d(r.goStartDate)+" ~ "+d(r.goEndDate),1)):(n(),c("p",me,"已出遊完成"))]),s("p",be," NT"+d(o.thousand(r.price)),1)])])])]),s("div",ve,[a.currentDate<=r.endDate?(n(),c("p",Ce," 預約時間："+d(r.startDate)+" ~ "+d(r.endDate),1)):(n(),c("p",xe,"預約時間已截止")),a.currentDate<=r.endDate?(n(),c("p",Pe," 出遊時間："+d(r.goStartDate)+" ~ "+d(r.goEndDate),1)):(n(),c("p",we,"已出遊完成"))])]),s("div",Te,[s("div",De,[v(b,{to:{name:"TouristSinglePackage",params:{category:r.category,title:r.title}},class:"btn-outline-square w-100 me-2 px-2 px-md-3"},{default:C(()=>[k("行程介紹")]),_:2},1032,["to"]),a.currentDate<=r.endDate?(n(),c("button",{key:0,class:"btn-square w-100 ms-2 px-2 px-md-3",onClick:g=>o.addToCart(r.id,t.quantity,r.price),type:"button"},[a.status.loadingItem2===r.id?(n(),c("span",Fe)):x("",!0),k(" 立即預約方案 ")],8,Le)):(n(),c("button",Ne," 預約時間截止 "))])])])])])]))),128)),s("nav",Ee,[s("ul",Se,[s("li",{class:f(["page-item",{disabled:!a.currentPage||a.currentPage===1}])},[s("button",{class:"page-link page-link-radius-2",onClick:e[1]||(e[1]=y(r=>a.currentPage>1&&o.getProducts(a.currentPage-1),["prevent"]))}," 上一頁 ")],2),(n(!0),c(_,null,p(a.pageTotal,r=>(n(),c("li",{class:"page-item",key:`page-${r}`},[s("button",{class:f(["page-link page-link-0 rounded-0",{active:r===a.currentPage}]),onClick:y(m=>o.getProducts(r),["prevent"])},d(r),11,je)]))),128)),s("li",{class:f(["page-item",{disabled:!a.currentPage||a.currentPage===a.pageTotal}])},[s("button",{class:"page-link page-link-radius",onClick:e[2]||(e[2]=y(r=>a.currentPage<a.pageTotal&&o.getProducts(a.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])]))])])])])],64)}const Be=D(F,[["render",Ve]]);export{Be as default};
